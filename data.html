<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>合买数据分析报表</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: #f0f4f8;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        body.dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        
        /* 確保在大屏幕上篩選區域不換行 */
        @media (min-width: 1600px) {
            .filter-container {
                flex-wrap: nowrap !important;
            }
            
            .filter-item {
                flex-shrink: 1;
                flex-grow: 0;
            }
        }
        
        /* 特別針對1912x1461尺寸優化 */
        @media (min-width: 1900px) and (max-width: 1920px) {
            .filter-container {
                flex-wrap: nowrap !important;
                gap: 2px !important;
            }
            
            .filter-item {
                flex-shrink: 1;
                padding: 0 1px;
            }
            
            /* 調整日期範圍容器寬度 */
            #dateRangeContainer {
                max-width: 290px;
            }
            
            /* 商戶ID選擇器縮小一點 */
            .merchant-selector {
                max-width: 150px;
            }
            
            /* 序號、發起人和參與人ID欄位寬度調整 */
            .id-field {
                max-width: 110px;
                min-width: 90px;
            }
            
            /* 按鈕區域寬度控制 */
            .buttons-container {
                min-width: 390px;
            }
            
            /* 減少按鈕間距 */
            .filter-button {
                margin-left: 3px !important;
                padding-left: 6px !important;
                padding-right: 6px !important;
            }
        }
        
        /* 表單元素的深色模式樣式 */
        input, select, button, label, .text-gray-600, .text-gray-700, .text-gray-500, .text-xs {
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        body.dark input, 
        body.dark select, 
        body.dark label, 
        body.dark .text-gray-600, 
        body.dark .text-gray-700,
        body.dark .text-gray-500 {
            color: #e2e8f0;
        }
        
        body.dark input, 
        body.dark select {
            background-color: #2d3748;
            border-color: #4a5568;
        }
        
        body.dark input::placeholder {
            color: #a0aec0;
        }
        
        /* Chart.js 相關的深色模式樣式 */
        body.dark .chartjs-render-monitor {
            color: #e2e8f0 !important;
        }
        
        /* 分頁和數據詳情區域的深色模式樣式 */
        body.dark #pagination,
        body.dark #pageNumbers,
        body.dark #itemsPerPageSelect,
        body.dark .pagination-btn {
            color: #e2e8f0;
        }
        
        .filter-section {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark .filter-section {
            background-color: #2d3748;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        body.dark .card {
            background-color: #2d3748;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        body.dark .card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #64748b;
            transition: color 0.3s ease;
        }
        body.dark .stat-label {
            color: #a0aec0;
        }
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }
        body.dark .tab-active {
            color: #60a5fa;
        }
        .code-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .code-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .code-modal-content {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 50%;
            max-height: 80vh;
            max-width: 800px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        body.dark .code-modal-content {
            background-color: #1e293b;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        .code-content {
            background-color: #1e293b;
            color: #e2e8f0;
            border-radius: 0.375rem;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            white-space: pre;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        body.dark .btn-primary {
            background-color: #4f46e5;
        }
        body.dark .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e2e8f0;
            color: #475569;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            background-color: #cbd5e1;
        }
        body.dark .btn-secondary {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark .btn-secondary:hover {
            background-color: #64748b;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* 固定表格布局 */
        }
        th {
            background-color: #f8fafc;
            text-align: center;
            padding: 0.75rem 0.5rem;
            font-weight: 600;
            color: #475569;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            user-select: none;
            width: 12.5%; /* 8列，每列平均寬度 */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        body.dark th {
            background-color: #1e293b;
            color: #e2e8f0;
            border-bottom: 1px solid #4a5568;
        }
        th:hover {
            background-color: #f1f5f9;
        }
        body.dark th:hover {
            background-color: #2d3748;
        }
        td {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: border-color 0.3s ease;
        }
        body.dark td {
            border-bottom: 1px solid #4a5568;
        }
        tr:hover {
            background-color: #f8fafc;
        }
        body.dark tr:hover {
            background-color: #2d3748;
        }
        .pagination-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 0.25rem;
            margin: 0 0.25rem;
        }
        .pagination-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .sort-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-left: 4px;
            vertical-align: middle;
        }
        .sort-icon.active {
            color: #3b82f6;
        }
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 1rem;
        }
        .rank-1 {
            background-color: #fcd34d;
            color: #92400e;
        }
        .rank-2 {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .rank-3 {
            background-color: #d97706;
            color: #fef3c7;
        }
        .rank-other {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .leaderboard-tab {
            cursor: pointer;
            padding: 0.5rem 1rem;
            font-weight: 500;
            border-bottom: 2px solid transparent;
        }
        .leaderboard-tab.active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            position: relative;
            z-index: 10;
        }
        
        body.dark .leaderboard-tab.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
        }
        .leaderboard-content {
            display: none;
        }
        .leaderboard-content.active {
            display: block;
        }
        .progress-bar {
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 3px;
        }
        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            transition: background-color 0.3s ease;
        }
        
        body.dark .range-slider {
            background: #4a5568;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        body.dark .range-slider::-webkit-slider-thumb {
            background: #60a5fa;
        }
        
        .range-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        body.dark .range-slider::-moz-range-thumb {
            background: #60a5fa;
        }
        
        .range-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 4px;
        }
        
        /* 新增的折疊/展開功能和精簡視圖樣式 */
        .collapsible {
            cursor: pointer;
        }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.expanded {
            max-height: 1000px;
        }
        .compact-card {
            padding: 0.5rem 0.75rem;
        }
        .compact-value {
            font-size: 1.1rem;
        }
        .compact-grid {
            gap: 0.5rem !important;
        }
        .compact-table td, .compact-table th {
            padding: 0.375rem 0.5rem;
            font-size: 0.875rem;
        }
        .compact-section {
            margin-bottom: 0.75rem;
        }
        
        /* 主題切換相關樣式 */
        #themeToggle .theme-light {
            display: block;
            z-index: 10;
        }
        #themeToggle .theme-dark {
            display: none;
            z-index: 10;
        }
        body.dark #themeToggle .theme-light {
            display: none;
        }
        body.dark #themeToggle .theme-dark {
            display: block;
        }
        #themeToggle {
            cursor: pointer;
            overflow: visible;
        }
        
        #themeToggle .fa-moon {
            color: #ffffff;
        }
        
        /* 數據詳情區域文字顏色 */
        .text-xs.text-gray-600 {
            transition: color 0.3s ease;
        }
        
        body.dark .text-xs.text-gray-600 {
            color: #a0aec0;
        }
        
        body.dark select option {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        
        /* 高級篩選分隔線 */
        .border-custom {
            border-top-color: #cbd5e1;
            transition: border-color 0.3s ease;
        }
        
        body.dark .border-custom {
            border-top-color: #4a5568;
        }
        
        /* 排行榜分隔線 */
        .border-b {
            border-bottom-color: #e2e8f0;
            transition: border-color 0.3s ease;
        }
        
        body.dark .border-b {
            border-bottom-color: #4a5568;
        }
    </style>
</head>
<body data-new-gr-c-s-check-loaded="14.1105.0" data-gr-ext-installed="">
    <div class="container mx-auto px-3 py-4">
        <!-- 主題切換按鈕 -->
        <div class="fixed top-4 right-16 z-50">
            <button id="themeToggle" class="bg-gray-200 dark:bg-gray-700 rounded-full p-2 shadow-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all flex items-center justify-center w-10 h-10 relative">
                <i class="fas fa-sun text-xl text-yellow-500 theme-light absolute"></i>
                <i class="fas fa-moon text-xl text-white theme-dark absolute"></i>
            </button>
        </div>
        
        <!-- 开发者信息按钮 -->
        <div class="fixed top-20 right-16 z-50">
            <button id="devInfoBtn" class="bg-gray-800 text-white rounded-full p-2 shadow-lg hover:bg-gray-700 transition-all flex items-center justify-center w-10 h-10 relative">
                <i class="fas fa-code"></i>
            </button>
        </div>

        <!-- 筛选条件 -->
        <div class="filter-section p-3 mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer collapsible" id="filterToggle">
                <h3 class="text-sm font-medium text-gray-700">筛选条件</h3>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="collapsible-content" id="filterContent">
                <div class="flex flex-wrap md:flex-wrap items-center gap-3 filter-container">
                <div class="w-full md:w-auto filter-item" style="min-width: 110px; max-width: 130px;">
                        <label class="block text-xs font-medium text-gray-700 mb-1">时间维度</label>
                        <select id="timeGranularity" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="day">按天</option>
                        <option value="week">按周</option>
                        <option value="month">按月</option>
                    </select>
                </div>
                    <div class="w-full md:w-auto flex-grow filter-item" id="dateRangeContainer" style="max-width: 310px; min-width: 270px;">
                        <label class="block text-xs font-medium text-gray-700 mb-1">日期范围</label>
                        <div class="flex items-center gap-1" id="daySelector">
                            <input type="date" id="startDate" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                        <span>至</span>
                            <input type="date" id="endDate" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                        </div>
                        <div class="flex items-center gap-1 hidden" id="weekSelector">
                            <input type="week" id="startWeek" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                            <span>至</span>
                            <input type="week" id="endWeek" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                        </div>
                        <div class="flex items-center gap-1 hidden" id="monthSelector">
                            <input type="month" id="startMonth" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                            <span>至</span>
                            <input type="month" id="endMonth" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                    </div>
                </div>
                <div class="w-full md:w-auto filter-item" style="min-width: 150px; max-width: 160px;">
                        <label class="block text-xs font-medium text-gray-700 mb-1">商户ID</label>
                        <select id="merchantId" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-ellipsis merchant-selector">
                            <option value="all">全部</option>
                            <option value="13589">13589 - 星辰体育</option>
                            <option value="24671">24671 - 极速赛车</option>
                            <option value="37824">37824 - 财富彩票</option>
                            <option value="45912">45912 - 金鹰彩店</option>
                            <option value="58763">58763 - 幸运星彩</option>
                        </select>
                </div>
                <div class="w-full md:w-auto filter-item" style="min-width: 120px; max-width: 140px;">
                        <label class="block text-xs font-medium text-gray-700 mb-1">合买序号</label>
                        <input type="text" id="planId" placeholder="输入序号或留空" class="w-full text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 id-field">
                </div>
                <div class="w-full md:w-auto filter-item" style="min-width: 100px; max-width: 120px;">
                        <label class="block text-xs font-medium text-gray-700 mb-1">发起人ID</label>
                        <input type="text" id="initiatorId" placeholder="输入ID或留空" class="w-full text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 id-field">
                </div>
                <div class="w-full md:w-auto filter-item" style="min-width: 100px; max-width: 120px;">
                        <label class="block text-xs font-medium text-gray-700 mb-1">参与人ID</label>
                        <input type="text" id="participantId" placeholder="输入ID或留空" class="w-full text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 id-field">
                    </div>
                    <div class="w-full md:w-auto md:flex-shrink-0 md:flex-grow-0 flex-nowrap whitespace-nowrap filter-item buttons-container" style="min-width: 370px;">
                        <label class="block text-xs font-medium text-gray-700 mb-1">合买状态</label>
                        <div class="flex items-center flex-nowrap">
                            <select id="status" class="w-28 rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">全部</option>
                        <option value="success">成功</option>
                        <option value="fail">失败</option>
                        <option value="in_progress">进行中</option>
                    </select>
                            <button id="filterBtn" class="btn-primary px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button" style="width: 56px;">搜索</button>
                            <button id="resetBtn" class="btn-secondary px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button" style="width: 56px;">重置</button>
                            <button id="exportBtn" class="px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button bg-green-500 hover:bg-green-600 text-white transition" style="width: 56px;">
                                <i class="fas fa-download mr-1"></i>导出
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- 核心指标卡片 -->
        <div class="mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer collapsible" id="coreMetricsToggle">
                <h2 class="text-sm font-semibold">核心指标</h2>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="collapsible-content expanded" id="coreMetricsContent">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <div class="card p-3">
                        <div class="stat-label text-xs">合买总发起次数</div>
                        <div class="stat-value text-blue-600 text-lg font-semibold" id="totalPlans">100</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+5.2%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">合买成功次数</div>
                        <div class="stat-value text-green-600 text-lg font-semibold" id="successPlans">42</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+3.8%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">合买总金额</div>
                        <div class="stat-value text-purple-600 text-lg font-semibold" id="totalAmount">57,997</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+7.1%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">合买中奖率</div>
                        <div class="stat-value text-amber-600 text-lg font-semibold" id="winRate">42.0%</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-red-500">-1.2%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 合买整体数据卡片 -->
        <div class="mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer collapsible" id="overallDataToggle">
                <h2 class="text-sm font-semibold">合买整体数据</h2>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="collapsible-content expanded" id="overallDataContent">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <div class="card p-3">
                        <div class="stat-label text-xs">合买参与总人次</div>
                        <div class="stat-value text-indigo-600 text-lg font-semibold" id="totalParticipants">502</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+4.3%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">合买平均发起金额</div>
                        <div class="stat-value text-teal-600 text-lg font-semibold" id="avgInitAmount">580.0</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+2.1%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">平均参与人数/单</div>
                        <div class="stat-value text-cyan-600 text-lg font-semibold" id="avgParticipantsPerPlan">5.0</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-red-500">-0.3%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">人均合买参与次数</div>
                        <div class="stat-value text-emerald-600 text-lg font-semibold" id="avgParticipationTimes">1.0</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+1.8%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">人均合买投入金额</div>
                        <div class="stat-value text-rose-600 text-lg font-semibold" id="avgInvestAmount">115.5</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+3.5%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">合买中奖金额总计</div>
                        <div class="stat-value text-amber-600 text-lg font-semibold" id="totalWinAmount">33,885</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+8.7%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">平均中奖金额/单</div>
                        <div class="stat-value text-orange-600 text-lg font-semibold" id="avgWinAmount">806.8</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+5.2%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">合买活跃用户数</div>
                        <div class="stat-value text-blue-600 text-lg font-semibold" id="activeUsers">495</div>
                        <div class="text-xs text-gray-500 mt-1">较上期 <span class="text-green-500">+2.9%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="card p-3 mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer" id="chartToggle">
                <h2 class="text-sm font-semibold">趋势分析</h2>
                <div class="flex items-center">
                    <button class="chart-tab tab-active px-2 py-1 text-xs" data-chart="plans">发起次数</button>
                    <button class="chart-tab px-2 py-1 text-xs" data-chart="amount">金额</button>
                    <button class="chart-tab px-2 py-1 text-xs" data-chart="participants">参与人数</button>
                </div>
            </div>
            <div class="collapsible-content expanded" id="chartContent">
                <div style="height: 250px; width: 100%;">
                    <canvas id="trendChart" width="800" height="250"></canvas>
                </div>
            </div>
        </div>



        <!-- 数据表格 -->
        <div class="card p-3 mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer collapsible" id="tableToggle">
                <h2 class="text-sm font-semibold">数据详情</h2>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="collapsible-content expanded" id="tableContent">
                <div class="flex justify-between items-center mb-2">
                <div class="flex items-center">
                        <span class="text-xs text-gray-600 mr-2">每页显示:</span>
                        <select id="itemsPerPageSelect" class="rounded-md border border-gray-300 px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="10">10条</option>
                        <option value="30">30条</option>
                        <option value="50">50条</option>
                        <option value="100">100条</option>
                    </select>
                </div>
            </div>
            <div class="table-container">
                    <table class="min-w-full compact-table">
                    <thead>
                        <tr>
                            <th data-sort="date">
                                日期
                                <span class="sort-icon active"><i class="fas fa-sort-down"></i></span>
                            </th>
                            <th>商户ID</th>
                            <th>合买序号</th>
                            <th>发起人ID</th>
                            <th data-sort="participants">
                                参与人数
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th data-sort="amount">
                                合买总金额
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th>合买状态</th>
                            <th data-sort="winAmount">
                                中奖金额
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                        </tr>
                    </thead>
                        <tbody id="dataTable">
                            <!-- 动态生成的数据将在这里显示 -->
                        </tbody>
                </table>
            </div>
                <div class="flex justify-between items-center mt-2">
                    <div class="text-xs text-gray-600">
                    显示 <span id="startRecord">1</span> 到 <span id="endRecord">10</span> 条，共 <span id="totalRecords">100</span> 条记录
                </div>
                <div class="flex items-center" id="pagination">
                        <button class="pagination-btn btn-secondary text-xs py-1" id="prevPage" disabled>上一页</button>
                        <div id="pageNumbers" class="flex">
                            <button class="pagination-btn active text-xs py-1">1</button>
                            <button class="pagination-btn btn-secondary text-xs py-1">2</button>
                            <button class="pagination-btn btn-secondary text-xs py-1">3</button>
                            <button class="pagination-btn btn-secondary text-xs py-1">4</button>
                            <button class="pagination-btn btn-secondary text-xs py-1">5</button>
                        </div>
                        <button class="pagination-btn btn-secondary text-xs py-1" id="nextPage">下一页</button>
                    </div>
                </div>
            </div>
        </div>



        <!-- 代码模态框 -->
        <div id="codeModal" class="code-modal">
            <div class="code-modal-content">
                <div class="flex flex-col h-full">
                    <div class="p-3 border-b flex justify-between items-center">
                        <h3 class="text-sm font-semibold">开发者信息 - 源代码 V1.0</h3>
                        <div class="flex items-center">
                            <button id="copyCodeBtn" class="btn-primary px-3 py-1 text-sm rounded-md mr-2">
                                <i class="fas fa-copy mr-1"></i> 复制代码
                            </button>
                            <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="overflow-auto p-3" style="max-height: calc(80vh - 60px);">
                        <pre id="codeContent" class="code-content p-3 text-sm">/**
 * 合買數據分析報表 V1.0
 * 更新日期: 2024-06-11
 * 支持功能: 數據篩選、排序、導出、暗黑模式、圖表分析
 */
&lt;html lang="zh-CN"&gt;...代码内容...&lt;/html&gt;</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加 JavaScript 代码 -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // 初始化主題
                initTheme();
                
                // 初始化折疊面板
                initCollapsibleSections();
                
                // 設置默認日期
                setupDefaultDates();
                
                // 生成隨機數據
                generateRandomData(200);
                
                // 初始化表格分頁和排序
                initTablePagination();
                initTableSorting();
                
                // 時間維度切換
                document.getElementById('timeGranularity').addEventListener('change', function() {
                    const granularity = this.value;
                    updateDateSelector(granularity);
                });
                
                // 設置默認日期和格式化日期顯示
                function setupDefaultDates() {
                    // 獲取當前日期
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    
                    // 格式化為 yyyy-MM-dd 
                    const today = `${year}-${month}-${day}`;
                    
                    // 設置默認的天日期選擇器
                    document.getElementById('startDate').value = today;
                    document.getElementById('endDate').value = today;
                    
                    // 設置默認的週選擇器
                    // 注意：週選擇器格式為 yyyy-Www，其中 ww 是週數
                    const weekNumber = getWeekNumber(now);
                    const weekString = `${year}-W${String(weekNumber).padStart(2, '0')}`;
                    document.getElementById('startWeek').value = weekString;
                    document.getElementById('endWeek').value = weekString;
                    
                    // 設置默認的月選擇器
                    const monthString = `${year}-${month}`;
                    document.getElementById('startMonth').value = monthString;
                    document.getElementById('endMonth').value = monthString;
                }
                
                // 根據日期獲取週數
                function getWeekNumber(date) {
                    const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
                    const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
                    return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
                }
                
                // 更新日期選擇器
                function updateDateSelector(granularity) {
                    const daySelector = document.getElementById('daySelector');
                    const weekSelector = document.getElementById('weekSelector');
                    const monthSelector = document.getElementById('monthSelector');
                    
                    // 隱藏所有選擇器
                    daySelector.classList.add('hidden');
                    weekSelector.classList.add('hidden');
                    monthSelector.classList.add('hidden');
                    
                    // 根據選擇的時間維度顯示對應選擇器
                    if (granularity === 'day') {
                        daySelector.classList.remove('hidden');
                    } else if (granularity === 'week') {
                        weekSelector.classList.remove('hidden');
                    } else if (granularity === 'month') {
                        monthSelector.classList.remove('hidden');
                    }
                }
                

                
                // 篩選按鈕點擊事件
                document.getElementById('filterBtn').addEventListener('click', function() {
                    // 獲取時間維度和日期範圍
                    const timeGranularity = document.getElementById('timeGranularity').value;
                    let startDate, endDate;
                    
                    // 根據時間維度獲取對應的日期值
                    if (timeGranularity === 'day') {
                        startDate = document.getElementById('startDate').value;
                        endDate = document.getElementById('endDate').value;
                    } else if (timeGranularity === 'week') {
                        startDate = document.getElementById('startWeek').value;
                        endDate = document.getElementById('endWeek').value;
                    } else if (timeGranularity === 'month') {
                        startDate = document.getElementById('startMonth').value;
                        endDate = document.getElementById('endMonth').value;
                    }
                    
                    // 獲取其他篩選條件
                    const merchantId = document.getElementById('merchantId').value;
                    const planId = document.getElementById('planId').value;
                    const status = document.getElementById('status').value;
                    const initiatorId = document.getElementById('initiatorId').value;
                    const participantId = document.getElementById('participantId').value;
                    
                    console.log(`篩選時間範圍: ${timeGranularity} - ${startDate} 至 ${endDate}`);
                    
                    // 篩選表格數據
                    filterTableData(merchantId, planId, status, initiatorId, participantId, timeGranularity, startDate, endDate);
                });
                
                // 匯出按鈕點擊事件
                document.getElementById('exportBtn').addEventListener('click', function() {
                    // 取得目前篩選後的可見行
                    const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                        .filter(row => row.style.display !== 'none');
                    
                    if (visibleRows.length === 0) {
                        alert('沒有數據可匯出');
                        return;
                    }
                    
                    // 準備CSV數據
                    let csvContent = '日期,商户ID,合买序号,发起人ID,参与人数,合买总金额,合买状态,中奖金额\n';
                    
                    visibleRows.forEach(function(row) {
                        const cells = row.querySelectorAll('td');
                        let rowData = [];
                        
                        cells.forEach(function(cell) {
                            // 移除千分位逗號 (如數字格式)，並清理HTML標籤
                            let cellText = cell.textContent.trim().replace(/,/g, '');
                            // 對於包含HTML的單元格 (如狀態欄) 特別處理
                            if (cell.innerHTML.includes('class="text-')) {
                                cellText = cell.textContent.trim();
                            }
                            rowData.push(`"${cellText}"`);
                        });
                        
                        csvContent += rowData.join(',') + '\n';
                    });
                    
                    // 創建Blob對象並下載
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    link.setAttribute('href', url);
                    link.setAttribute('download', `合买数据_${timestamp}.csv`);
                    link.style.visibility = 'hidden';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
                
                // 重置按鈕點擊事件
                document.getElementById('resetBtn').addEventListener('click', function() {
                    // 重置所有篩選條件
                    document.getElementById('timeGranularity').value = 'day';
                    document.getElementById('merchantId').value = 'all';
                    document.getElementById('planId').value = '';
                    document.getElementById('status').value = 'all';
                    document.getElementById('initiatorId').value = '';
                    document.getElementById('participantId').value = '';
                    
                    // 重置日期為默認值
                    setupDefaultDates();
                    
                    // 顯示日期選擇器
                    updateDateSelector('day');
                    

                    
                    // 顯示所有表格數據
                    const tableRows = document.querySelectorAll('#dataTable tr');
                    tableRows.forEach(function(row) {
                        row.style.display = '';
                    });
                    
                    // 更新分頁信息
                    updatePaginationInfo();
                });
                
                // 篩選表格數據的函數
                function filterTableData(merchantId, planId, status, initiatorId, participantId, timeGranularity, startDate, endDate) {
                    const tableRows = document.querySelectorAll('#dataTable tr');
                    
                    tableRows.forEach(function(row) {
                        let display = true;
                        
                        // 檢查日期範圍 (如果提供)
                        if (startDate && endDate && display) {
                            const dateCell = row.querySelector('td:nth-child(1)');
                            if (dateCell) {
                                const rowDate = dateCell.textContent.trim();
                                
                                // 根據時間維度檢查日期
                                if (timeGranularity === 'day') {
                                    // 直接比較日期字符串 (格式: YYYY-MM-DD)
                                    if (rowDate < startDate || rowDate > endDate) {
                                        display = false;
                                    }
                                } else if (timeGranularity === 'week') {
                                    // 週格式處理較複雜，這裡簡化處理
                                    // 實際應用中可能需要更精確的週期比較
                                    const rowDateObj = new Date(rowDate);
                                    const rowYear = rowDateObj.getFullYear();
                                    const rowWeek = getWeekNumber(rowDateObj);
                                    const rowWeekStr = `${rowYear}-W${String(rowWeek).padStart(2, '0')}`;
                                    
                                    if (rowWeekStr < startDate || rowWeekStr > endDate) {
                                        display = false;
                                    }
                                } else if (timeGranularity === 'month') {
                                    // 提取行中日期的年和月
                                    const rowDateParts = rowDate.split('-');
                                    const rowYearMonth = `${rowDateParts[0]}-${rowDateParts[1]}`;
                                    
                                    if (rowYearMonth < startDate || rowYearMonth > endDate) {
                                        display = false;
                                    }
                                }
                            }
                        }
                        
                        // 檢查商戶ID
                        if (merchantId !== 'all' && display) {
                            const merchantIdCell = row.querySelector('td:nth-child(2)');
                            if (merchantIdCell && merchantIdCell.textContent.trim() !== merchantId) {
                                display = false;
                            }
                        }
                        
                        // 檢查合買序號
                        if (planId && display) {
                            const planIdCell = row.querySelector('td:nth-child(3)');
                            if (planIdCell && !planIdCell.textContent.includes(planId)) {
                                display = false;
                            }
                        }
                        
                        // 檢查發起人ID
                        if (initiatorId && display) {
                            const initiatorIdCell = row.querySelector('td:nth-child(4)');
                            if (initiatorIdCell && !initiatorIdCell.textContent.includes(initiatorId)) {
                                display = false;
                            }
                        }
                        
                        // 檢查狀態
                        if (status !== 'all' && display) {
                            const statusCell = row.querySelector('td:nth-child(7)');
                            if (statusCell) {
                                const cellStatus = statusCell.textContent.trim();
                                if ((status === 'success' && cellStatus !== '成功') ||
                                    (status === 'fail' && cellStatus !== '失败') ||
                                    (status === 'in_progress' && cellStatus !== '进行中')) {
                                    display = false;
                                }
                            }
                        }
                        
                        // 設置顯示狀態
                        row.style.display = display ? '' : 'none';
                    });
                    
                    // 更新分頁信息
                    updatePaginationInfo();
                }
                
                // 更新分頁信息
                function updatePaginationInfo() {
                    const visibleRows = document.querySelectorAll('#dataTable tr[style=""]').length;
                    const startRecord = document.getElementById('startRecord');
                    const endRecord = document.getElementById('endRecord');
                    const totalRecords = document.getElementById('totalRecords');
                    
                    if (startRecord && endRecord && totalRecords) {
                        if (visibleRows === 0) {
                            startRecord.textContent = '0';
                            endRecord.textContent = '0';
                        } else {
                            startRecord.textContent = '1';
                            endRecord.textContent = Math.min(visibleRows, 10);
                        }
                        totalRecords.textContent = visibleRows;
                    }
                }
                
                // 初始化趨勢圖
                function initTrendChart() {
                    const ctx = document.getElementById('trendChart').getContext('2d');
                    
                    // 檢查當前主題
                    const isDarkMode = document.body.classList.contains('dark');
                    
                    // 創建圖表
                    const myChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: [], // 初始為空，後續更新
                            datasets: [{
                                label: '發起次數',
                                data: [],
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: isDarkMode ? '#e2e8f0' : '#1e293b'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: isDarkMode ? '#e2e8f0' : '#475569'
                                    },
                                    grid: {
                                        color: isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: '日期',
                                        color: isDarkMode ? '#e2e8f0' : '#475569'
                                    },
                                    ticks: {
                                        color: isDarkMode ? '#e2e8f0' : '#475569'
                                    },
                                    grid: {
                                        color: isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                    }
                                }
                            }
                        }
                    });
                    
                    // 監聽主題變化，更新圖表樣式
                    document.getElementById('themeToggle').addEventListener('click', function() {
                        const isDarkMode = document.body.classList.contains('dark');
                        
                        // 更新圖表字體顏色
                        myChart.options.plugins.legend.labels.color = isDarkMode ? '#e2e8f0' : '#1e293b';
                        myChart.options.scales.x.title.color = isDarkMode ? '#e2e8f0' : '#475569';
                        myChart.options.scales.x.ticks.color = isDarkMode ? '#e2e8f0' : '#475569';
                        myChart.options.scales.y.ticks.color = isDarkMode ? '#e2e8f0' : '#475569';
                        myChart.options.scales.x.grid.color = isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        myChart.options.scales.y.grid.color = isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // 更新圖表
                        myChart.update();
                    });
                    
                    // 更新圖表數據
                    updateChartByTimeGranularity('day');
                    
                    // 添加時間維度切換監聽器
                    document.getElementById('timeGranularity').addEventListener('change', function() {
                        const granularity = this.value;
                        updateChartByTimeGranularity(granularity);
                    });
                    
                    // 切換圖表類型
                    document.querySelectorAll('.chart-tab').forEach(function(tab) {
                        tab.addEventListener('click', function(e) {
                            e.stopPropagation();
                            
                            // 移除所有標籤的激活狀態
                            document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('tab-active'));
                            
                            // 激活當前標籤
                            this.classList.add('tab-active');
                            
                            const chartType = this.getAttribute('data-chart');
                            const timeGranularity = document.getElementById('timeGranularity').value;
                            
                            // 更新圖表數據
                            updateChartData(chartType, timeGranularity);
                        });
                    });
                    
                    // 更新圖表數據
                    function updateChartData(chartType, timeGranularity) {
                        // 獲取活躍的數據類型
                        let label, color, bgColor;
                        
                        if (chartType === 'plans') {
                            label = '發起次數';
                            color = '#3b82f6';
                            bgColor = 'rgba(59, 130, 246, 0.1)';
                        } else if (chartType === 'amount') {
                            label = '金額';
                            color = '#8b5cf6';
                            bgColor = 'rgba(139, 92, 246, 0.1)';
                        } else if (chartType === 'participants') {
                            label = '參與人數';
                            color = '#10b981';
                            bgColor = 'rgba(16, 185, 129, 0.1)';
                        }
                        
                        // 獲取對應的數據
                        const data = generateChartData(chartType, timeGranularity);
                        
                        // 更新圖表
                        myChart.data.datasets[0].label = label;
                        myChart.data.datasets[0].data = data.values;
                        myChart.data.labels = data.labels;
                        myChart.data.datasets[0].borderColor = color;
                        myChart.data.datasets[0].backgroundColor = bgColor;
                        
                        // 更新X軸標題
                        myChart.options.scales.x.title.text = getXAxisTitle(timeGranularity);
                        
                        myChart.update();
                    }
                    
                    // 根據時間維度更新圖表
                    function updateChartByTimeGranularity(granularity) {
                        const activeTab = document.querySelector('.chart-tab.tab-active');
                        const chartType = activeTab ? activeTab.getAttribute('data-chart') : 'plans';
                        
                        updateChartData(chartType, granularity);
                    }
                    
                    // 生成圖表數據
                    function generateChartData(chartType, timeGranularity) {
                        // 獲取表格中的所有數據行
                        const rows = Array.from(document.querySelectorAll('#dataTable tr'));
                        
                        // 準備數據結構
                        const dataMap = new Map();
                        
                        // 設定日期索引和數據索引
                        const dateIndex = 0;
                        let valueIndex;
                        
                        if (chartType === 'plans') {
                            // 僅計數不同日期的記錄數
                            valueIndex = null;
                        } else if (chartType === 'amount') {
                            valueIndex = 5; // 金額列索引
                        } else if (chartType === 'participants') {
                            valueIndex = 4; // 參與人數列索引
                        }
                        
                        // 處理每一行數據
                        rows.forEach(row => {
                            const cells = row.querySelectorAll('td');
                            if (cells.length > 0) {
                                // 獲取日期
                                const fullDate = cells[dateIndex].textContent.trim();
                                
                                // 根據時間維度處理日期
                                let timeKey;
                                if (timeGranularity === 'day') {
                                    timeKey = fullDate;
                                } else if (timeGranularity === 'week') {
                                    const dateObj = new Date(fullDate);
                                    const year = dateObj.getFullYear();
                                    const weekNumber = getWeekNumber(dateObj);
                                    timeKey = `${year}-W${String(weekNumber).padStart(2, '0')}`;
                                } else if (timeGranularity === 'month') {
                                    timeKey = fullDate.substring(0, 7); // YYYY-MM
                                }
                                
                                // 初始化或增加計數
                                if (!dataMap.has(timeKey)) {
                                    dataMap.set(timeKey, valueIndex === null ? 1 : parseFloat(cells[valueIndex].textContent.replace(',', '')));
                                } else {
                                    if (valueIndex === null) {
                                        // 計數模式
                                        dataMap.set(timeKey, dataMap.get(timeKey) + 1);
                                    } else {
                                        // 累加模式
                                        dataMap.set(timeKey, dataMap.get(timeKey) + parseFloat(cells[valueIndex].textContent.replace(',', '')));
                                    }
                                }
                            }
                        });
                        
                        // 排序鍵（日期）
                        const sortedKeys = Array.from(dataMap.keys()).sort();
                        
                        // 格式化標籤
                        const formattedLabels = sortedKeys.map(key => formatLabel(key, timeGranularity));
                        
                        // 獲取對應的值
                        const values = sortedKeys.map(key => dataMap.get(key));
                        
                        return {
                            labels: formattedLabels,
                            values: values
                        };
                    }
                    
                    // 格式化標籤
                    function formatLabel(key, timeGranularity) {
                        if (timeGranularity === 'day') {
                            // 日期格式：MM/DD
                            const parts = key.split('-');
                            return `${parts[1]}/${parts[2]}`;
                        } else if (timeGranularity === 'week') {
                            // 週格式：Week WW
                            const weekNumber = key.split('-W')[1];
                            return `第${weekNumber}週`;
                        } else if (timeGranularity === 'month') {
                            // 月份格式：YYYY/MM
                            const parts = key.split('-');
                            return `${parts[0]}/${parts[1]}`;
                        }
                        return key;
                    }
                    
                    // 獲取X軸標題
                    function getXAxisTitle(timeGranularity) {
                        if (timeGranularity === 'day') {
                            return '日期 (月/日)';
                        } else if (timeGranularity === 'week') {
                            return '週數';
                        } else if (timeGranularity === 'month') {
                            return '月份 (年/月)';
                        }
                        return '日期';
                    }
                }
                


                // 更新表格數據
                function updateTableData(tabType) {
                    const tableBody = document.getElementById('dataTable');
                    // 清空原有表格數據，以便重新生成
                    tableBody.innerHTML = '';
                    
                    // 生成新數據
                    const topUsers = getTopUsers(tabType, 5);
                    
                    // 存儲所有行，以便後續排序
                    const allRows = [];
                    
                    // 根據排行榜類型確定要顯示的數據
                    topUsers.forEach(user => {
                        const row = document.createElement('tr');
                        
                        // 生成隨機日期（過去7天內）
                        const randomDate = generateRandomDate(7);
                        const formattedDate = formatDate(randomDate);
                        
                        // 隨機商戶ID
                        const merchantIds = ['13589', '24671', '37824', '45912', '58763'];
                        const randomMerchantId = merchantIds[Math.floor(Math.random() * merchantIds.length)];
                        
                        // 隨機合買序號（6位數）
                        const randomPlanId = Math.floor(100000 + Math.random() * 900000);
                        
                        // 參與人數（根據topUsers數據）
                        const participants = tabType === 'participants' ? user.value : Math.floor(2 + Math.random() * 8);
                        
                        // 合買總金額
                        const amount = tabType === 'avg-amount' ? user.value : Math.floor(100 + Math.random() * 1900);
                        const formattedAmount = formatNumber(amount);
                        
                        // 合買狀態
                        let status;
                        if (tabType === 'success-rate') {
                            // 根據成功率設置狀態
                            const successRate = user.value / 100;
                            if (Math.random() < successRate) {
                                status = '<td class="text-green-600">成功</td>';
                            } else if (Math.random() < 0.5) {
                                status = '<td class="text-red-600">失败</td>';
                            } else {
                                status = '<td class="text-amber-600">进行中</td>';
                            }
                        } else {
                            // 隨機狀態
                            const statuses = [
                                '<td class="text-green-600">成功</td>',
                                '<td class="text-red-600">失败</td>',
                                '<td class="text-amber-600">进行中</td>'
                            ];
                            status = statuses[Math.floor(Math.random() * statuses.length)];
                        }
                        
                        // 中獎金額（隨機，大約是合買金額的0.8-1.5倍）
                        const winAmount = status.includes('成功') ? 
                            Math.floor(amount * (0.8 + Math.random() * 0.7)) : 0;
                        const formattedWinAmount = formatNumber(winAmount);
                        
                        // 統計欄位的值
                        let countValue;
                        switch(tabType) {
                            case 'initiators':
                                countValue = user.value;
                                break;
                            case 'participants':
                                countValue = user.value;
                                break;
                            case 'success-rate':
                                countValue = user.value + '%';
                                break;
                            case 'avg-amount':
                                countValue = formatNumber(user.value);
                                break;
                            default:
                                countValue = 0;
                        }
                        
                        // 填充行數據
                        row.innerHTML = `
                            <td>${formattedDate}</td>
                            <td>${randomMerchantId}</td>
                            <td>${randomPlanId}</td>
                            <td>${user.id}</td>
                            <td class="count-cell">${countValue}</td>
                            <td>${participants}</td>
                            <td>${formattedAmount}</td>
                            ${status}
                            <td>${formattedWinAmount}</td>
                        `;
                        
                        // 將行添加到數組
                        row.setAttribute('data-date', randomDate.getTime());
                        allRows.push(row);
                    });
                    
                    // 添加更多隨機數據（總共顯示20條）
                    const totalRows = 20;
                    const remainingRows = totalRows - topUsers.length;
                    
                    for (let i = 0; i < remainingRows; i++) {
                        const row = document.createElement('tr');
                        
                        // 生成隨機日期（過去30天內）
                        const randomDate = generateRandomDate(30);
                        const formattedDate = formatDate(randomDate);
                        
                        // 隨機商戶ID
                        const merchantIds = ['13589', '24671', '37824', '45912', '58763'];
                        const randomMerchantId = merchantIds[Math.floor(Math.random() * merchantIds.length)];
                        
                        // 隨機合買序號
                        const randomPlanId = Math.floor(100000 + Math.random() * 900000);
                        
                        // 隨機用戶ID
                        const randomUserId = Math.floor(10000 + Math.random() * 90000);
                        
                        // 隨機參與人數
                        const participants = Math.floor(2 + Math.random() * 8);
                        
                        // 隨機合買金額
                        const amount = Math.floor(100 + Math.random() * 1900);
                        const formattedAmount = formatNumber(amount);
                        
                        // 隨機狀態
                        const statuses = [
                            '<td class="text-green-600">成功</td>',
                            '<td class="text-red-600">失败</td>',
                            '<td class="text-amber-600">进行中</td>'
                        ];
                        const status = statuses[Math.floor(Math.random() * statuses.length)];
                        
                        // 中獎金額
                        const winAmount = status.includes('成功') ? 
                            Math.floor(amount * (0.8 + Math.random() * 0.7)) : 0;
                        const formattedWinAmount = formatNumber(winAmount);
                        
                        // 統計欄位
                        let countValue;
                        switch(tabType) {
                            case 'initiators':
                                countValue = Math.floor(1 + Math.random() * 10);
                                break;
                            case 'participants':
                                countValue = Math.floor(1 + Math.random() * 20);
                                break;
                            case 'success-rate':
                                countValue = (Math.random() * 50).toFixed(1) + '%';
                                break;
                            case 'avg-amount':
                                countValue = formatNumber(Math.floor(50 + Math.random() * 300));
                                break;
                            default:
                                countValue = 0;
                        }
                        
                        // 填充行數據
                        row.innerHTML = `
                            <td>${formattedDate}</td>
                            <td>${randomMerchantId}</td>
                            <td>${randomPlanId}</td>
                            <td>${randomUserId}</td>
                            <td class="count-cell">${countValue}</td>
                            <td>${participants}</td>
                            <td>${formattedAmount}</td>
                            ${status}
                            <td>${formattedWinAmount}</td>
                        `;
                        
                        // 將行添加到數組
                        row.setAttribute('data-date', randomDate.getTime());
                        allRows.push(row);
                    }
                    
                    // 按日期降序排序所有行（最新日期優先）
                    allRows.sort((a, b) => {
                        const dateA = parseInt(a.getAttribute('data-date'));
                        const dateB = parseInt(b.getAttribute('data-date'));
                        return dateB - dateA;
                    });
                    
                    // 將排序後的行添加到表格
                    allRows.forEach(row => {
                        tableBody.appendChild(row);
                    });
                    
                    // 更新分頁信息
                    updatePaginationInfo();
                }

                // 獲取排行榜前N名用戶
                function getTopUsers(tabType, count) {
                    // 獲取對應排行榜的用戶數據
                    let leaderboardData = [];
                    
                    // 根據排行榜類型獲取對應數據
                    switch(tabType) {
                        case 'initiators':
                            leaderboardData = [
                                { id: '10048', value: 50 },
                                { id: '10011', value: 49 },
                                { id: '10013', value: 47 },
                                { id: '10038', value: 47 },
                                { id: '10005', value: 46 }
                            ];
                            break;
                        case 'participants':
                            leaderboardData = [
                                { id: '10030', value: 100 },
                                { id: '10023', value: 98 },
                                { id: '10013', value: 97 },
                                { id: '10003', value: 93 },
                                { id: '10015', value: 91 }
                            ];
                            break;
                        case 'success-rate':
                            leaderboardData = [
                                { id: '10005', value: 65.2 },
                                { id: '10013', value: 57.4 },
                                { id: '10038', value: 46.8 },
                                { id: '10048', value: 46.0 },
                                { id: '10011', value: 24.5 }
                            ];
                            break;
                        case 'avg-amount':
                            leaderboardData = [
                                { id: '10011', value: 758.4 },
                                { id: '10005', value: 638.0 },
                                { id: '10013', value: 449.9 },
                                { id: '10048', value: 405.3 },
                                { id: '10038', value: 180.2 }
                            ];
                            break;
                        default:
                            return [];
                    }
                    
                    // 取前N名
                    return leaderboardData.slice(0, count);
                }

                // 生成隨機日期
                function generateRandomDate(daysRange) {
                    const today = new Date();
                    const pastDay = new Date(today);
                    pastDay.setDate(today.getDate() - Math.floor(Math.random() * daysRange));
                    return pastDay;
                }

                // 格式化日期
                function formatDate(date) {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                }

                // 格式化數字（添加千分位）
                function formatNumber(num) {
                    if (num >= 1000) {
                        return `${Math.floor(num/1000)},${String(num % 1000).padStart(3, '0')}`;
                    }
                    return String(num);
                }

                // 計算統計數據
                function calculateStats(data, tabType) {
                    const stats = {};
                    
                    data.forEach(row => {
                        if (!stats[row.userId]) {
                            stats[row.userId] = {
                                count: 0,
                                participantCount: 0,
                                totalAmount: 0,
                                successCount: 0,
                                totalCount: 0
                            };
                        }
                        
                        const userStats = stats[row.userId];
                        userStats.count++;
                        userStats.participantCount += row.participants;
                        userStats.totalAmount += row.amount;
                        userStats.totalCount++;
                        if (row.status === '成功') {
                            userStats.successCount++;
                        }
                    });
                    
                    // 計算平均值和比率
                    Object.values(stats).forEach(stat => {
                        stat.successRate = stat.successCount / stat.totalCount;
                        stat.avgAmount = stat.totalAmount / stat.totalCount;
                    });
                    
                    return stats;
                }

                // 圖表標籤切換
                const chartTabs = document.querySelectorAll('.chart-tab');
                chartTabs.forEach(function(tab) {
                    tab.addEventListener('click', function(e) {
                        e.stopPropagation(); // 防止觸發折疊面板
                        
                        // 移除所有標籤的激活狀態
                        chartTabs.forEach(t => t.classList.remove('tab-active'));
                        
                        // 激活當前標籤
                        this.classList.add('tab-active');
            });
        });

                // 模態框控制
                document.getElementById('devInfoBtn').addEventListener('click', function() {
                    document.getElementById('codeModal').classList.add('show');
                    
                    // 更新代碼內容為當前HTML
                    const htmlContent = document.documentElement.outerHTML;
                    document.getElementById('codeContent').textContent = htmlContent;
                });
                
                document.getElementById('closeModalBtn').addEventListener('click', function() {
                    document.getElementById('codeModal').classList.remove('show');
                });
                
                // 點擊蒙層關閉模態窗
                document.getElementById('codeModal').addEventListener('click', function(e) {
                    // 確保點擊的是蒙層本身，而不是模態框內容
                    if (e.target === this) {
                        this.classList.remove('show');
                    }
                });
                
                // 複製代碼功能
                document.getElementById('copyCodeBtn').addEventListener('click', function() {
                    const codeContent = document.getElementById('codeContent').textContent;
                    navigator.clipboard.writeText(codeContent).then(function() {
                        // 複製成功
                        const originalText = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check mr-1"></i> 已複製';
                        
                        // 3秒後恢復原文本
                        setTimeout(() => {
                            this.innerHTML = originalText;
                        }, 3000);
                    }.bind(this)).catch(function(err) {
                        // 複製失敗
                        console.error('複製失敗: ', err);
                    });
                });

                // 初始化主題功能
                function initTheme() {
                    // 檢查本地存儲中是否有主題偏好
                    const savedTheme = localStorage.getItem('theme');
                    if (savedTheme === 'dark') {
                        document.body.classList.add('dark');
                    } else {
                        // 默認設為日間模式
                        document.body.classList.remove('dark');
                        localStorage.setItem('theme', 'light');
                    }
                    
                    // 監聽主題切換按鈕點擊
                    document.getElementById('themeToggle').addEventListener('click', function() {
                        // 切換深色模式類
                        document.body.classList.toggle('dark');
                        
                        // 保存主題偏好到本地存儲
                        const isDark = document.body.classList.contains('dark');
                        localStorage.setItem('theme', isDark ? 'dark' : 'light');
                    });
                }

                // 初始化時添加商戶ID下拉選單的變更事件
                document.getElementById('merchantId').addEventListener('change', function() {
                    // 獲取時間維度和日期範圍
                    const timeGranularity = document.getElementById('timeGranularity').value;
                    let startDate, endDate;
                    
                    // 根據時間維度獲取對應的日期值
                    if (timeGranularity === 'day') {
                        startDate = document.getElementById('startDate').value;
                        endDate = document.getElementById('endDate').value;
                    } else if (timeGranularity === 'week') {
                        startDate = document.getElementById('startWeek').value;
                        endDate = document.getElementById('endWeek').value;
                    } else if (timeGranularity === 'month') {
                        startDate = document.getElementById('startMonth').value;
                        endDate = document.getElementById('endMonth').value;
                    }
                    
                    const merchantId = this.value;
                    const planId = document.getElementById('planId').value;
                    const status = document.getElementById('status').value;
                    const initiatorId = document.getElementById('initiatorId').value;
                    const participantId = document.getElementById('participantId').value;
                    
                    // 篩選表格數據
                    filterTableData(merchantId, planId, status, initiatorId, participantId, timeGranularity, startDate, endDate);
                });
                
                // 初始化趨勢圖
                initTrendChart();
                
                // 初始化折疊面板功能
                function initCollapsibleSections() {
                    const collapsibles = document.querySelectorAll('.collapsible');
                    
                    collapsibles.forEach(function(item) {
                        item.addEventListener('click', function() {
                            const contentId = this.id.replace('Toggle', 'Content');
                            const content = document.getElementById(contentId);
                            
                            if (content) {
                                content.classList.toggle('expanded');
                                const icon = this.querySelector('i.fas');
                                if (icon) {
                                    icon.classList.toggle('fa-chevron-down');
                                    icon.classList.toggle('fa-chevron-up');
                                }
                            }
                        });
                    });
                    
                    // 預設狀態：篩選條件折疊，其他展開
                    document.querySelectorAll('.collapsible-content').forEach(function(content) {
                        if (content.id === 'filterContent') {
                            // 篩選條件預設折疊
                        } else {
                            // 其他面板預設展開
                            content.classList.add('expanded');
                        }
                    });
                }

                // 表格分頁功能
                function initTablePagination() {
                    // 獲取分頁元素
                    const prevPageBtn = document.getElementById('prevPage');
                    const nextPageBtn = document.getElementById('nextPage');
                    const pageNumbers = document.getElementById('pageNumbers');
                    const itemsPerPageSelect = document.getElementById('itemsPerPageSelect');
                    
                    // 分頁狀態
                    let currentPage = 1;
                    let itemsPerPage = parseInt(itemsPerPageSelect.value);
                    let totalPages = 1;
                    
                    // 更新分頁顯示
                    function updatePagination() {
                        // 獲取可見行
                        const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        const totalItems = visibleRows.length;
                        
                        // 計算總頁數
                        totalPages = Math.ceil(totalItems / itemsPerPage);
                        if (totalPages === 0) totalPages = 1;
                        
                        // 確保當前頁在有效範圍內
                        if (currentPage > totalPages) {
                            currentPage = totalPages;
                        }
                        
                        // 更新分頁按鈕
                        prevPageBtn.disabled = currentPage === 1;
                        nextPageBtn.disabled = currentPage === totalPages;
                        
                        // 生成頁碼按鈕
            pageNumbers.innerHTML = '';
            
                        // 決定要顯示的頁碼範圍
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
                        // 調整起始頁以確保顯示5個頁碼（如果有這麼多頁）
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }
            
                        // 創建頁碼按鈕
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                            pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : 'btn-secondary'} text-xs py-1`;
                pageBtn.textContent = i;
                            pageBtn.onclick = function() {
                    currentPage = i;
                                showCurrentPage();
                            };
                pageNumbers.appendChild(pageBtn);
            }
            
                        // 更新顯示的記錄範圍
                        const startRecord = document.getElementById('startRecord');
                        const endRecord = document.getElementById('endRecord');
                        const totalRecords = document.getElementById('totalRecords');
                        
                        if (totalItems === 0) {
                            startRecord.textContent = '0';
                            endRecord.textContent = '0';
                        } else {
                            const start = (currentPage - 1) * itemsPerPage + 1;
                            const end = Math.min(start + itemsPerPage - 1, totalItems);
                            startRecord.textContent = start;
                            endRecord.textContent = end;
                        }
                        totalRecords.textContent = totalItems;
                    }
                    
                    // 顯示當前頁的數據
                    function showCurrentPage() {
                        // 獲取可見行
                        const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        
                        // 計算當前頁的開始和結束索引
                        const startIndex = (currentPage - 1) * itemsPerPage;
                        const endIndex = startIndex + itemsPerPage;
                        
                        // 隱藏所有行
                        visibleRows.forEach(row => {
                            row.classList.add('hidden');
                        });
                        
                        // 顯示當前頁的行
                        for (let i = startIndex; i < endIndex && i < visibleRows.length; i++) {
                            visibleRows[i].classList.remove('hidden');
                        }
                        
                        // 更新分頁顯示
                        updatePagination();
                    }
                    
                    // 上一頁按鈕點擊事件
                    prevPageBtn.addEventListener('click', function() {
                        if (currentPage > 1) {
                            currentPage--;
                            showCurrentPage();
                        }
                    });
                    
                    // 下一頁按鈕點擊事件
                    nextPageBtn.addEventListener('click', function() {
                        if (currentPage < totalPages) {
                            currentPage++;
                            showCurrentPage();
                        }
                    });
                    
                    // 每頁顯示數量變更事件
                    itemsPerPageSelect.addEventListener('change', function() {
                        itemsPerPage = parseInt(this.value);
                        currentPage = 1; // 重置為第一頁
                        showCurrentPage();
                    });
                    
                    // 初始化顯示第一頁
                    showCurrentPage();
                    
                    // 重寫更新分頁信息函數，以適配分頁功能
                    window.updatePaginationInfo = function() {
                        // 獲取實際可見行數（不包括被篩選掉的行）
                        const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        
                        // 更新總記錄數
                        document.getElementById('totalRecords').textContent = visibleRows.length;
                        
                        // 重置為第一頁
                        currentPage = 1;
                        showCurrentPage();
                    };
                }
                
                // 表格排序功能
                function initTableSorting() {
                    const table = document.querySelector('table');
                    const headers = table.querySelectorAll('th');
                    const tableBody = document.getElementById('dataTable');
                    
                    // 排序方向（1: 升序，-1: 降序）
                    let sortDirection = 1;
                    let lastSortedColumn = 'date'; // 默認按日期排序
                    
                    // 為每個表頭添加點擊事件
                    headers.forEach(header => {
                        if (header.getAttribute('data-sort')) {
                            header.addEventListener('click', function() {
                                const column = this.getAttribute('data-sort');
                                
                                // 如果點擊的是當前排序列，則切換排序方向
                                if (column === lastSortedColumn) {
                                    sortDirection *= -1;
                                } else {
                                    sortDirection = 1; // 新列默認升序
                                    lastSortedColumn = column;
                                }
                                
                                // 更新排序圖標
                                headers.forEach(h => {
                                    const icon = h.querySelector('.sort-icon');
                                    if (icon) {
                                        icon.classList.remove('active');
                                        icon.innerHTML = '<i class="fas fa-sort"></i>';
                                    }
                                });
                                
                                const icon = this.querySelector('.sort-icon');
                                if (icon) {
                                    icon.classList.add('active');
                                    icon.innerHTML = sortDirection === 1 
                                        ? '<i class="fas fa-sort-up"></i>'
                                        : '<i class="fas fa-sort-down"></i>';
                                }
                                
                                // 執行排序
                                sortTable(column, sortDirection);
                            });
                        }
                    });
                    
                    // 排序表格
                    function sortTable(column, direction) {
                        // 保存當前篩選狀態和分頁信息
                        const filterStatus = [];
                        const rows = Array.from(tableBody.querySelectorAll('tr'));
                        
                        // 記錄每行的當前顯示狀態
                        rows.forEach(row => {
                            filterStatus.push({
                                row: row,
                                display: row.style.display,
                                hidden: row.classList.contains('hidden')
                            });
                        });
                        
                        // 確定列索引
                        let columnIndex;
                        switch (column) {
                            case 'date': columnIndex = 0; break;
                            case 'count': columnIndex = 4; break;
                            case 'participants': columnIndex = 5; break;
                            case 'amount': columnIndex = 6; break;
                            case 'winAmount': columnIndex = 8; break;
                            default: columnIndex = 0;
                        }
                        
                        // 排序行
                        const sortedRows = rows.sort((a, b) => {
                            let aValue = a.querySelectorAll('td')[columnIndex].textContent.trim();
                            let bValue = b.querySelectorAll('td')[columnIndex].textContent.trim();
                            
                            // 處理數字和金額格式
                            if (column === 'participants') {
                                // 參與人數是整數
                                aValue = parseInt(aValue);
                                bValue = parseInt(bValue);
                            } else if (column === 'amount' || column === 'winAmount') {
                                // 金額格式（去除逗號）
                                aValue = parseFloat(aValue.replace(',', ''));
                                bValue = parseFloat(bValue.replace(',', ''));
                            } else if (column === 'count') {
                                // 處理百分比和一般數字
                                if (aValue.includes('%')) {
                                    aValue = parseFloat(aValue);
                                    bValue = parseFloat(bValue);
                                } else {
                                    aValue = parseFloat(aValue.replace(',', ''));
                                    bValue = parseFloat(bValue.replace(',', ''));
                                }
                            }
                            
                            // 比較值
                            if (aValue < bValue) return -1 * direction;
                            if (aValue > bValue) return 1 * direction;
                            return 0;
                        });
                        
                        // 重新排列表格行
                        tableBody.innerHTML = '';
                        
                        // 恢復每行的顯示狀態
                        sortedRows.forEach((row, index) => {
                            const status = filterStatus.find(s => s.row === row);
                            if (status) {
                                row.style.display = status.display;
                                if (status.hidden) {
                                    row.classList.add('hidden');
                                } else {
                                    row.classList.remove('hidden');
                                }
                            }
                            tableBody.appendChild(row);
                        });
                        
                        // 確保分頁資訊更新但不重置頁面
                        const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        document.getElementById('totalRecords').textContent = visibleRows.length;
                        
                        // 刷新當前頁面顯示
                        const pagination = document.getElementById('pagination');
                        if (pagination) {
                            const currentPageElement = pagination.querySelector('.pagination-btn.active');
                            if (currentPageElement) {
                                const pageNumber = parseInt(currentPageElement.textContent);
                                const startRecord = document.getElementById('startRecord');
                                const endRecord = document.getElementById('endRecord');
                                const itemsPerPage = parseInt(document.getElementById('itemsPerPageSelect').value);
                                
                                const start = (pageNumber - 1) * itemsPerPage + 1;
                                const end = Math.min(start + itemsPerPage - 1, visibleRows.length);
                                
                                if (visibleRows.length === 0) {
                                    startRecord.textContent = '0';
                                    endRecord.textContent = '0';
                                } else {
                                    startRecord.textContent = start;
                                    endRecord.textContent = end;
                                }
                            }
                        }
                    }
                }
                
                // 生成隨機數據函數
                function generateRandomData(count) {
                    const tableBody = document.getElementById('dataTable');
                    const merchantIds = ['13589', '24671', '37824', '45912', '58763'];
                    const merchantNames = ['星辰体育', '极速赛车', '财富彩票', '金鹰彩店', '幸运星彩'];
                    const statuses = [
                        '<td class="text-green-600">成功</td>',
                        '<td class="text-red-600">失败</td>',
                        '<td class="text-amber-600">进行中</td>'
                    ];
                    
                    // 清空現有數據
                    tableBody.innerHTML = '';
                    
                    // 創建一個數組來存儲所有生成的行
                    const allRows = [];
                    
                    // 生成隨機日期（過去30天內）
                    function randomDate() {
                        const today = new Date();
                        const pastDay = new Date(today);
                        pastDay.setDate(today.getDate() - Math.floor(Math.random() * 30));
                        
                        const year = pastDay.getFullYear();
                        const month = String(pastDay.getMonth() + 1).padStart(2, '0');
                        const day = String(pastDay.getDate()).padStart(2, '0');
                        
                        return {
                            dateObj: pastDay,
                            dateStr: `${year}-${month}-${day}`
                        };
                    }
                    
                    // 生成6位數的隨機序號
                    function randomPlanId() {
                        return Math.floor(100000 + Math.random() * 900000);
                    }
                    
                    // 生成5位數的隨機用戶ID
                    function randomUserId() {
                        return Math.floor(10000 + Math.random() * 90000);
                    }
                    
                    // 生成隨機金額（100-2000）
                    function randomAmount() {
                        const amount = Math.floor(100 + Math.random() * 1900);
                        return amount > 999 
                            ? `${Math.floor(amount/1000)},${String(amount % 1000).padStart(3, '0')}`
                            : `${amount}`;
                    }
                    
                    // 生成隨機中獎金額（失敗為0，成功為投入金額的0.8-1.5倍）
                    function randomWinAmount(status, amount) {
                        if (status === 0) { // 成功狀態索引為0
                            const originalAmount = parseFloat(amount.replace(',', ''));
                            const multiplier = 0.8 + Math.random() * 0.7;
                            const winAmount = Math.floor(originalAmount * multiplier);
                            
                            return winAmount > 999 
                                ? `${Math.floor(winAmount/1000)},${String(winAmount % 1000).padStart(3, '0')}`
                                : `${winAmount}`;
                        } else {
                            return '0';
                        }
                    }
                    
                    // 生成行數據
                    for (let i = 0; i < count; i++) {
                        const dateInfo = randomDate();
                        const merchantIndex = Math.floor(Math.random() * merchantIds.length);
                        const merchantId = merchantIds[merchantIndex];
                        const planId = randomPlanId();
                        const initiatorId = randomUserId();
                        const participants = Math.floor(2 + Math.random() * 8); // 2-9人
                        const amount = randomAmount();
                        const statusIndex = Math.floor(Math.random() * statuses.length);
                        const winAmount = statusIndex === 0 ? randomWinAmount(statusIndex, amount) : '0'; // 只有成功狀態才有中獎金額
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${dateInfo.dateStr}</td>
                            <td>${merchantId}</td>
                            <td>${planId}</td>
                            <td>${initiatorId}</td>
                            <td>${participants}</td>
                            <td>${amount}</td>
                            ${statuses[statusIndex]}
                            <td>${winAmount}</td>
                        `;
                        
                        // 添加日期數據以便排序
                        row.setAttribute('data-date', dateInfo.dateObj.getTime());
                        allRows.push(row);
                    }
                    
                    // 按日期降序排序（最新的日期優先）
                    allRows.sort((a, b) => {
                        const dateA = parseInt(a.getAttribute('data-date'));
                        const dateB = parseInt(b.getAttribute('data-date'));
                        return dateB - dateA;
                    });
                    
                    // 將排序後的行添加到表格
                    allRows.forEach(row => {
                        tableBody.appendChild(row);
                    });
                }
                



        });
    </script>
    </div>
</body>
</html>