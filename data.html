<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆä¹°æ•°æ®åˆ†ææŠ¥è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <!-- æ›´æ–°FontAwesomeåˆ°æœ€æ–°ç©©å®šç‰ˆæœ¬ï¼Œæ·»åŠ å¤šå€‹CDNå‚™ç”¨ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <!-- å‚™ç”¨CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css" onerror="this.onerror=null;this.href='https://unpkg.com/@fortawesome/fontawesome-free@6.5.1/css/all.min.css';">
    
    <style>
        /* ç¢ºä¿å­—é«”åœ¨Macä¸Šæ­£ç¢ºé¡¯ç¤º */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            background-color: #f0f4f8;
            transition: background-color 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* ä¸­æ–‡å­—é«”å„ªåŒ– */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 'Helvetica Neue', Helvetica, Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', SimSun, sans-serif;
        }
        
        /* åœ–æ¨™å‚™ç”¨æ–¹æ¡ˆ */
        .icon-fallback {
            display: inline-block;
            width: 1em;
            height: 1em;
            text-align: center;
            line-height: 1;
        }
        
        /* ç•¶FontAwesomeæœªåŠ è¼‰æ™‚çš„å‚™ç”¨åœ–æ¨™ */
        .fa-chevron-down::before,
        .fas.fa-chevron-down::before {
            content: "â–¼";
            font-family: inherit;
            font-size: 0.8em;
        }
        
        .fa-chevron-up::before,
        .fas.fa-chevron-up::before {
            content: "â–²";
            font-family: inherit;
            font-size: 0.8em;
        }
        
        .fa-sun::before,
        .fas.fa-sun::before {
            content: "â˜€";
            font-family: inherit;
        }
        
        .fa-moon::before,
        .fas.fa-moon::before {
            content: "ğŸŒ™";
            font-family: inherit;
        }
        
        .fa-code::before,
        .fas.fa-code::before {
            content: "</>";
            font-family: inherit;
            font-size: 0.9em;
        }
        
        .fa-download::before,
        .fas.fa-download::before {
            content: "â¬‡";
            font-family: inherit;
        }
        
        .fa-sort::before,
        .fas.fa-sort::before {
            content: "â†•";
            font-family: inherit;
        }
        
        .fa-sort-up::before,
        .fas.fa-sort-up::before {
            content: "â†‘";
            font-family: inherit;
        }
        
        .fa-sort-down::before,
        .fas.fa-sort-down::before {
            content: "â†“";
            font-family: inherit;
        }
        
        .fa-copy::before,
        .fas.fa-copy::before {
            content: "ğŸ“„";
            font-family: inherit;
        }
        
        .fa-times::before,
        .fas.fa-times::before {
            content: "âœ•";
            font-family: inherit;
        }
        
        .fa-check::before,
        .fas.fa-check::before {
            content: "âœ“";
            font-family: inherit;
        }
        
        /* ç•¶FontAwesomeåŠ è¼‰æˆåŠŸæ™‚ï¼Œéš±è—å‚™ç”¨å…§å®¹ */
        .fa:not(.icon-fallback)::before,
        .fas:not(.icon-fallback)::before {
            font-family: "Font Awesome 6 Free", "Font Awesome 6 Pro", FontAwesome;
        }
        
        body.dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        
        /* ç¢ºä¿åœ¨å¤§å±å¹•ä¸Šç¯©é¸å€åŸŸä¸æ›è¡Œ */
        @media (min-width: 1600px) {
            .filter-container {
                flex-wrap: nowrap !important;
            }
            
            .filter-item {
                flex-shrink: 1;
                flex-grow: 0;
            }
        }
        
        /* ç‰¹åˆ¥é‡å°1912x1461å°ºå¯¸å„ªåŒ– */
        @media (min-width: 1900px) and (max-width: 1920px) {
            .filter-container {
                flex-wrap: nowrap !important;
                gap: 2px !important;
            }
            
            .filter-item {
                flex-shrink: 1;
                padding: 0 1px;
            }
            
            /* èª¿æ•´æ—¥æœŸç¯„åœå®¹å™¨å¯¬åº¦ */
            #dateRangeContainer {
                max-width: 290px;
            }
            
            /* å•†æˆ¶IDé¸æ“‡å™¨ç¸®å°ä¸€é» */
            .merchant-selector {
                max-width: 150px;
            }
            
            /* åºè™Ÿã€ç™¼èµ·äººå’Œåƒèˆ‡äººIDæ¬„ä½å¯¬åº¦èª¿æ•´ */
            .id-field {
                max-width: 110px;
                min-width: 90px;
            }
            
            /* æŒ‰éˆ•å€åŸŸå¯¬åº¦æ§åˆ¶ */
            .buttons-container {
                min-width: 390px;
            }
            
            /* æ¸›å°‘æŒ‰éˆ•é–“è· */
            .filter-button {
                margin-left: 3px !important;
                padding-left: 6px !important;
                padding-right: 6px !important;
            }
        }
        
        /* Macç³»çµ±ç‰¹å®šå„ªåŒ– */
        @media screen and (-webkit-min-device-pixel-ratio: 2) {
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }
        
        /* Macç³»çµ±å°ˆç”¨æ¨£å¼ */
        body.mac-system {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body.mac-system .card {
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
        }
        
        body.mac-system .card:hover {
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }
        
        /* Mac Safari ç‰¹å®šä¿®å¾© */
        @supports (-webkit-appearance: none) {
            select {
                -webkit-appearance: none;
                background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 0.75rem center;
                background-size: 16px 12px;
                padding-right: 2.5rem;
            }
            
            body.dark select {
                background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='none' stroke='%23e2e8f0' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3E%3C/svg%3E");
            }
        }
        
        /* ç•¶FontAwesomeæœªåŠ è¼‰æ™‚çš„å‚™ç”¨æ¨£å¼å¢å¼· */
        body.fa-fallback .fas,
        body.fa-fallback .fa {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: normal;
            font-style: normal;
        }
        
        /* è¡¨å–®å…ƒç´ çš„æ·±è‰²æ¨¡å¼æ¨£å¼ */
        input, select, button, label, .text-gray-600, .text-gray-700, .text-gray-500, .text-xs {
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        body.dark input, 
        body.dark select, 
        body.dark label, 
        body.dark .text-gray-600, 
        body.dark .text-gray-700,
        body.dark .text-gray-500 {
            color: #e2e8f0;
        }
        
        body.dark input, 
        body.dark select {
            background-color: #2d3748;
            border-color: #4a5568;
        }
        
        body.dark input::placeholder {
            color: #a0aec0;
        }
        
        /* Chart.js ç›¸é—œçš„æ·±è‰²æ¨¡å¼æ¨£å¼ */
        body.dark .chartjs-render-monitor {
            color: #e2e8f0 !important;
        }
        
        /* åˆ†é å’Œæ•¸æ“šè©³æƒ…å€åŸŸçš„æ·±è‰²æ¨¡å¼æ¨£å¼ */
        body.dark #pagination,
        body.dark #pageNumbers,
        body.dark #itemsPerPageSelect,
        body.dark .pagination-btn {
            color: #e2e8f0;
        }
        
        .filter-section {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark .filter-section {
            background-color: #2d3748;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        body.dark .card {
            background-color: #2d3748;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        body.dark .card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #64748b;
            transition: color 0.3s ease;
        }
        body.dark .stat-label {
            color: #a0aec0;
        }
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }
        body.dark .tab-active {
            color: #60a5fa;
        }
        .code-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .code-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .code-modal-content {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 50%;
            max-height: 80vh;
            max-width: 800px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        body.dark .code-modal-content {
            background-color: #1e293b;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        .code-content {
            background-color: #1e293b;
            color: #e2e8f0;
            border-radius: 0.375rem;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            overflow-x: auto;
            white-space: pre;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        body.dark .btn-primary {
            background-color: #4f46e5;
        }
        body.dark .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e2e8f0;
            color: #475569;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            background-color: #cbd5e1;
        }
        body.dark .btn-secondary {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark .btn-secondary:hover {
            background-color: #64748b;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* å›ºå®šè¡¨æ ¼å¸ƒå±€ */
        }
        th {
            background-color: #f8fafc;
            text-align: center;
            padding: 0.75rem 0.5rem;
            font-weight: 600;
            color: #475569;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            user-select: none;
            width: 12.5%; /* 8åˆ—ï¼Œæ¯åˆ—å¹³å‡å¯¬åº¦ */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        body.dark th {
            background-color: #1e293b;
            color: #e2e8f0;
            border-bottom: 1px solid #4a5568;
        }
        th:hover {
            background-color: #f1f5f9;
        }
        body.dark th:hover {
            background-color: #2d3748;
        }
        td {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: border-color 0.3s ease;
        }
        body.dark td {
            border-bottom: 1px solid #4a5568;
        }
        tr:hover {
            background-color: #f8fafc;
        }
        body.dark tr:hover {
            background-color: #2d3748;
        }
        .pagination-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 0.25rem;
            margin: 0 0.25rem;
        }
        .pagination-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .sort-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-left: 4px;
            vertical-align: middle;
        }
        .sort-icon.active {
            color: #3b82f6;
        }
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 1rem;
        }
        .rank-1 {
            background-color: #fcd34d;
            color: #92400e;
        }
        .rank-2 {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .rank-3 {
            background-color: #d97706;
            color: #fef3c7;
        }
        .rank-other {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .leaderboard-tab {
            cursor: pointer;
            padding: 0.5rem 1rem;
            font-weight: 500;
            border-bottom: 2px solid transparent;
        }
        .leaderboard-tab.active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            position: relative;
            z-index: 10;
        }
        
        body.dark .leaderboard-tab.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
        }
        .leaderboard-content {
            display: none;
        }
        .leaderboard-content.active {
            display: block;
        }
        .progress-bar {
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 3px;
        }
        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            transition: background-color 0.3s ease;
        }
        
        body.dark .range-slider {
            background: #4a5568;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        body.dark .range-slider::-webkit-slider-thumb {
            background: #60a5fa;
        }
        
        .range-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        body.dark .range-slider::-moz-range-thumb {
            background: #60a5fa;
        }
        
        .range-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 4px;
        }
        
        /* æ–°å¢çš„æŠ˜ç–Š/å±•é–‹åŠŸèƒ½å’Œç²¾ç°¡è¦–åœ–æ¨£å¼ */
        .collapsible {
            cursor: pointer;
        }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.expanded {
            max-height: 1000px;
        }
        .compact-card {
            padding: 0.5rem 0.75rem;
        }
        .compact-value {
            font-size: 1.1rem;
        }
        .compact-grid {
            gap: 0.5rem !important;
        }
        .compact-table td, .compact-table th {
            padding: 0.375rem 0.5rem;
            font-size: 0.875rem;
        }
        .compact-section {
            margin-bottom: 0.75rem;
        }
        
        /* ä¸»é¡Œåˆ‡æ›ç›¸é—œæ¨£å¼ */
        #themeToggle .theme-light {
            display: block;
            z-index: 10;
        }
        #themeToggle .theme-dark {
            display: none;
            z-index: 10;
        }
        body.dark #themeToggle .theme-light {
            display: none;
        }
        body.dark #themeToggle .theme-dark {
            display: block;
        }
        #themeToggle {
            cursor: pointer;
            overflow: visible;
        }
        
        #themeToggle .fa-moon {
            color: #ffffff;
        }
        
        /* æ•¸æ“šè©³æƒ…å€åŸŸæ–‡å­—é¡è‰² */
        .text-xs.text-gray-600 {
            transition: color 0.3s ease;
        }
        
        body.dark .text-xs.text-gray-600 {
            color: #a0aec0;
        }
        
        body.dark select option {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        
        /* é«˜ç´šç¯©é¸åˆ†éš”ç·š */
        .border-custom {
            border-top-color: #cbd5e1;
            transition: border-color 0.3s ease;
        }
        
        body.dark .border-custom {
            border-top-color: #4a5568;
        }
        
        /* æ’è¡Œæ¦œåˆ†éš”ç·š */
        .border-b {
            border-bottom-color: #e2e8f0;
            transition: border-color 0.3s ease;
        }
        
        body.dark .border-b {
            border-bottom-color: #4a5568;
        }
        
        /* TABåˆ‡æ›ç›¸é—œæ¨£å¼ */
        .tab-button {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .tab-button.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
        }
        
        body.dark .tab-button.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ç”¨æˆ¶æŒ‡æ¨™è¡¨æ ¼æ¨£å¼ */
        .user-table th {
            width: 14.28%; /* 7åˆ—ï¼Œæ¯åˆ—å¹³å‡å¯¬åº¦ */
        }
        
        .user-table th.wide-column {
            width: 16.67%; /* 6åˆ—ï¼Œæ¯åˆ—å¹³å‡å¯¬åº¦ */
        }
    </style>
    
    <!-- æ·»åŠ å­—é«”åŠ è¼‰æª¢æ¸¬è…³æœ¬ -->
    <script>
        // æª¢æ¸¬FontAwesomeæ˜¯å¦åŠ è¼‰æˆåŠŸ
        function checkFontAwesome() {
            const testElement = document.createElement('i');
            testElement.className = 'fas fa-home';
            testElement.style.position = 'absolute';
            testElement.style.left = '-9999px';
            document.body.appendChild(testElement);
            
            const computedStyle = window.getComputedStyle(testElement, ':before');
            const isLoaded = computedStyle.getPropertyValue('font-family').indexOf('Font Awesome') !== -1;
            
            document.body.removeChild(testElement);
            
            if (!isLoaded) {
                console.warn('FontAwesomeæœªèƒ½æ­£ç¢ºåŠ è¼‰ï¼Œä½¿ç”¨å‚™ç”¨åœ–æ¨™');
                document.body.classList.add('fa-fallback');
            }
        }
        
        // é é¢åŠ è¼‰å®Œæˆå¾Œæª¢æ¸¬
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkFontAwesome, 1000);
        });
    </script>
</head>
<body data-new-gr-c-s-check-loaded="14.1105.0" data-gr-ext-installed="">
    <div class="container mx-auto px-3 py-4">
        <!-- ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• -->
        <div class="fixed top-4 right-16 z-50">
            <button id="themeToggle" class="bg-gray-200 dark:bg-gray-700 rounded-full p-2 shadow-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all flex items-center justify-center w-10 h-10 relative">
                <i class="fas fa-sun text-xl text-yellow-500 theme-light absolute"></i>
                <i class="fas fa-moon text-xl text-white theme-dark absolute"></i>
            </button>
        </div>
        
        <!-- å¼€å‘è€…ä¿¡æ¯æŒ‰é’® -->
        <div class="fixed top-20 right-16 z-50">
            <button id="devInfoBtn" class="bg-gray-800 text-white rounded-full p-2 shadow-lg hover:bg-gray-700 transition-all flex items-center justify-center w-10 h-10 relative">
                <i class="fas fa-code"></i>
            </button>
        </div>

        <!-- ç­›é€‰æ¡ä»¶ -->
        <div class="filter-section p-3 mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer collapsible" id="filterToggle">
                <div class="flex items-center space-x-4">
                    <button class="tab-button active px-3 py-1 text-sm font-medium border-b-2 border-blue-500 text-blue-600" data-tab="groupbuy">åˆä¹°æŒ‡æ ‡</button>
                    <button class="tab-button px-3 py-1 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="user">ç”¨æˆ·æŒ‡æ ‡</button>
                </div>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="collapsible-content expanded" id="filterContent">
                <!-- åˆä¹°æŒ‡æ ‡ç­›é€‰ -->
                <div class="tab-content active" id="groupbuy-filter">
                    <div class="flex flex-wrap md:flex-wrap items-center gap-3 filter-container">
                        <div class="w-full md:w-auto filter-item" style="min-width: 110px; max-width: 130px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">æ—¶é—´ç»´åº¦</label>
                            <select id="timeGranularity" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="day">æŒ‰å¤©</option>
                                <option value="week">æŒ‰å‘¨</option>
                                <option value="month">æŒ‰æœˆ</option>
                            </select>
                        </div>
                        <div class="w-full md:w-auto flex-grow filter-item" id="dateRangeContainer" style="max-width: 310px; min-width: 270px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">æ—¥æœŸèŒƒå›´</label>
                            <div class="flex items-center gap-1" id="daySelector">
                                <input type="date" id="startDate" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                <span>è‡³</span>
                                <input type="date" id="endDate" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                            </div>
                            <div class="flex items-center gap-1 hidden" id="weekSelector">
                                <input type="week" id="startWeek" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                <span>è‡³</span>
                                <input type="week" id="endWeek" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                            </div>
                            <div class="flex items-center gap-1 hidden" id="monthSelector">
                                <input type="month" id="startMonth" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                <span>è‡³</span>
                                <input type="month" id="endMonth" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                            </div>
                        </div>
                        <div class="w-full md:w-auto filter-item" style="min-width: 150px; max-width: 160px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">å•†æˆ·ID</label>
                            <select id="merchantId" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-ellipsis merchant-selector">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="13589">13589 - æ˜Ÿè¾°ä½“è‚²</option>
                                <option value="24671">24671 - æé€Ÿèµ›è½¦</option>
                                <option value="37824">37824 - è´¢å¯Œå½©ç¥¨</option>
                                <option value="45912">45912 - é‡‘é¹°å½©åº—</option>
                                <option value="58763">58763 - å¹¸è¿æ˜Ÿå½©</option>
                            </select>
                        </div>
                        <div class="w-full md:w-auto md:flex-shrink-0 md:flex-grow-0 flex-nowrap whitespace-nowrap filter-item buttons-container" style="min-width: 370px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">æ“ä½œ</label>
                            <div class="flex items-center flex-nowrap">
                                <button id="filterBtn" class="btn-primary px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button" style="width: 56px;">æœç´¢</button>
                                <button id="resetBtn" class="btn-secondary px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button" style="width: 56px;">é‡ç½®</button>
                                <button id="exportBtn" class="px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button bg-green-500 hover:bg-green-600 text-white transition" style="width: 56px;">
                                    <i class="fas fa-download mr-1"></i>å¯¼å‡º
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç”¨æˆ·æŒ‡æ ‡ç­›é€‰ -->
                <div class="tab-content hidden" id="user-filter">
                    <div class="flex flex-wrap md:flex-wrap items-center gap-3 filter-container">
                        <div class="w-full md:w-auto filter-item" style="min-width: 110px; max-width: 130px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">æ—¶é—´ç»´åº¦</label>
                            <select id="userTimeGranularity" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="day">æŒ‰å¤©</option>
                                <option value="week">æŒ‰å‘¨</option>
                                <option value="month">æŒ‰æœˆ</option>
                            </select>
                        </div>
                        <div class="w-full md:w-auto flex-grow filter-item" id="userDateRangeContainer" style="max-width: 310px; min-width: 270px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">æ—¥æœŸèŒƒå›´</label>
                            <div class="flex items-center gap-1" id="userDaySelector">
                                <input type="date" id="userStartDate" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                <span>è‡³</span>
                                <input type="date" id="userEndDate" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                            </div>
                            <div class="flex items-center gap-1 hidden" id="userWeekSelector">
                                <input type="week" id="userStartWeek" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                <span>è‡³</span>
                                <input type="week" id="userEndWeek" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                            </div>
                            <div class="flex items-center gap-1 hidden" id="userMonthSelector">
                                <input type="month" id="userStartMonth" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                <span>è‡³</span>
                                <input type="month" id="userEndMonth" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                            </div>
                        </div>
                        <div class="w-full md:w-auto filter-item" style="min-width: 150px; max-width: 160px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">å•†æˆ·ID</label>
                            <select id="userMerchantId" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-ellipsis merchant-selector">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="13589">13589 - æ˜Ÿè¾°ä½“è‚²</option>
                                <option value="24671">24671 - æé€Ÿèµ›è½¦</option>
                                <option value="37824">37824 - è´¢å¯Œå½©ç¥¨</option>
                                <option value="45912">45912 - é‡‘é¹°å½©åº—</option>
                                <option value="58763">58763 - å¹¸è¿æ˜Ÿå½©</option>
                            </select>
                        </div>
                        <div class="w-full md:w-auto filter-item" style="min-width: 180px; max-width: 200px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">æŒ‡æ ‡ç»´åº¦</label>
                            <select id="userMetricType" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="initiate">å‘èµ·åˆä¹°</option>
                                <option value="participate">å‚ä¸åˆä¹°</option>
                            </select>
                        </div>
                        <div class="w-full md:w-auto filter-item" style="min-width: 100px; max-width: 120px;" id="userIdFilterContainer">
                            <label class="block text-xs font-medium text-gray-700 mb-1" id="userIdFilterLabel">å‘èµ·äººID</label>
                            <input type="text" id="userIdFilter" placeholder="è¾“å…¥IDæˆ–ç•™ç©º" class="w-full text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 id-field">
                        </div>
                        <div class="w-full md:w-auto md:flex-shrink-0 md:flex-grow-0 flex-nowrap whitespace-nowrap filter-item buttons-container" style="min-width: 370px;">
                            <label class="block text-xs font-medium text-gray-700 mb-1">æ“ä½œ</label>
                            <div class="flex items-center flex-nowrap">
                                <button id="userFilterBtn" class="btn-primary px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button" style="width: 56px;">æœç´¢</button>
                                <button id="userResetBtn" class="btn-secondary px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button" style="width: 56px;">é‡ç½®</button>
                                <button id="userExportBtn" class="px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button bg-green-500 hover:bg-green-600 text-white transition" style="width: 56px;">
                                    <i class="fas fa-download mr-1"></i>å¯¼å‡º
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
        <div class="mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer collapsible" id="coreMetricsToggle">
                <h2 class="text-sm font-semibold">æ ¸å¿ƒæŒ‡æ ‡</h2>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="collapsible-content expanded" id="coreMetricsContent">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <div class="card p-3">
                        <div class="stat-label text-xs">åˆä¹°æ€»å‘èµ·æ¬¡æ•°</div>
                        <div class="stat-value text-blue-600 text-lg font-semibold" id="totalPlans">100</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+5.2%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">åˆä¹°æˆåŠŸæ¬¡æ•°</div>
                        <div class="stat-value text-green-600 text-lg font-semibold" id="successPlans">42</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+3.8%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">åˆä¹°æ€»é‡‘é¢</div>
                        <div class="stat-value text-purple-600 text-lg font-semibold" id="totalAmount">57,997</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+7.1%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">åˆä¹°ä¸­å¥–ç‡</div>
                        <div class="stat-value text-amber-600 text-lg font-semibold" id="winRate">42.0%</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-red-500">-1.2%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆä¹°æ•´ä½“æ•°æ®å¡ç‰‡ -->
        <div class="mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer collapsible" id="overallDataToggle">
                <h2 class="text-sm font-semibold">åˆä¹°æ•´ä½“æ•°æ®</h2>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="collapsible-content expanded" id="overallDataContent">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <div class="card p-3">
                        <div class="stat-label text-xs">åˆä¹°å‚ä¸æ€»äººæ¬¡</div>
                        <div class="stat-value text-indigo-600 text-lg font-semibold" id="totalParticipants">502</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+4.3%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">åˆä¹°å¹³å‡å‘èµ·é‡‘é¢</div>
                        <div class="stat-value text-teal-600 text-lg font-semibold" id="avgInitAmount">580.0</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+2.1%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">å¹³å‡å‚ä¸äººæ•°/å•</div>
                        <div class="stat-value text-cyan-600 text-lg font-semibold" id="avgParticipantsPerPlan">5.0</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-red-500">-0.3%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">äººå‡åˆä¹°å‚ä¸æ¬¡æ•°</div>
                        <div class="stat-value text-emerald-600 text-lg font-semibold" id="avgParticipationTimes">1.0</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+1.8%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">äººå‡åˆä¹°æŠ•å…¥é‡‘é¢</div>
                        <div class="stat-value text-rose-600 text-lg font-semibold" id="avgInvestAmount">115.5</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+3.5%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">åˆä¹°ä¸­å¥–é‡‘é¢æ€»è®¡</div>
                        <div class="stat-value text-amber-600 text-lg font-semibold" id="totalWinAmount">33,885</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+8.7%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">å¹³å‡ä¸­å¥–é‡‘é¢/å•</div>
                        <div class="stat-value text-orange-600 text-lg font-semibold" id="avgWinAmount">806.8</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+5.2%</span></div>
                    </div>
                    <div class="card p-3">
                        <div class="stat-label text-xs">åˆä¹°æ´»è·ƒç”¨æˆ·æ•°</div>
                        <div class="stat-value text-blue-600 text-lg font-semibold" id="activeUsers">495</div>
                        <div class="text-xs text-gray-500 mt-1">è¾ƒä¸ŠæœŸ <span class="text-green-500">+2.9%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç”¨æˆ·æŒ‡æ ‡å›¾è¡¨åŒºåŸŸï¼ˆä»…åœ¨ç”¨æˆ·æŒ‡æ ‡TABæ—¶æ˜¾ç¤ºï¼‰ -->
        <div class="card p-3 mb-4 hidden" id="userChartArea">
            <div class="flex justify-between items-center mb-2 cursor-pointer" id="userChartToggle">
                <h2 class="text-sm font-semibold">è¶‹åŠ¿åˆ†æ</h2>
                <div class="flex items-center" id="chartDimensionTabs">
                    <!-- å‹•æ…‹ç”Ÿæˆçš„åœ–è¡¨ç¶­åº¦æ¨™ç±¤ -->
                </div>
            </div>
            <div class="collapsible-content expanded" id="userChartContent">
                <div style="height: 250px; width: 100%;">
                    <canvas id="trendChart" width="800" height="250"></canvas>
                </div>
            </div>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="card p-3 mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer collapsible" id="tableToggle">
                <h2 class="text-sm font-semibold">æ•°æ®è¯¦æƒ…</h2>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="collapsible-content expanded" id="tableContent">
                <!-- åˆä¹°æŒ‡æ ‡è¡¨æ ¼ -->
                <div class="table-container" id="groupbuy-table">
                    <div class="flex justify-between items-center mb-2" style="align-items: center;">
                        <div class="flex items-center" style="height: 40px;">
                            <span class="text-xs text-gray-600 mr-2">æ¯é¡µæ˜¾ç¤º:</span>
                            <select id="itemsPerPageSelect" class="rounded-md border border-gray-300 px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="10">10æ¡</option>
                                <option value="30">30æ¡</option>
                                <option value="50">50æ¡</option>
                                <option value="100">100æ¡</option>
                            </select>
                        </div>
                        <div class="flex flex-wrap gap-2 items-center ml-6" id="groupbuy-table-filter" style="justify-content: flex-start; align-items: center; flex: 1; margin-top: 0; margin-bottom: 0; min-height: 40px;">
                            <div class="filter-item" style="min-width: 110px; max-width: 130px;">
                                <label class="block text-xs font-medium text-gray-700 mb-1">æ—¶é—´ç»´åº¦</label>
                                <select id="tableTimeGranularity" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="day">æŒ‰å¤©</option>
                                    <option value="week">æŒ‰å‘¨</option>
                                    <option value="month">æŒ‰æœˆ</option>
                                </select>
                            </div>
                            <div class="filter-item" style="max-width: 310px; min-width: 170px;">
                                <label class="block text-xs font-medium text-gray-700 mb-1">æ—¥æœŸèŒƒå›´</label>
                                <div class="flex items-center gap-1" id="tableDaySelector">
                                    <input type="date" id="tableStartDate" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                    <span>è‡³</span>
                                    <input type="date" id="tableEndDate" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                </div>
                                <div class="flex items-center gap-1 hidden" id="tableWeekSelector">
                                    <input type="week" id="tableStartWeek" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                    <span>è‡³</span>
                                    <input type="week" id="tableEndWeek" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                </div>
                                <div class="flex items-center gap-1 hidden" id="tableMonthSelector">
                                    <input type="month" id="tableStartMonth" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                    <span>è‡³</span>
                                    <input type="month" id="tableEndMonth" class="text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 48%;">
                                </div>
                            </div>
                            <div class="filter-item" style="min-width: 150px; max-width: 160px;">
                                <label class="block text-xs font-medium text-gray-700 mb-1">å•†æˆ·ID</label>
                                <select id="tableMerchantId" class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-ellipsis merchant-selector">
                                    <option value="all">å…¨éƒ¨</option>
                                    <option value="13589">13589 - æ˜Ÿè¾°ä½“è‚²</option>
                                    <option value="24671">24671 - æé€Ÿèµ›è½¦</option>
                                    <option value="37824">37824 - è´¢å¯Œå½©ç¥¨</option>
                                    <option value="45912">45912 - é‡‘é¹°å½©åº—</option>
                                    <option value="58763">58763 - å¹¸è¿æ˜Ÿå½©</option>
                                </select>
                            </div>
                            <div class="filter-item" style="min-width: 120px; max-width: 140px;">
                                <label class="block text-xs font-medium text-gray-700 mb-1">åˆä¹°åºå·</label>
                                <input type="text" id="tablePlanId" placeholder="è¾“å…¥åºå·æˆ–ç•™ç©º" class="w-full text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 id-field">
                            </div>
                            <div class="filter-item" style="min-width: 100px; max-width: 120px;">
                                <label class="block text-xs font-medium text-gray-700 mb-1">å‘èµ·äººID</label>
                                <input type="text" id="tableInitiatorId" placeholder="è¾“å…¥IDæˆ–ç•™ç©º" class="w-full text-sm rounded-md border border-gray-300 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 id-field">
                            </div>
                            <div class="flex items-center flex-nowrap mt-6 md:mt-0 self-center" style="align-items: center; height: 40px; margin-top: 18px;">
                                <button id="tableFilterBtn" class="btn-primary px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button" style="width: 56px;">æœç´¢</button>
                                <button id="tableResetBtn" class="btn-secondary px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button" style="width: 56px;">é‡ç½®</button>
                                <button id="tableExportBtn" class="px-2 py-1 text-sm rounded-md ml-3 whitespace-nowrap filter-button bg-green-500 hover:bg-green-600 text-white transition" style="width: 56px;">
                                    <i class="fas fa-download mr-1"></i>å¯¼å‡º
                                </button>
                            </div>
                        </div>
                    </div>
                    <table class="min-w-full compact-table">
                        <thead>
                            <tr>
                                <th data-sort="date">
                                    æ—¥æœŸ
                                    <span class="sort-icon active"><i class="fas fa-sort-down"></i></span>
                                </th>
                                <th>å•†æˆ·ID</th>
                                <th>åˆä¹°åºå·</th>
                                <th>å‘èµ·äººID</th>
                                <th data-sort="participants">
                                    å‚ä¸äººæ•°
                                    <span class="sort-icon"><i class="fas fa-sort"></i></span>
                                </th>
                                <th data-sort="amount">
                                    åˆä¹°æ€»é‡‘é¢
                                    <span class="sort-icon"><i class="fas fa-sort"></i></span>
                                </th>
                                <th>åˆä¹°çŠ¶æ€</th>
                                <th data-sort="winAmount">
                                    ä¸­å¥–é‡‘é¢
                                    <span class="sort-icon"><i class="fas fa-sort"></i></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="dataTable">
                            <!-- åŠ¨æ€ç”Ÿæˆçš„æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </tbody>
                    </table>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-xs text-gray-600">
                            æ˜¾ç¤º <span id="startRecord">1</span> åˆ° <span id="endRecord">10</span> æ¡ï¼Œå…± <span id="totalRecords">100</span> æ¡è®°å½•
                        </div>
                        <div class="flex items-center" id="pagination">
                            <button class="pagination-btn btn-secondary text-xs py-1" id="prevPage" disabled>ä¸Šä¸€é¡µ</button>
                            <div id="pageNumbers" class="flex">
                                <button class="pagination-btn active text-xs py-1">1</button>
                                <button class="pagination-btn btn-secondary text-xs py-1">2</button>
                                <button class="pagination-btn btn-secondary text-xs py-1">3</button>
                                <button class="pagination-btn btn-secondary text-xs py-1">4</button>
                                <button class="pagination-btn btn-secondary text-xs py-1">5</button>
                            </div>
                            <button class="pagination-btn btn-secondary text-xs py-1" id="nextPage">ä¸‹ä¸€é¡µ</button>
                        </div>
                    </div>
                </div>

                <!-- ç”¨æˆ·æŒ‡æ ‡è¡¨æ ¼ -->
                <div class="table-container hidden" id="user-table">
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex items-center">
                            <span class="text-xs text-gray-600 mr-2">æ¯é¡µæ˜¾ç¤º:</span>
                            <select id="userItemsPerPageSelect" class="rounded-md border border-gray-300 px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="10">10æ¡</option>
                                <option value="30">30æ¡</option>
                                <option value="50">50æ¡</option>
                                <option value="100">100æ¡</option>
                            </select>
                        </div>
                    </div>
                    <table class="min-w-full compact-table user-table">
                        <thead id="userTableHeader">
                            <!-- å‹•æ…‹ç”Ÿæˆçš„è¡¨æ ¼æ¨™é¡Œ -->
                        </thead>
                        <tbody id="userDataTable">
                            <!-- åŠ¨æ€ç”Ÿæˆçš„ç”¨æˆ·æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </tbody>
                    </table>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-xs text-gray-600">
                            æ˜¾ç¤º <span id="userStartRecord">1</span> åˆ° <span id="userEndRecord">10</span> æ¡ï¼Œå…± <span id="userTotalRecords">100</span> æ¡è®°å½•
                        </div>
                        <div class="flex items-center" id="userPagination">
                            <button class="pagination-btn btn-secondary text-xs py-1" id="userPrevPage" disabled>ä¸Šä¸€é¡µ</button>
                            <div id="userPageNumbers" class="flex">
                                <button class="pagination-btn active text-xs py-1">1</button>
                                <button class="pagination-btn btn-secondary text-xs py-1">2</button>
                                <button class="pagination-btn btn-secondary text-xs py-1">3</button>
                                <button class="pagination-btn btn-secondary text-xs py-1">4</button>
                                <button class="pagination-btn btn-secondary text-xs py-1">5</button>
                            </div>
                            <button class="pagination-btn btn-secondary text-xs py-1" id="userNextPage">ä¸‹ä¸€é¡µ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- ä»£ç æ¨¡æ€æ¡† -->
        <div id="codeModal" class="code-modal">
            <div class="code-modal-content">
                <div class="flex flex-col h-full">
                    <div class="p-3 border-b flex justify-between items-center">
                        <h3 class="text-sm font-semibold">å¼€å‘è€…ä¿¡æ¯ - æºä»£ç  V2.0</h3>
                        <div class="flex items-center">
                            <button id="copyCodeBtn" class="btn-primary px-3 py-1 text-sm rounded-md mr-2">
                                <i class="fas fa-copy mr-1"></i> å¤åˆ¶ä»£ç 
                            </button>
                            <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="overflow-auto p-3" style="max-height: calc(80vh - 60px);">
                        <pre id="codeContent" class="code-content p-3 text-sm">/**
 * åˆè²·æ•¸æ“šåˆ†æå ±è¡¨ V2.0
 * æ›´æ–°æ—¥æœŸ: 2024-12-19
 * 
 * æ›´æ–°å…§å®¹ï¼š
 * - ç§»é™¤åˆè²·æŒ‡æ¨™çš„è¶¨å‹¢åˆ†æåœ–è¡¨ï¼Œä¿ç•™ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨åŠŸèƒ½
 * - ä¿®å¾©åˆè²·æŒ‡æ¨™è¡¨æ ¼æ’åºåŠŸèƒ½ï¼Œç¢ºä¿æ‰€æœ‰æ’åºæŒ‰éˆ•æ­£å¸¸å·¥ä½œ
 * - å„ªåŒ–TABåˆ‡æ›é‚è¼¯ï¼Œåˆè²·æŒ‡æ¨™å’Œç”¨æˆ¶æŒ‡æ¨™ç¨ç«‹ç®¡ç†
 * - æ”¹é€²è¡¨æ ¼åˆ†é å’Œç¯©é¸åŠŸèƒ½çš„å…¼å®¹æ€§
 * - å¢å¼·Macç³»çµ±å’Œæ·±è‰²æ¨¡å¼çš„æ”¯æŒ
 * 
 * æ”¯æŒåŠŸèƒ½:
 * - åˆè²·æŒ‡æ¨™ï¼šæ•¸æ“šç¯©é¸ã€è¡¨æ ¼æ’åºã€åˆ†é ã€å°å‡ºåŠŸèƒ½
 * - ç”¨æˆ¶æŒ‡æ¨™ï¼šå®Œæ•´åœ–è¡¨åˆ†æã€æ•¸æ“šç¯©é¸ã€è¡¨æ ¼æ’åºã€åˆ†é ã€å°å‡º
 * - éŸ¿æ‡‰å¼è¨­è¨ˆã€æš—é»‘æ¨¡å¼åˆ‡æ›
 * - Mac Safariå…¼å®¹æ€§å„ªåŒ–
 * - FontAwesomeåœ–æ¨™å‚™ç”¨æ–¹æ¡ˆ
 */
&lt;html lang="zh-CN"&gt;...å®Œæ•´ä»£ç å†…å®¹...&lt;/html&gt;</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ  JavaScript ä»£ç  -->
        <script>
            // å…¨å±€å‡½æ•¸å®šç¾©
            function getWeekNumber(date) {
                const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
                const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
                return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
            }

            // æ ¼å¼åŒ–æ¨™ç±¤
            function formatLabel(key, timeGranularity) {
                if (timeGranularity === 'day') {
                    // æ—¥æœŸæ ¼å¼ï¼šMM/DD
                    const parts = key.split('-');
                    return `${parts[1]}/${parts[2]}`;
                } else if (timeGranularity === 'week') {
                    // é€±æ ¼å¼ï¼šWeek WW
                    const weekNumber = key.split('-W')[1];
                    return `ç¬¬${weekNumber}é€±`;
                } else if (timeGranularity === 'month') {
                    // æœˆä»½æ ¼å¼ï¼šYYYY/MM
                    const parts = key.split('-');
                    return `${parts[0]}/${parts[1]}`;
                }
                return key;
            }

            // ç²å–æŒ‡æ¨™æ¨™ç±¤
            function getMetricLabel(metricType) {
                switch(metricType) {
                    case 'initiate': return 'å‘èµ·åˆä¹°';
                    case 'participate': return 'å‚ä¸åˆä¹°';
                    case 'success_rate': return 'åˆä¹°å¸¦å•æˆåŠŸç‡';
                    case 'avg_amount': return 'åˆä¹°å¹³å‡å¸¦å•é‡‘é¢';
                    case 'initiate_count': return 'å‘èµ·åˆä¹°æ¬¡æ•°';
                    case 'participate_count': return 'å‚ä¸åˆä¹°æ¬¡æ•°';
                    case 'win_rate': return 'å‘èµ·çš„åˆä¹°èƒœç‡';
                    case 'participate_win_rate': return 'å‚ä¸åˆä¹°èƒœç‡';
                    case 'avg_bet_amount': return 'å¹³å‡åˆä¹°æŠ•æ³¨é‡‘é¢';
                    case 'avg_win_amount': return 'å¹³å‡åˆä¹°ä¸­å¥–é‡‘é¢';
                    case 'win_amount': return 'ä¸­å¥–é‡‘é¢';
                    default: return 'æŒ‡æ ‡';
                }
            }

            // å…¨å±€ç”¨æˆ¶è¡¨æ ¼æ¨™é¡Œæ›´æ–°å‡½æ•¸
            function updateUserTableHeaders(metricType) {
                const tableHeader = document.getElementById('userTableHeader');
                let headerHTML = '';
                
                if (metricType === 'initiate') {
                    // å‘èµ·åˆä¹°æ¬¡æ•°æ ä½
                    headerHTML = `
                        <tr>
                            <th data-sort="date">
                                æ—¥æœŸ
                                <span class="sort-icon active"><i class="fas fa-sort-down"></i></span>
                            </th>
                            <th>å•†æˆ·ID</th>
                            <th>å‘èµ·äººID</th>
                            <th data-sort="count">
                                å‘èµ·åˆä¹°æ¬¡æ•°
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th data-sort="rate">
                                åˆä¹°å¸¦å•æˆåŠŸç‡
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th data-sort="amount">
                                åˆä¹°å¹³å‡å¸¦å•é‡‘é¢
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th data-sort="winRate">
                                å‘èµ·çš„åˆä¹°èƒœç‡
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                        </tr>
                    `;
                } else if (metricType === 'participate') {
                    // å‚ä¸åˆä¹°æ¬¡æ•°æ ä½
                    headerHTML = `
                        <tr>
                            <th data-sort="date">
                                æ—¥æœŸ
                                <span class="sort-icon active"><i class="fas fa-sort-down"></i></span>
                            </th>
                            <th>å•†æˆ·ID</th>
                            <th>ç”¨æˆ·ID</th>
                            <th data-sort="count">
                                å‚ä¸åˆä¹°æ¬¡æ•°
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th data-sort="rate">
                                å‚ä¸åˆä¹°èƒœç‡
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th data-sort="amount">
                                å¹³å‡åˆä¹°æŠ•æ³¨é‡‘é¢
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th data-sort="avgWin">
                                å¹³å‡åˆä¹°ä¸­å¥–é‡‘é¢
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                            <th data-sort="totalWin">
                                æ€»ä¸­å¥–é‡‘é¢
                                <span class="sort-icon"><i class="fas fa-sort"></i></span>
                            </th>
                        </tr>
                    `;
                }
                
                tableHeader.innerHTML = headerHTML;
                
                // é‡æ–°åˆå§‹åŒ–ç”¨æˆ¶è¡¨æ ¼æ’åºï¼Œå› ç‚ºè¡¨æ ¼æ¨™é¡Œå·²é‡æ–°ç”Ÿæˆ
                setTimeout(() => {
                    initUserTableSorting();
                }, 50);
            }



            // ç²å–Xè»¸æ¨™é¡Œ
            function getXAxisTitle(timeGranularity) {
                if (timeGranularity === 'day') {
                    return 'æ—¥æœŸ (æœˆ/æ—¥)';
                } else if (timeGranularity === 'week') {
                    return 'é€±æ•¸';
                } else if (timeGranularity === 'month') {
                    return 'æœˆä»½ (å¹´/æœˆ)';
                }
                return 'æ—¥æœŸ';
            }

            // å¾¹åº•éŠ·æ¯€æ‰€æœ‰åœ–è¡¨å¯¦ä¾‹
            function destroyAllCharts() {
                // éŠ·æ¯€ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨
                if (window.userChart) {
                    try {
                        window.userChart.destroy();
                    } catch (e) {
                        console.warn('Error destroying user chart:', e);
                    }
                    window.userChart = null;
                }
                
                // æ¸…ç†Chart.jsçš„å…§éƒ¨è¨»å†Šè¡¨ï¼ˆé©ç”¨æ–¼Chart.js 3.xï¼‰
                const canvas = document.getElementById('trendChart');
                if (canvas && typeof Chart !== 'undefined') {
                    try {
                        // Chart.js 3.x ä½¿ç”¨ Chart.getChart() ä¾†ç²å–canvasä¸Šçš„åœ–è¡¨å¯¦ä¾‹
                        const existingChart = Chart.getChart(canvas);
                        if (existingChart) {
                            console.log('Found existing chart, destroying...');
                            existingChart.destroy();
                        }
                    } catch (e) {
                        console.warn('Error clearing Chart.js registry:', e);
                    }
                }
                
                console.log('All charts destroyed');
            }



            // æ ¹æ“šç¶­åº¦æ›´æ–°ç”¨æˆ¶åœ–è¡¨
            function updateUserChartByDimension(chartType) {
                if (typeof updateUserChart === 'function') {
                    // å­˜å„²ç•¶å‰é¸ä¸­çš„åœ–è¡¨ç¶­åº¦
                    window.currentUserChartType = chartType;
                    updateUserChart();
                } else {
                    console.warn('updateUserChart function not available');
                }
            }

            // æ›´æ–°åœ–è¡¨ç¶­åº¦æ¨™ç±¤ï¼ˆåƒ…ç”¨æ–¼ç”¨æˆ¶æŒ‡æ¨™ï¼‰
            function updateChartDimensionTabs(tabType, metricType) {
                const chartDimensionTabs = document.getElementById('chartDimensionTabs');
                let tabsHTML = '';
                
                if (tabType === 'user') {
                    if (metricType === 'initiate') {
                        // ç™¼èµ·åˆè²·æ¬¡æ•¸ç¶­åº¦ - åƒè€ƒåˆè²·æŒ‡æ¨™æ¨¡å¼ï¼Œæä¾›å®Œæ•´çš„ç¶­åº¦é¸é …
                        tabsHTML = `
                            <button class="chart-tab tab-active px-2 py-1 text-xs" data-chart="initiate_count">å‘èµ·åˆä¹°æ¬¡æ•°</button>
                            <button class="chart-tab px-2 py-1 text-xs" data-chart="success_rate">åˆä¹°å¸¦å•æˆåŠŸç‡</button>
                            <button class="chart-tab px-2 py-1 text-xs" data-chart="avg_amount">å¹³å‡å¸¦å•é‡‘é¢</button>
                            <button class="chart-tab px-2 py-1 text-xs" data-chart="win_rate">å‘èµ·çš„åˆä¹°èƒœç‡</button>
                        `;
                    } else if (metricType === 'participate') {
                        // åƒèˆ‡åˆè²·æ¬¡æ•¸ç¶­åº¦ - åƒè€ƒåˆè²·æŒ‡æ¨™æ¨¡å¼ï¼Œæä¾›å®Œæ•´çš„ç¶­åº¦é¸é …
                        tabsHTML = `
                            <button class="chart-tab tab-active px-2 py-1 text-xs" data-chart="participate_count">å‚ä¸åˆä¹°æ¬¡æ•°</button>
                            <button class="chart-tab px-2 py-1 text-xs" data-chart="participate_win_rate">å‚ä¸åˆä¹°èƒœç‡</button>
                            <button class="chart-tab px-2 py-1 text-xs" data-chart="avg_bet_amount">å¹³å‡åˆä¹°æŠ•æ³¨é‡‘é¢</button>
                            <button class="chart-tab px-2 py-1 text-xs" data-chart="avg_win_amount">å¹³å‡åˆä¹°ä¸­å¥–é‡‘é¢</button>
                        `;
                    }
                    
                    chartDimensionTabs.innerHTML = tabsHTML;
                    
                    // ç‚ºæ–°ç”Ÿæˆçš„æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
                    const chartTabs = chartDimensionTabs.querySelectorAll('.chart-tab');
                    chartTabs.forEach(tab => {
                        tab.addEventListener('click', function() {
                            // ç§»é™¤å…¶ä»–æŒ‰éˆ•çš„activeç‹€æ…‹
                            chartTabs.forEach(t => t.classList.remove('tab-active'));
                            // ç‚ºç•¶å‰æŒ‰éˆ•æ·»åŠ activeç‹€æ…‹
                            this.classList.add('tab-active');
                            
                            // æ ¹æ“šç¶­åº¦é¡å‹æ›´æ–°åœ–è¡¨
                            const chartType = this.getAttribute('data-chart');
                            const activeTab = document.querySelector('.tab-button.active');
                            const tabType = activeTab ? activeTab.getAttribute('data-tab') : 'groupbuy';
                            
                            if (tabType === 'user') {
                                updateUserChartByDimension(chartType);
                            }
                            // ç§»é™¤äº†åˆè²·æŒ‡æ¨™çš„åœ–è¡¨é‚è¼¯
                        });
                    });
                }
                // ä¸å†éœ€è¦è™•ç†åˆè²·æŒ‡æ¨™çš„éš±è—é‚è¼¯ï¼Œç”±TABåˆ‡æ›é‚è¼¯çµ±ä¸€è™•ç†
            }

            document.addEventListener('DOMContentLoaded', function() {
                // æª¢æŸ¥Chart.jsæ˜¯å¦å·²åŠ è¼‰
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js not loaded!');
                    return;
                }
                
                // åˆå§‹åŒ–Macå…¼å®¹æ€§æª¢æŸ¥
                initMacCompatibility();
                
                // åˆå§‹åŒ–ä¸»é¡Œ
                initTheme();
                
                // åˆå§‹åŒ–æŠ˜ç–Šé¢æ¿
                initCollapsibleSections();
                
                // åˆå§‹åŒ–TABåˆ‡æ›åŠŸèƒ½
                initTabSwitching();
                
                // è¨­ç½®é»˜èªæ—¥æœŸ
                setupDefaultDates();
                
                // è¨­ç½®ç”¨æˆ¶æŒ‡æ¨™é»˜èªæ—¥æœŸ
                setupUserDefaultDates();
                
                // åˆå§‹åŒ–ç”¨æˆ¶IDç¯©é¸æ¡†æ¨™ç±¤ï¼ˆé»˜èªç‚ºç™¼èµ·åˆè²·ï¼‰
                const userIdFilterLabel = document.getElementById('userIdFilterLabel');
                const userIdFilter = document.getElementById('userIdFilter');
                if (userIdFilterLabel && userIdFilter) {
                    userIdFilterLabel.textContent = 'å‘èµ·äººID';
                    userIdFilter.placeholder = 'è¾“å…¥å‘èµ·äººIDæˆ–ç•™ç©º';
                }
                
                // ç¢ºä¿è¡¨æ ¼å€åŸŸæ˜¯å¯è¦‹çš„
                const tableContent = document.getElementById('tableContent');
                if (tableContent && !tableContent.classList.contains('expanded')) {
                    tableContent.classList.add('expanded');
                }
                
                // ç”Ÿæˆéš¨æ©Ÿæ•¸æ“š
                generateRandomData(200);
                
                // è¨­ç½®åˆå§‹è¡¨æ ¼æ¨™é¡Œï¼ˆé»˜èªç‚ºåˆè²·æŒ‡æ¨™ï¼‰
                // updateUserTableHeaders('initiate'); // ä¸éœ€è¦åˆå§‹åŒ–ç”¨æˆ¶è¡¨æ ¼æ¨™é¡Œ
                
                // ä¸å†éœ€è¦è¨­ç½®åˆå§‹åœ–è¡¨ç¶­åº¦æ¨™ç±¤ï¼Œå› ç‚ºåˆè²·æŒ‡æ¨™æ²’æœ‰åœ–è¡¨äº†
                
                // åˆå§‹åŒ–è¡¨æ ¼åˆ†é å’Œæ’åº
                initTablePagination();
                initGroupbuyTableSorting();
                
                // åˆå§‹åŒ–ç”¨æˆ¶è¡¨æ ¼åˆ†é å’Œæ’åº
                initUserTablePagination();
                initUserTableSorting();
                
                // åˆå§‹åŒ–ç”¨æˆ¶è¡¨æ ¼åˆ†é ä¿¡æ¯
                updateUserPaginationInfo();
                
                // æº–å‚™ç”¨æˆ¶åœ–è¡¨ï¼Œç•¶åˆ‡æ›åˆ°ç”¨æˆ¶TABæ™‚ä½¿ç”¨
                window.currentUserChartType = 'initiate_count';
                
                // æ™‚é–“ç¶­åº¦åˆ‡æ›
                document.getElementById('timeGranularity').addEventListener('change', function() {
                    const granularity = this.value;
                    updateDateSelector(granularity);
                    // åˆè²·æŒ‡æ¨™ä¸å†æœ‰åœ–è¡¨ï¼Œç§»é™¤äº†åœ–è¡¨æ›´æ–°é‚è¼¯
                });
                
                // ç”¨æˆ¶æŒ‡æ¨™ç¶­åº¦åˆ‡æ› - å‹•æ…‹æ›´æ–°IDç¯©é¸æ¡†æ¨™ç±¤
                document.getElementById('userMetricType').addEventListener('change', function() {
                    const metricType = this.value;
                    const userIdFilterLabel = document.getElementById('userIdFilterLabel');
                    const userIdFilter = document.getElementById('userIdFilter');
                    
                    // æ ¹æ“šæŒ‡æ¨™ç¶­åº¦æ›´æ–°IDç¯©é¸æ¡†çš„æ¨™ç±¤å’Œä½”ä½ç¬¦
                    if (metricType === 'initiate') {
                        userIdFilterLabel.textContent = 'å‘èµ·äººID';
                        userIdFilter.placeholder = 'è¾“å…¥å‘èµ·äººIDæˆ–ç•™ç©º';
                    } else if (metricType === 'participate') {
                        userIdFilterLabel.textContent = 'å‚ä¸äººID';
                        userIdFilter.placeholder = 'è¾“å…¥å‚ä¸äººIDæˆ–ç•™ç©º';
                    }
                    
                    // æ¸…ç©ºç•¶å‰è¼¸å…¥çš„IDå€¼ï¼Œå› ç‚ºç¶­åº¦å·²ç¶“æ”¹è®Š
                    userIdFilter.value = '';
                });
                
                // ç”¨æˆ¶æŒ‡æ¨™æ™‚é–“ç¶­åº¦åˆ‡æ›
                document.getElementById('userTimeGranularity').addEventListener('change', function() {
                    const granularity = this.value;
                    updateUserDateSelector(granularity);
                });
                
                // æ›´æ–°ç”¨æˆ¶æ—¥æœŸé¸æ“‡å™¨
                function updateUserDateSelector(granularity) {
                    const daySelector = document.getElementById('userDaySelector');
                    const weekSelector = document.getElementById('userWeekSelector');
                    const monthSelector = document.getElementById('userMonthSelector');
                    
                    daySelector.classList.add('hidden');
                    weekSelector.classList.add('hidden');
                    monthSelector.classList.add('hidden');
                    
                    if (granularity === 'day') {
                        daySelector.classList.remove('hidden');
                    } else if (granularity === 'week') {
                        weekSelector.classList.remove('hidden');
                    } else if (granularity === 'month') {
                        monthSelector.classList.remove('hidden');
                    }
                }
                
                // è¨­ç½®é»˜èªæ—¥æœŸå’Œæ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
                function setupDefaultDates() {
                    // ç²å–ç•¶å‰æ—¥æœŸ
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    
                    // æ ¼å¼åŒ–ç‚º yyyy-MM-dd 
                    const today = `${year}-${month}-${day}`;
                    
                    // è¨­ç½®é»˜èªçš„å¤©æ—¥æœŸé¸æ“‡å™¨
                    document.getElementById('startDate').value = today;
                    document.getElementById('endDate').value = today;
                    
                    // è¨­ç½®é»˜èªçš„é€±é¸æ“‡å™¨
                    // æ³¨æ„ï¼šé€±é¸æ“‡å™¨æ ¼å¼ç‚º yyyy-Wwwï¼Œå…¶ä¸­ ww æ˜¯é€±æ•¸
                    const weekNumber = getWeekNumber(now);
                    const weekString = `${year}-W${String(weekNumber).padStart(2, '0')}`;
                    document.getElementById('startWeek').value = weekString;
                    document.getElementById('endWeek').value = weekString;
                    
                    // è¨­ç½®é»˜èªçš„æœˆé¸æ“‡å™¨
                    const monthString = `${year}-${month}`;
                    document.getElementById('startMonth').value = monthString;
                    document.getElementById('endMonth').value = monthString;
                }
                
                // getWeekNumberå‡½æ•¸å·²ç§»è‡³å…¨å±€ä½œç”¨åŸŸ
                
                // æ›´æ–°æ—¥æœŸé¸æ“‡å™¨
                function updateDateSelector(granularity) {
                    const daySelector = document.getElementById('daySelector');
                    const weekSelector = document.getElementById('weekSelector');
                    const monthSelector = document.getElementById('monthSelector');
                    
                    // éš±è—æ‰€æœ‰é¸æ“‡å™¨
                    daySelector.classList.add('hidden');
                    weekSelector.classList.add('hidden');
                    monthSelector.classList.add('hidden');
                    
                    // æ ¹æ“šé¸æ“‡çš„æ™‚é–“ç¶­åº¦é¡¯ç¤ºå°æ‡‰é¸æ“‡å™¨
                    if (granularity === 'day') {
                        daySelector.classList.remove('hidden');
                    } else if (granularity === 'week') {
                        weekSelector.classList.remove('hidden');
                    } else if (granularity === 'month') {
                        monthSelector.classList.remove('hidden');
                    }
                }
                

                
                // ç¯©é¸æŒ‰éˆ•é»æ“Šäº‹ä»¶
                document.getElementById('filterBtn').addEventListener('click', function() {
                    // ç²å–æ™‚é–“ç¶­åº¦å’Œæ—¥æœŸç¯„åœ
                    const timeGranularity = document.getElementById('timeGranularity').value;
                    let startDate, endDate;
                    
                    // æ ¹æ“šæ™‚é–“ç¶­åº¦ç²å–å°æ‡‰çš„æ—¥æœŸå€¼
                    if (timeGranularity === 'day') {
                        startDate = document.getElementById('startDate').value;
                        endDate = document.getElementById('endDate').value;
                    } else if (timeGranularity === 'week') {
                        startDate = document.getElementById('startWeek').value;
                        endDate = document.getElementById('endWeek').value;
                    } else if (timeGranularity === 'month') {
                        startDate = document.getElementById('startMonth').value;
                        endDate = document.getElementById('endMonth').value;
                    }
                    
                    // ç²å–å…¶ä»–ç¯©é¸æ¢ä»¶
                    const merchantId = document.getElementById('merchantId').value;
                    const planId = document.getElementById('planId').value;
                    const status = document.getElementById('status').value;
                    const initiatorId = document.getElementById('initiatorId').value;
                    
                    console.log(`ç¯©é¸æ™‚é–“ç¯„åœ: ${timeGranularity} - ${startDate} è‡³ ${endDate}`);
                    
                    // ç¯©é¸è¡¨æ ¼æ•¸æ“š
                    filterTableData(merchantId, planId, status, initiatorId, timeGranularity, startDate, endDate);
                    // åˆè²·æŒ‡æ¨™ä¸å†æœ‰åœ–è¡¨ï¼Œç§»é™¤äº†åœ–è¡¨æ›´æ–°é‚è¼¯
                });
                
                // æœ€ä¸Šæ–¹åŒ¯å‡ºæŒ‰éˆ•ï¼šå°å‡ºæ ¸å¿ƒæŒ‡æ¨™å’Œåˆè²·æ•´é«”æ•¸æ“š
                document.getElementById('exportBtn').addEventListener('click', function() {
                    // å–å¾—æ ¸å¿ƒæŒ‡æ¨™
                    const totalPlans = document.getElementById('totalPlans').textContent;
                    const successPlans = document.getElementById('successPlans').textContent;
                    const totalAmount = document.getElementById('totalAmount').textContent;
                    const winRate = document.getElementById('winRate').textContent;
                    // å–å¾—åˆè²·æ•´é«”æ•¸æ“š
                    const totalParticipants = document.getElementById('totalParticipants').textContent;
                    const avgInitAmount = document.getElementById('avgInitAmount').textContent;
                    const avgParticipantsPerPlan = document.getElementById('avgParticipantsPerPlan').textContent;
                    const avgParticipationTimes = document.getElementById('avgParticipationTimes').textContent;
                    const avgInvestAmount = document.getElementById('avgInvestAmount').textContent;
                    const totalWinAmount = document.getElementById('totalWinAmount').textContent;
                    const avgWinAmount = document.getElementById('avgWinAmount').textContent;
                    const activeUsers = document.getElementById('activeUsers').textContent;
                    // æº–å‚™CSVå…§å®¹
                    let csvContent = 'æ ¸å¿ƒæŒ‡æ¨™\n';
                    csvContent += 'åˆä¹°æ€»å‘èµ·æ¬¡æ•°,åˆä¹°æˆåŠŸæ¬¡æ•°,åˆä¹°æ€»é‡‘é¢,åˆä¹°ä¸­å¥–ç‡\n';
                    csvContent += `${totalPlans},${successPlans},${totalAmount},${winRate}\n`;
                    csvContent += '\nåˆä¹°æ•´ä½“æ•°æ®\n';
                    csvContent += 'åˆä¹°å‚ä¸æ€»äººæ¬¡,åˆä¹°å¹³å‡å‘èµ·é‡‘é¢,å¹³å‡å‚ä¸äººæ•°/å•,äººå‡åˆä¹°å‚ä¸æ¬¡æ•°,äººå‡åˆä¹°æŠ•å…¥é‡‘é¢,åˆä¹°ä¸­å¥–é‡‘é¢æ€»è®¡,å¹³å‡ä¸­å¥–é‡‘é¢/å•,åˆä¹°æ´»è·ƒç”¨æˆ·æ•°\n';
                    csvContent += `${totalParticipants},${avgInitAmount},${avgParticipantsPerPlan},${avgParticipationTimes},${avgInvestAmount},${totalWinAmount},${avgWinAmount},${activeUsers}\n`;
                    // ä¸‹è¼‰
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    link.setAttribute('href', url);
                    link.setAttribute('download', `åˆè²·æŒ‡æ¨™ç¸½è¦½_${timestamp}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
                
                // é‡ç½®æŒ‰éˆ•é»æ“Šäº‹ä»¶
                document.getElementById('resetBtn').addEventListener('click', function() {
                    // é‡ç½®æ‰€æœ‰ç¯©é¸æ¢ä»¶
                    document.getElementById('timeGranularity').value = 'day';
                    document.getElementById('merchantId').value = 'all';
                    document.getElementById('planId').value = '';
                    document.getElementById('status').value = 'all';
                    document.getElementById('initiatorId').value = '';
                    
                    // é‡ç½®æ—¥æœŸç‚ºé»˜èªå€¼
                    setupDefaultDates();
                    
                    // é¡¯ç¤ºæ—¥æœŸé¸æ“‡å™¨
                    updateDateSelector('day');
                    

                    
                    // é¡¯ç¤ºæ‰€æœ‰è¡¨æ ¼æ•¸æ“š
                    const tableRows = document.querySelectorAll('#dataTable tr');
                    tableRows.forEach(function(row) {
                        row.style.display = '';
                    });
                    
                    // æ›´æ–°åˆ†é ä¿¡æ¯
                    updatePaginationInfo();
                    // åˆè²·æŒ‡æ¨™ä¸å†æœ‰åœ–è¡¨ï¼Œç§»é™¤äº†åœ–è¡¨æ›´æ–°é‚è¼¯
                });
                
                // ç¯©é¸è¡¨æ ¼æ•¸æ“šçš„å‡½æ•¸
                function filterTableData(merchantId, planId, status, initiatorId, timeGranularity, startDate, endDate) {
                    const tableRows = document.querySelectorAll('#dataTable tr');
                    
                    tableRows.forEach(function(row) {
                        let display = true;
                        
                        // æª¢æŸ¥æ—¥æœŸç¯„åœ (å¦‚æœæä¾›)
                        if (startDate && endDate && display) {
                            const dateCell = row.querySelector('td:nth-child(1)');
                            if (dateCell) {
                                const rowDate = dateCell.textContent.trim();
                                
                                // æ ¹æ“šæ™‚é–“ç¶­åº¦æª¢æŸ¥æ—¥æœŸ
                                if (timeGranularity === 'day') {
                                    // ç›´æ¥æ¯”è¼ƒæ—¥æœŸå­—ç¬¦ä¸² (æ ¼å¼: YYYY-MM-DD)
                                    if (rowDate < startDate || rowDate > endDate) {
                                        display = false;
                                    }
                                } else if (timeGranularity === 'week') {
                                    // é€±æ ¼å¼è™•ç†è¼ƒè¤‡é›œï¼Œé€™è£¡ç°¡åŒ–è™•ç†
                                    // å¯¦éš›æ‡‰ç”¨ä¸­å¯èƒ½éœ€è¦æ›´ç²¾ç¢ºçš„é€±æœŸæ¯”è¼ƒ
                                    const rowDateObj = new Date(rowDate);
                                    const rowYear = rowDateObj.getFullYear();
                                    const rowWeek = getWeekNumber(rowDateObj);
                                    const rowWeekStr = `${rowYear}-W${String(rowWeek).padStart(2, '0')}`;
                                    
                                    if (rowWeekStr < startDate || rowWeekStr > endDate) {
                                        display = false;
                                    }
                                } else if (timeGranularity === 'month') {
                                    // æå–è¡Œä¸­æ—¥æœŸçš„å¹´å’Œæœˆ
                                    const rowDateParts = rowDate.split('-');
                                    const rowYearMonth = `${rowDateParts[0]}-${rowDateParts[1]}`;
                                    
                                    if (rowYearMonth < startDate || rowYearMonth > endDate) {
                                        display = false;
                                    }
                                }
                            }
                        }
                        
                        // æª¢æŸ¥å•†æˆ¶ID
                        if (merchantId !== 'all' && display) {
                            const merchantIdCell = row.querySelector('td:nth-child(2)');
                            if (merchantIdCell && merchantIdCell.textContent.trim() !== merchantId) {
                                display = false;
                            }
                        }
                        
                        // æª¢æŸ¥åˆè²·åºè™Ÿ
                        if (planId && display) {
                            const planIdCell = row.querySelector('td:nth-child(3)');
                            if (planIdCell && !planIdCell.textContent.includes(planId)) {
                                display = false;
                            }
                        }
                        
                        // æª¢æŸ¥ç™¼èµ·äººID
                        if (initiatorId && display) {
                            const initiatorIdCell = row.querySelector('td:nth-child(4)');
                            if (initiatorIdCell && !initiatorIdCell.textContent.includes(initiatorId)) {
                                display = false;
                            }
                        }
                        
                        // æª¢æŸ¥ç‹€æ…‹
                        if (status !== 'all' && display) {
                            const statusCell = row.querySelector('td:nth-child(7)');
                            if (statusCell) {
                                const cellStatus = statusCell.textContent.trim();
                                if ((status === 'success' && cellStatus !== 'æˆåŠŸ') ||
                                    (status === 'fail' && cellStatus !== 'å¤±è´¥') ||
                                    (status === 'in_progress' && cellStatus !== 'è¿›è¡Œä¸­')) {
                                    display = false;
                                }
                            }
                        }
                        
                        // è¨­ç½®é¡¯ç¤ºç‹€æ…‹
                        row.style.display = display ? '' : 'none';
                    });
                    
                    // æ›´æ–°åˆ†é ä¿¡æ¯
                    updatePaginationInfo();
                }
                
                // æ›´æ–°åˆ†é ä¿¡æ¯
                function updatePaginationInfo() {
                    const allRows = document.querySelectorAll('#dataTable tr');
                    const visibleRows = Array.from(allRows).filter(row => row.style.display !== 'none').length;
                    console.log(`Pagination: ${allRows.length} total rows, ${visibleRows} visible rows`);
                    const startRecord = document.getElementById('startRecord');
                    const endRecord = document.getElementById('endRecord');
                    const totalRecords = document.getElementById('totalRecords');
                    
                    if (startRecord && endRecord && totalRecords) {
                        if (visibleRows === 0) {
                            startRecord.textContent = '0';
                            endRecord.textContent = '0';
                        } else {
                            startRecord.textContent = '1';
                            endRecord.textContent = Math.min(visibleRows, 10);
                        }
                        totalRecords.textContent = visibleRows;
                    }
                }
                
                // åˆå§‹åŒ–è¶¨å‹¢åœ–ï¼ˆåƒ…ç”¨æ–¼ç”¨æˆ¶æŒ‡æ¨™ï¼‰
                function initTrendChart() {
                    // åˆè²·æŒ‡æ¨™ä¸å†æœ‰åœ–è¡¨ï¼Œæ­¤å‡½æ•¸åƒ…ç”¨æ–¼ç”¨æˆ¶æŒ‡æ¨™
                    const activeTab = document.querySelector('.tab-button.active');
                    const tabType = activeTab ? activeTab.getAttribute('data-tab') : 'groupbuy';
                    
                    // å»¶é²åˆå§‹åŒ–ç¢ºä¿DOMå®Œå…¨åŠ è¼‰
                    setTimeout(() => {
                        if (tabType === 'user') {
                            updateUserChart();
                        }
                        // ç§»é™¤äº†åˆè²·æŒ‡æ¨™çš„åœ–è¡¨åˆå§‹åŒ–é‚è¼¯
                    }, 300);
                }
                

                

                


                // æ›´æ–°è¡¨æ ¼æ•¸æ“š
                function updateTableData(tabType) {
                    const tableBody = document.getElementById('dataTable');
                    // æ¸…ç©ºåŸæœ‰è¡¨æ ¼æ•¸æ“šï¼Œä»¥ä¾¿é‡æ–°ç”Ÿæˆ
                    tableBody.innerHTML = '';
                    
                    // ç”Ÿæˆæ–°æ•¸æ“š
                    const topUsers = getTopUsers(tabType, 5);
                    
                    // å­˜å„²æ‰€æœ‰è¡Œï¼Œä»¥ä¾¿å¾ŒçºŒæ’åº
                    const allRows = [];
                    
                    // æ ¹æ“šæ’è¡Œæ¦œé¡å‹ç¢ºå®šè¦é¡¯ç¤ºçš„æ•¸æ“š
                    topUsers.forEach(user => {
                        const row = document.createElement('tr');
                        
                        // ç”Ÿæˆéš¨æ©Ÿæ—¥æœŸï¼ˆéå»7å¤©å…§ï¼‰
                        const randomDate = generateRandomDate(7);
                        const formattedDate = formatDate(randomDate);
                        
                        // éš¨æ©Ÿå•†æˆ¶ID
                        const merchantIds = ['13589', '24671', '37824', '45912', '58763'];
                        const randomMerchantId = merchantIds[Math.floor(Math.random() * merchantIds.length)];
                        
                        // éš¨æ©Ÿåˆè²·åºè™Ÿï¼ˆ6ä½æ•¸ï¼‰
                        const randomPlanId = Math.floor(100000 + Math.random() * 900000);
                        
                        // åƒèˆ‡äººæ•¸ï¼ˆæ ¹æ“štopUsersæ•¸æ“šï¼‰
                        const participants = tabType === 'participants' ? user.value : Math.floor(2 + Math.random() * 8);
                        
                        // åˆè²·ç¸½é‡‘é¡
                        const amount = tabType === 'avg-amount' ? user.value : Math.floor(100 + Math.random() * 1900);
                        const formattedAmount = formatNumber(amount);
                        
                        // åˆè²·ç‹€æ…‹
                        let status;
                        if (tabType === 'success-rate') {
                            // æ ¹æ“šæˆåŠŸç‡è¨­ç½®ç‹€æ…‹
                            const successRate = user.value / 100;
                            if (Math.random() < successRate) {
                                status = '<td class="text-green-600">æˆåŠŸ</td>';
                            } else if (Math.random() < 0.5) {
                                status = '<td class="text-red-600">å¤±è´¥</td>';
                            } else {
                                status = '<td class="text-amber-600">è¿›è¡Œä¸­</td>';
                            }
                        } else {
                            // éš¨æ©Ÿç‹€æ…‹
                            const statuses = [
                                '<td class="text-green-600">æˆåŠŸ</td>',
                                '<td class="text-red-600">å¤±è´¥</td>',
                                '<td class="text-amber-600">è¿›è¡Œä¸­</td>'
                            ];
                            status = statuses[Math.floor(Math.random() * statuses.length)];
                        }
                        
                        // ä¸­çé‡‘é¡ï¼ˆéš¨æ©Ÿï¼Œå¤§ç´„æ˜¯åˆè²·é‡‘é¡çš„0.8-1.5å€ï¼‰
                        const winAmount = status.includes('æˆåŠŸ') ? 
                            Math.floor(amount * (0.8 + Math.random() * 0.7)) : 0;
                        const formattedWinAmount = formatNumber(winAmount);
                        
                        // çµ±è¨ˆæ¬„ä½çš„å€¼
                        let countValue;
                        switch(tabType) {
                            case 'initiators':
                                countValue = user.value;
                                break;
                            case 'participants':
                                countValue = user.value;
                                break;
                            case 'success-rate':
                                countValue = user.value + '%';
                                break;
                            case 'avg-amount':
                                countValue = formatNumber(user.value);
                                break;
                            default:
                                countValue = 0;
                        }
                        
                        // å¡«å……è¡Œæ•¸æ“š
                        row.innerHTML = `
                            <td>${formattedDate}</td>
                            <td>${randomMerchantId}</td>
                            <td>${randomPlanId}</td>
                            <td>${user.id}</td>
                            <td class="count-cell">${countValue}</td>
                            <td>${participants}</td>
                            <td>${formattedAmount}</td>
                            ${status}
                            <td>${formattedWinAmount}</td>
                        `;
                        
                        // å°‡è¡Œæ·»åŠ åˆ°æ•¸çµ„
                        row.setAttribute('data-date', randomDate.getTime());
                        allRows.push(row);
                    });
                    
                    // æ·»åŠ æ›´å¤šéš¨æ©Ÿæ•¸æ“šï¼ˆç¸½å…±é¡¯ç¤º20æ¢ï¼‰
                    const totalRows = 20;
                    const remainingRows = totalRows - topUsers.length;
                    
                    for (let i = 0; i < remainingRows; i++) {
                        const row = document.createElement('tr');
                        
                        // ç”Ÿæˆéš¨æ©Ÿæ—¥æœŸï¼ˆéå»30å¤©å…§ï¼‰
                        const randomDate = generateRandomDate(30);
                        const formattedDate = formatDate(randomDate);
                        
                        // éš¨æ©Ÿå•†æˆ¶ID
                        const merchantIds = ['13589', '24671', '37824', '45912', '58763'];
                        const randomMerchantId = merchantIds[Math.floor(Math.random() * merchantIds.length)];
                        
                        // éš¨æ©Ÿåˆè²·åºè™Ÿ
                        const randomPlanId = Math.floor(100000 + Math.random() * 900000);
                        
                        // éš¨æ©Ÿç”¨æˆ¶ID
                        const randomUserId = Math.floor(10000 + Math.random() * 90000);
                        
                        // éš¨æ©Ÿåƒèˆ‡äººæ•¸
                        const participants = Math.floor(2 + Math.random() * 8);
                        
                        // éš¨æ©Ÿåˆè²·é‡‘é¡
                        const amount = Math.floor(100 + Math.random() * 1900);
                        const formattedAmount = formatNumber(amount);
                        
                        // éš¨æ©Ÿç‹€æ…‹
                        const statuses = [
                            '<td class="text-green-600">æˆåŠŸ</td>',
                            '<td class="text-red-600">å¤±è´¥</td>',
                            '<td class="text-amber-600">è¿›è¡Œä¸­</td>'
                        ];
                        const status = statuses[Math.floor(Math.random() * statuses.length)];
                        
                        // ä¸­çé‡‘é¡
                        const winAmount = status.includes('æˆåŠŸ') ? 
                            Math.floor(amount * (0.8 + Math.random() * 0.7)) : 0;
                        const formattedWinAmount = formatNumber(winAmount);
                        
                        // çµ±è¨ˆæ¬„ä½
                        let countValue;
                        switch(tabType) {
                            case 'initiators':
                                countValue = Math.floor(1 + Math.random() * 10);
                                break;
                            case 'participants':
                                countValue = Math.floor(1 + Math.random() * 20);
                                break;
                            case 'success-rate':
                                countValue = (Math.random() * 50).toFixed(1) + '%';
                                break;
                            case 'avg-amount':
                                countValue = formatNumber(Math.floor(50 + Math.random() * 300));
                                break;
                            default:
                                countValue = 0;
                        }
                        
                        // å¡«å……è¡Œæ•¸æ“š
                        row.innerHTML = `
                            <td>${formattedDate}</td>
                            <td>${randomMerchantId}</td>
                            <td>${randomPlanId}</td>
                            <td>${randomUserId}</td>
                            <td class="count-cell">${countValue}</td>
                            <td>${participants}</td>
                            <td>${formattedAmount}</td>
                            ${status}
                            <td>${formattedWinAmount}</td>
                        `;
                        
                        // å°‡è¡Œæ·»åŠ åˆ°æ•¸çµ„
                        row.setAttribute('data-date', randomDate.getTime());
                        allRows.push(row);
                    }
                    
                    // æŒ‰æ—¥æœŸé™åºæ’åºæ‰€æœ‰è¡Œï¼ˆæœ€æ–°æ—¥æœŸå„ªå…ˆï¼‰
                    allRows.sort((a, b) => {
                        const dateA = parseInt(a.getAttribute('data-date'));
                        const dateB = parseInt(b.getAttribute('data-date'));
                        return dateB - dateA;
                    });
                    
                    // å°‡æ’åºå¾Œçš„è¡Œæ·»åŠ åˆ°è¡¨æ ¼
                    allRows.forEach(row => {
                        tableBody.appendChild(row);
                    });
                    
                    // æ›´æ–°åˆ†é ä¿¡æ¯
                    updatePaginationInfo();
                }

                // ç²å–æ’è¡Œæ¦œå‰Nåç”¨æˆ¶
                function getTopUsers(tabType, count) {
                    // ç²å–å°æ‡‰æ’è¡Œæ¦œçš„ç”¨æˆ¶æ•¸æ“š
                    let leaderboardData = [];
                    
                    // æ ¹æ“šæ’è¡Œæ¦œé¡å‹ç²å–å°æ‡‰æ•¸æ“š
                    switch(tabType) {
                        case 'initiators':
                            leaderboardData = [
                                { id: '10048', value: 50 },
                                { id: '10011', value: 49 },
                                { id: '10013', value: 47 },
                                { id: '10038', value: 47 },
                                { id: '10005', value: 46 }
                            ];
                            break;
                        case 'participants':
                            leaderboardData = [
                                { id: '10030', value: 100 },
                                { id: '10023', value: 98 },
                                { id: '10013', value: 97 },
                                { id: '10003', value: 93 },
                                { id: '10015', value: 91 }
                            ];
                            break;
                        case 'success-rate':
                            leaderboardData = [
                                { id: '10005', value: 65.2 },
                                { id: '10013', value: 57.4 },
                                { id: '10038', value: 46.8 },
                                { id: '10048', value: 46.0 },
                                { id: '10011', value: 24.5 }
                            ];
                            break;
                        case 'avg-amount':
                            leaderboardData = [
                                { id: '10011', value: 758.4 },
                                { id: '10005', value: 638.0 },
                                { id: '10013', value: 449.9 },
                                { id: '10048', value: 405.3 },
                                { id: '10038', value: 180.2 }
                            ];
                            break;
                        default:
                            return [];
                    }
                    
                    // å–å‰Nå
                    return leaderboardData.slice(0, count);
                }

                // ç”Ÿæˆéš¨æ©Ÿæ—¥æœŸ
                function generateRandomDate(daysRange) {
                    const today = new Date();
                    const pastDay = new Date(today);
                    pastDay.setDate(today.getDate() - Math.floor(Math.random() * daysRange));
                    return pastDay;
                }

                // æ ¼å¼åŒ–æ—¥æœŸ
                function formatDate(date) {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                }

                // æ ¼å¼åŒ–æ•¸å­—ï¼ˆæ·»åŠ åƒåˆ†ä½ï¼‰
                function formatNumber(num) {
                    if (num >= 1000) {
                        return `${Math.floor(num/1000)},${String(num % 1000).padStart(3, '0')}`;
                    }
                    return String(num);
                }

                // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
                function calculateStats(data, tabType) {
                    const stats = {};
                    
                    data.forEach(row => {
                        if (!stats[row.userId]) {
                            stats[row.userId] = {
                                count: 0,
                                participantCount: 0,
                                totalAmount: 0,
                                successCount: 0,
                                totalCount: 0
                            };
                        }
                        
                        const userStats = stats[row.userId];
                        userStats.count++;
                        userStats.participantCount += row.participants;
                        userStats.totalAmount += row.amount;
                        userStats.totalCount++;
                        if (row.status === 'æˆåŠŸ') {
                            userStats.successCount++;
                        }
                    });
                    
                    // è¨ˆç®—å¹³å‡å€¼å’Œæ¯”ç‡
                    Object.values(stats).forEach(stat => {
                        stat.successRate = stat.successCount / stat.totalCount;
                        stat.avgAmount = stat.totalAmount / stat.totalCount;
                    });
                    
                    return stats;
                }

                // åœ–è¡¨æ¨™ç±¤åˆ‡æ›
                const chartTabs = document.querySelectorAll('.chart-tab');
                chartTabs.forEach(function(tab) {
                    tab.addEventListener('click', function(e) {
                        e.stopPropagation(); // é˜²æ­¢è§¸ç™¼æŠ˜ç–Šé¢æ¿
                        
                        // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„æ¿€æ´»ç‹€æ…‹
                        chartTabs.forEach(t => t.classList.remove('tab-active'));
                        
                        // æ¿€æ´»ç•¶å‰æ¨™ç±¤
                        this.classList.add('tab-active');
            });
        });

                // æ¨¡æ…‹æ¡†æ§åˆ¶
                document.getElementById('devInfoBtn').addEventListener('click', function() {
                    document.getElementById('codeModal').classList.add('show');
                    
                    // æ›´æ–°ä»£ç¢¼å…§å®¹ç‚ºç•¶å‰HTMLï¼ŒåŒ…å«ç‰ˆæœ¬ä¿¡æ¯
                    const htmlContent = document.documentElement.outerHTML;
                    const versionInfo = `/**
 * åˆè²·æ•¸æ“šåˆ†æå ±è¡¨ V2.0
 * æ›´æ–°æ—¥æœŸ: 2024-12-19
 * 
 * æ›´æ–°å…§å®¹ï¼š
 * - ç§»é™¤åˆè²·æŒ‡æ¨™çš„è¶¨å‹¢åˆ†æåœ–è¡¨ï¼Œä¿ç•™ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨åŠŸèƒ½
 * - ä¿®å¾©åˆè²·æŒ‡æ¨™è¡¨æ ¼æ’åºåŠŸèƒ½ï¼Œç¢ºä¿æ‰€æœ‰æ’åºæŒ‰éˆ•æ­£å¸¸å·¥ä½œ
 * - å„ªåŒ–TABåˆ‡æ›é‚è¼¯ï¼Œåˆè²·æŒ‡æ¨™å’Œç”¨æˆ¶æŒ‡æ¨™ç¨ç«‹ç®¡ç†
 * - æ”¹é€²è¡¨æ ¼åˆ†é å’Œç¯©é¸åŠŸèƒ½çš„å…¼å®¹æ€§
 * - å¢å¼·Macç³»çµ±å’Œæ·±è‰²æ¨¡å¼çš„æ”¯æŒ
 * 
 * æ”¯æŒåŠŸèƒ½:
 * - åˆè²·æŒ‡æ¨™ï¼šæ•¸æ“šç¯©é¸ã€è¡¨æ ¼æ’åºã€åˆ†é ã€å°å‡ºåŠŸèƒ½
 * - ç”¨æˆ¶æŒ‡æ¨™ï¼šå®Œæ•´åœ–è¡¨åˆ†æã€æ•¸æ“šç¯©é¸ã€è¡¨æ ¼æ’åºã€åˆ†é ã€å°å‡º
 * - éŸ¿æ‡‰å¼è¨­è¨ˆã€æš—é»‘æ¨¡å¼åˆ‡æ›
 * - Mac Safariå…¼å®¹æ€§å„ªåŒ–
 * - FontAwesomeåœ–æ¨™å‚™ç”¨æ–¹æ¡ˆ
 * 
 * æŠ€è¡“ç‰¹é»ï¼š
 * - ä½¿ç”¨Chart.js 3.9.1é€²è¡Œåœ–è¡¨ç¹ªè£½
 * - Tailwind CSSéŸ¿æ‡‰å¼å¸ƒå±€
 * - æ”¯æŒå¤šç¨®æ™‚é–“ç¶­åº¦ç¯©é¸ï¼ˆæ—¥/é€±/æœˆï¼‰
 * - å®Œæ•´çš„è¡¨æ ¼æ’åºå’Œåˆ†é åŠŸèƒ½
 * - æ·±è‰²/æ·ºè‰²ä¸»é¡Œè‡ªå‹•åˆ‡æ›
 * - CSVæ•¸æ“šå°å‡ºåŠŸèƒ½
 */

${htmlContent}`;
                    
                    document.getElementById('codeContent').textContent = versionInfo;
                });
                
                document.getElementById('closeModalBtn').addEventListener('click', function() {
                    document.getElementById('codeModal').classList.remove('show');
                });
                
                // é»æ“Šè’™å±¤é—œé–‰æ¨¡æ…‹çª—
                document.getElementById('codeModal').addEventListener('click', function(e) {
                    // ç¢ºä¿é»æ“Šçš„æ˜¯è’™å±¤æœ¬èº«ï¼Œè€Œä¸æ˜¯æ¨¡æ…‹æ¡†å…§å®¹
                    if (e.target === this) {
                        this.classList.remove('show');
                    }
                });
                
                // è¤‡è£½ä»£ç¢¼åŠŸèƒ½
                document.getElementById('copyCodeBtn').addEventListener('click', function() {
                    const codeContent = document.getElementById('codeContent').textContent;
                    navigator.clipboard.writeText(codeContent).then(function() {
                        // è¤‡è£½æˆåŠŸ
                        const originalText = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check mr-1"></i> å·²è¤‡è£½';
                        
                        // 3ç§’å¾Œæ¢å¾©åŸæ–‡æœ¬
                        setTimeout(() => {
                            this.innerHTML = originalText;
                        }, 3000);
                    }.bind(this)).catch(function(err) {
                        // è¤‡è£½å¤±æ•—
                        console.error('è¤‡è£½å¤±æ•—: ', err);
                    });
                });

                // åˆå§‹åŒ–Macå…¼å®¹æ€§åŠŸèƒ½
                function initMacCompatibility() {
                    // æª¢æ¸¬æ˜¯å¦ç‚ºMacç³»çµ±
                    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0 || 
                                  navigator.userAgent.toUpperCase().indexOf('MAC') >= 0;
                    
                    if (isMac) {
                        document.body.classList.add('mac-system');
                        console.log('æª¢æ¸¬åˆ°Macç³»çµ±ï¼Œå·²å•Ÿç”¨Macå„ªåŒ–');
                    }
                    
                    // æª¢æŸ¥FontAwesomeæ˜¯å¦æ­£ç¢ºåŠ è¼‰
                    setTimeout(function() {
                        const testIcon = document.createElement('i');
                        testIcon.className = 'fas fa-home';
                        testIcon.style.position = 'absolute';
                        testIcon.style.left = '-9999px';
                        testIcon.style.fontSize = '16px';
                        document.body.appendChild(testIcon);
                        
                        // æª¢æŸ¥è¨ˆç®—æ¨£å¼
                        const computedStyle = window.getComputedStyle(testIcon, '::before');
                        const fontFamily = computedStyle.getPropertyValue('font-family');
                        
                        // æ¸…ç†æ¸¬è©¦å…ƒç´ 
                        document.body.removeChild(testIcon);
                        
                        // å¦‚æœFontAwesomeæœªæ­£ç¢ºåŠ è¼‰ï¼Œé¡¯ç¤ºæç¤º
                        if (!fontFamily || fontFamily.indexOf('Font Awesome') === -1) {
                            console.warn('FontAwesomeåœ–æ¨™å¯èƒ½æœªæ­£ç¢ºåŠ è¼‰ï¼Œå·²å•Ÿç”¨å‚™ç”¨åœ–æ¨™');
                            document.body.classList.add('fa-fallback');
                            
                            // å¯é¸ï¼šé¡¯ç¤ºç”¨æˆ¶æç¤º
                            if (isMac) {
                                console.log('Macç³»çµ±ç”¨æˆ¶ï¼šå¦‚æœåœ–æ¨™é¡¯ç¤ºç•°å¸¸ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥æˆ–åˆ·æ–°é é¢');
                            }
                        } else {
                            console.log('FontAwesomeåœ–æ¨™åŠ è¼‰æˆåŠŸ');
                        }
                    }, 1500);
                    
                    // å„ªåŒ–Macä¸Šçš„æ»¾å‹•é«”é©—
                    if (isMac) {
                        const style = document.createElement('style');
                        style.textContent = `
                            .table-container {
                                -webkit-overflow-scrolling: touch;
                            }
                            
                            /* Macæ»¾å‹•æ¢æ¨£å¼ */
                            ::-webkit-scrollbar {
                                width: 8px;
                                height: 8px;
                            }
                            
                            ::-webkit-scrollbar-track {
                                background: rgba(0,0,0,0.1);
                                border-radius: 4px;
                            }
                            
                            ::-webkit-scrollbar-thumb {
                                background: rgba(0,0,0,0.3);
                                border-radius: 4px;
                            }
                            
                            ::-webkit-scrollbar-thumb:hover {
                                background: rgba(0,0,0,0.5);
                            }
                            
                            body.dark ::-webkit-scrollbar-track {
                                background: rgba(255,255,255,0.1);
                            }
                            
                            body.dark ::-webkit-scrollbar-thumb {
                                background: rgba(255,255,255,0.3);
                            }
                            
                            body.dark ::-webkit-scrollbar-thumb:hover {
                                background: rgba(255,255,255,0.5);
                            }
                        `;
                        document.head.appendChild(style);
                    }
                }

                // åˆå§‹åŒ–ä¸»é¡ŒåŠŸèƒ½
                function initTheme() {
                    // æª¢æŸ¥æœ¬åœ°å­˜å„²ä¸­æ˜¯å¦æœ‰ä¸»é¡Œåå¥½
                    const savedTheme = localStorage.getItem('theme');
                    if (savedTheme === 'dark') {
                        document.body.classList.add('dark');
                    } else {
                        // é»˜èªè¨­ç‚ºæ—¥é–“æ¨¡å¼
                        document.body.classList.remove('dark');
                        localStorage.setItem('theme', 'light');
                    }
                    
                    // ç›£è½ä¸»é¡Œåˆ‡æ›æŒ‰éˆ•é»æ“Š
                    document.getElementById('themeToggle').addEventListener('click', function() {
                        // åˆ‡æ›æ·±è‰²æ¨¡å¼é¡
                        document.body.classList.toggle('dark');
                        
                        // ä¿å­˜ä¸»é¡Œåå¥½åˆ°æœ¬åœ°å­˜å„²
                        const isDark = document.body.classList.contains('dark');
                        localStorage.setItem('theme', isDark ? 'dark' : 'light');
                        
                        // æ›´æ–°åœ–è¡¨ä¸»é¡Œ
                        updateChartsTheme(isDark);
                    });
                }
                
                // æ›´æ–°åœ–è¡¨ä¸»é¡Œ
                function updateChartsTheme(isDarkMode) {
                    // æ›´æ–°åˆè²·æŒ‡æ¨™åœ–è¡¨ä¸»é¡Œ
                    if (window.groupbuyChart) {
                        window.groupbuyChart.options.plugins.legend.labels.color = isDarkMode ? '#e2e8f0' : '#1e293b';
                        window.groupbuyChart.options.scales.x.title.color = isDarkMode ? '#e2e8f0' : '#475569';
                        window.groupbuyChart.options.scales.x.ticks.color = isDarkMode ? '#e2e8f0' : '#475569';
                        window.groupbuyChart.options.scales.y.ticks.color = isDarkMode ? '#e2e8f0' : '#475569';
                        window.groupbuyChart.options.scales.x.grid.color = isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        window.groupbuyChart.options.scales.y.grid.color = isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        window.groupbuyChart.update();
                    }
                    
                    // æ›´æ–°ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨ä¸»é¡Œ
                    if (window.userChart) {
                        window.userChart.options.plugins.legend.labels.color = isDarkMode ? '#e2e8f0' : '#1e293b';
                        window.userChart.options.scales.x.title.color = isDarkMode ? '#e2e8f0' : '#475569';
                        window.userChart.options.scales.x.ticks.color = isDarkMode ? '#e2e8f0' : '#475569';
                        window.userChart.options.scales.y.ticks.color = isDarkMode ? '#e2e8f0' : '#475569';
                        window.userChart.options.scales.x.grid.color = isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        window.userChart.options.scales.y.grid.color = isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        window.userChart.update();
                    }
                }

                // åˆå§‹åŒ–æ™‚æ·»åŠ å•†æˆ¶IDä¸‹æ‹‰é¸å–®çš„è®Šæ›´äº‹ä»¶
                document.getElementById('merchantId').addEventListener('change', function() {
                    // ç²å–æ™‚é–“ç¶­åº¦å’Œæ—¥æœŸç¯„åœ
                    const timeGranularity = document.getElementById('timeGranularity').value;
                    let startDate, endDate;
                    
                    // æ ¹æ“šæ™‚é–“ç¶­åº¦ç²å–å°æ‡‰çš„æ—¥æœŸå€¼
                    if (timeGranularity === 'day') {
                        startDate = document.getElementById('startDate').value;
                        endDate = document.getElementById('endDate').value;
                    } else if (timeGranularity === 'week') {
                        startDate = document.getElementById('startWeek').value;
                        endDate = document.getElementById('endWeek').value;
                    } else if (timeGranularity === 'month') {
                        startDate = document.getElementById('startMonth').value;
                        endDate = document.getElementById('endMonth').value;
                    }
                    
                    const merchantId = this.value;
                    const planId = document.getElementById('planId').value;
                    const status = document.getElementById('status').value;
                    const initiatorId = document.getElementById('initiatorId').value;
                    
                    // ç¯©é¸è¡¨æ ¼æ•¸æ“š
                    filterTableData(merchantId, planId, status, initiatorId, timeGranularity, startDate, endDate);
                    
                    // æ›´æ–°åˆè²·æŒ‡æ¨™åœ–è¡¨ï¼ˆå¦‚æœç•¶å‰åœ¨åˆè²·æŒ‡æ¨™TABï¼‰
                    const activeTab = document.querySelector('.tab-button.active');
                    if (activeTab && activeTab.getAttribute('data-tab') === 'groupbuy') {
                        setTimeout(() => {
                            const activeChartTab = document.querySelector('.chart-tab.tab-active');
                            const chartType = activeChartTab ? activeChartTab.getAttribute('data-chart') : 'plans';
                            updateGroupbuyChartData(chartType, timeGranularity);
                        }, 100);
                    }
                });
                
                // åˆå§‹åŒ–æŠ˜ç–Šé¢æ¿åŠŸèƒ½
                function initCollapsibleSections() {
                    const collapsibles = document.querySelectorAll('.collapsible');
                    
                    collapsibles.forEach(function(item) {
                        item.addEventListener('click', function(e) {
                            // å¦‚æœé»æ“Šçš„æ˜¯TABæŒ‰éˆ•ï¼Œä¸åŸ·è¡ŒæŠ˜ç–Šæ“ä½œ
                            if (e.target.classList.contains('tab-button') || e.target.closest('.tab-button')) {
                                return;
                            }
                            
                            const contentId = this.id.replace('Toggle', 'Content');
                            const content = document.getElementById(contentId);
                            
                            if (content) {
                                content.classList.toggle('expanded');
                                const icon = this.querySelector('i.fas');
                                if (icon) {
                                    icon.classList.toggle('fa-chevron-down');
                                    icon.classList.toggle('fa-chevron-up');
                                }
                            }
                        });
                    });
                    
                    // é è¨­ç‹€æ…‹ï¼šæ‰€æœ‰é¢æ¿éƒ½å±•é–‹
                    document.querySelectorAll('.collapsible-content').forEach(function(content) {
                        content.classList.add('expanded');
                    });
                    
                    // ç¢ºä¿ç¯©é¸å€åŸŸçš„åœ–æ¨™æ­£ç¢ºé¡¯ç¤º
                    const filterToggleIcon = document.querySelector('#filterToggle i.fas');
                    if (filterToggleIcon) {
                        filterToggleIcon.classList.remove('fa-chevron-down');
                        filterToggleIcon.classList.add('fa-chevron-up');
                    }
                }

                // è¡¨æ ¼åˆ†é åŠŸèƒ½
                function initTablePagination() {
                    // ç²å–åˆ†é å…ƒç´ 
                    const prevPageBtn = document.getElementById('prevPage');
                    const nextPageBtn = document.getElementById('nextPage');
                    const pageNumbers = document.getElementById('pageNumbers');
                    const itemsPerPageSelect = document.getElementById('itemsPerPageSelect');
                    
                    // åˆ†é ç‹€æ…‹
                    let currentPage = 1;
                    let itemsPerPage = parseInt(itemsPerPageSelect.value);
                    let totalPages = 1;
                    
                    // æ›´æ–°åˆ†é é¡¯ç¤º
                    function updatePagination() {
                        // ç²å–å¯è¦‹è¡Œ
                        const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        const totalItems = visibleRows.length;
                        
                        // è¨ˆç®—ç¸½é æ•¸
                        totalPages = Math.ceil(totalItems / itemsPerPage);
                        if (totalPages === 0) totalPages = 1;
                        
                        // ç¢ºä¿ç•¶å‰é åœ¨æœ‰æ•ˆç¯„åœå…§
                        if (currentPage > totalPages) {
                            currentPage = totalPages;
                        }
                        
                        // æ›´æ–°åˆ†é æŒ‰éˆ•
                        prevPageBtn.disabled = currentPage === 1;
                        nextPageBtn.disabled = currentPage === totalPages;
                        
                        // ç”Ÿæˆé ç¢¼æŒ‰éˆ•
            pageNumbers.innerHTML = '';
            
                        // æ±ºå®šè¦é¡¯ç¤ºçš„é ç¢¼ç¯„åœ
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
                        // èª¿æ•´èµ·å§‹é ä»¥ç¢ºä¿é¡¯ç¤º5å€‹é ç¢¼ï¼ˆå¦‚æœæœ‰é€™éº¼å¤šé ï¼‰
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }
            
                        // å‰µå»ºé ç¢¼æŒ‰éˆ•
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                            pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : 'btn-secondary'} text-xs py-1`;
                pageBtn.textContent = i;
                            pageBtn.onclick = function() {
                    currentPage = i;
                                showCurrentPage();
                            };
                pageNumbers.appendChild(pageBtn);
            }
            
                        // æ›´æ–°é¡¯ç¤ºçš„è¨˜éŒ„ç¯„åœ
                        const startRecord = document.getElementById('startRecord');
                        const endRecord = document.getElementById('endRecord');
                        const totalRecords = document.getElementById('totalRecords');
                        
                        if (totalItems === 0) {
                            startRecord.textContent = '0';
                            endRecord.textContent = '0';
                        } else {
                            const start = (currentPage - 1) * itemsPerPage + 1;
                            const end = Math.min(start + itemsPerPage - 1, totalItems);
                            startRecord.textContent = start;
                            endRecord.textContent = end;
                        }
                        totalRecords.textContent = totalItems;
                    }
                    
                    // é¡¯ç¤ºç•¶å‰é çš„æ•¸æ“š
                    function showCurrentPage() {
                        // ç²å–å¯è¦‹è¡Œ
                        const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        
                        // è¨ˆç®—ç•¶å‰é çš„é–‹å§‹å’ŒçµæŸç´¢å¼•
                        const startIndex = (currentPage - 1) * itemsPerPage;
                        const endIndex = startIndex + itemsPerPage;
                        
                        // éš±è—æ‰€æœ‰è¡Œ
                        visibleRows.forEach(row => {
                            row.classList.add('hidden');
                        });
                        
                        // é¡¯ç¤ºç•¶å‰é çš„è¡Œ
                        for (let i = startIndex; i < endIndex && i < visibleRows.length; i++) {
                            visibleRows[i].classList.remove('hidden');
                        }
                        
                        // æ›´æ–°åˆ†é é¡¯ç¤º
                        updatePagination();
                    }
                    
                    // ä¸Šä¸€é æŒ‰éˆ•é»æ“Šäº‹ä»¶
                    prevPageBtn.addEventListener('click', function() {
                        if (currentPage > 1) {
                            currentPage--;
                            showCurrentPage();
                        }
                    });
                    
                    // ä¸‹ä¸€é æŒ‰éˆ•é»æ“Šäº‹ä»¶
                    nextPageBtn.addEventListener('click', function() {
                        if (currentPage < totalPages) {
                            currentPage++;
                            showCurrentPage();
                        }
                    });
                    
                    // æ¯é é¡¯ç¤ºæ•¸é‡è®Šæ›´äº‹ä»¶
                    itemsPerPageSelect.addEventListener('change', function() {
                        itemsPerPage = parseInt(this.value);
                        currentPage = 1; // é‡ç½®ç‚ºç¬¬ä¸€é 
                        showCurrentPage();
                    });
                    
                    // åˆå§‹åŒ–é¡¯ç¤ºç¬¬ä¸€é 
                    showCurrentPage();
                    
                    // é‡å¯«æ›´æ–°åˆ†é ä¿¡æ¯å‡½æ•¸ï¼Œä»¥é©é…åˆ†é åŠŸèƒ½
                    window.updatePaginationInfo = function() {
                        // ç²å–å¯¦éš›å¯è¦‹è¡Œæ•¸ï¼ˆä¸åŒ…æ‹¬è¢«ç¯©é¸æ‰çš„è¡Œï¼‰
                        const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        
                        // æ›´æ–°ç¸½è¨˜éŒ„æ•¸
                        document.getElementById('totalRecords').textContent = visibleRows.length;
                        
                        // é‡ç½®ç‚ºç¬¬ä¸€é 
                        currentPage = 1;
                        showCurrentPage();
                    };
                }
                
                // åˆè²·æŒ‡æ¨™è¡¨æ ¼æ’åºåŠŸèƒ½
                function initGroupbuyTableSorting() {
                    const table = document.querySelector('#groupbuy-table table');
                    const tableBody = document.getElementById('dataTable');
                    
                    if (!table || !tableBody) {
                        console.warn('Groupbuy table or table body not found for sorting initialization');
                        return;
                    }
                    
                    const headers = table.querySelectorAll('th');
                    
                    // æ’åºæ–¹å‘ï¼ˆ1: å‡åºï¼Œ-1: é™åºï¼‰
                    let sortDirection = 1;
                    let lastSortedColumn = 'date'; // é»˜èªæŒ‰æ—¥æœŸæ’åº
                    
                    // ç‚ºæ¯å€‹è¡¨é ­æ·»åŠ é»æ“Šäº‹ä»¶
                    headers.forEach(header => {
                        if (header.getAttribute('data-sort')) {
                            header.addEventListener('click', function() {
                                const column = this.getAttribute('data-sort');
                                
                                // å¦‚æœé»æ“Šçš„æ˜¯ç•¶å‰æ’åºåˆ—ï¼Œå‰‡åˆ‡æ›æ’åºæ–¹å‘
                                if (column === lastSortedColumn) {
                                    sortDirection *= -1;
                                } else {
                                    sortDirection = 1; // æ–°åˆ—é»˜èªå‡åº
                                    lastSortedColumn = column;
                                }
                                
                                // æ›´æ–°æ’åºåœ–æ¨™
                                headers.forEach(h => {
                                    const icon = h.querySelector('.sort-icon');
                                    if (icon) {
                                        icon.classList.remove('active');
                                        icon.innerHTML = '<i class="fas fa-sort"></i>';
                                    }
                                });
                                
                                const icon = this.querySelector('.sort-icon');
                                if (icon) {
                                    icon.classList.add('active');
                                    icon.innerHTML = sortDirection === 1 
                                        ? '<i class="fas fa-sort-up"></i>'
                                        : '<i class="fas fa-sort-down"></i>';
                                }
                                
                                // åŸ·è¡Œæ’åº
                                sortTable(column, sortDirection);
                            });
                        }
                    });
                    
                    // æ’åºè¡¨æ ¼
                    function sortTable(column, direction) {
                        // ä¿å­˜ç•¶å‰ç¯©é¸ç‹€æ…‹å’Œåˆ†é ä¿¡æ¯
                        const filterStatus = [];
                        const rows = Array.from(tableBody.querySelectorAll('tr'));
                        
                        // è¨˜éŒ„æ¯è¡Œçš„ç•¶å‰é¡¯ç¤ºç‹€æ…‹
                        rows.forEach(row => {
                            filterStatus.push({
                                row: row,
                                display: row.style.display,
                                hidden: row.classList.contains('hidden')
                            });
                        });
                        
                        // ç¢ºå®šåˆ—ç´¢å¼•
                        let columnIndex;
                        switch (column) {
                            case 'date': columnIndex = 0; break;
                            case 'participants': columnIndex = 4; break;
                            case 'amount': columnIndex = 5; break;
                            case 'winAmount': columnIndex = 7; break;
                            default: columnIndex = 0;
                        }
                        
                        // æ’åºè¡Œ
                        const sortedRows = rows.sort((a, b) => {
                            let aValue = a.querySelectorAll('td')[columnIndex].textContent.trim();
                            let bValue = b.querySelectorAll('td')[columnIndex].textContent.trim();
                            
                            // è™•ç†æ•¸å­—å’Œé‡‘é¡æ ¼å¼
                            if (column === 'participants') {
                                // åƒèˆ‡äººæ•¸æ˜¯æ•´æ•¸
                                aValue = parseInt(aValue);
                                bValue = parseInt(bValue);
                            } else if (column === 'amount' || column === 'winAmount') {
                                // é‡‘é¡æ ¼å¼ï¼ˆå»é™¤é€—è™Ÿï¼‰
                                aValue = parseFloat(aValue.replace(/,/g, ''));
                                bValue = parseFloat(bValue.replace(/,/g, ''));
                            }
                            
                            // æ¯”è¼ƒå€¼
                            if (aValue < bValue) return -1 * direction;
                            if (aValue > bValue) return 1 * direction;
                            return 0;
                        });
                        
                        // é‡æ–°æ’åˆ—è¡¨æ ¼è¡Œ
                        tableBody.innerHTML = '';
                        
                        // æ¢å¾©æ¯è¡Œçš„é¡¯ç¤ºç‹€æ…‹
                        sortedRows.forEach((row, index) => {
                            const status = filterStatus.find(s => s.row === row);
                            if (status) {
                                row.style.display = status.display;
                                if (status.hidden) {
                                    row.classList.add('hidden');
                                } else {
                                    row.classList.remove('hidden');
                                }
                            }
                            tableBody.appendChild(row);
                        });
                        
                        // ç¢ºä¿åˆ†é è³‡è¨Šæ›´æ–°ä½†ä¸é‡ç½®é é¢
                        const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        document.getElementById('totalRecords').textContent = visibleRows.length;
                        
                        // åˆ·æ–°ç•¶å‰é é¢é¡¯ç¤º
                        const pagination = document.getElementById('pagination');
                        if (pagination) {
                            const currentPageElement = pagination.querySelector('.pagination-btn.active');
                            if (currentPageElement) {
                                const pageNumber = parseInt(currentPageElement.textContent);
                                const startRecord = document.getElementById('startRecord');
                                const endRecord = document.getElementById('endRecord');
                                const itemsPerPage = parseInt(document.getElementById('itemsPerPageSelect').value);
                                
                                const start = (pageNumber - 1) * itemsPerPage + 1;
                                const end = Math.min(start + itemsPerPage - 1, visibleRows.length);
                                
                                if (visibleRows.length === 0) {
                                    startRecord.textContent = '0';
                                    endRecord.textContent = '0';
                                } else {
                                    startRecord.textContent = start;
                                    endRecord.textContent = end;
                                }
                            }
                        }
                    }
                }
                
                // ç”Ÿæˆéš¨æ©Ÿæ•¸æ“šå‡½æ•¸
                function generateRandomData(count) {
                    const tableBody = document.getElementById('dataTable');
                    if (!tableBody) {
                        console.error('Table body not found!');
                        return;
                    }
                    const merchantIds = ['13589', '24671', '37824', '45912', '58763'];
                    const merchantNames = ['æ˜Ÿè¾°ä½“è‚²', 'æé€Ÿèµ›è½¦', 'è´¢å¯Œå½©ç¥¨', 'é‡‘é¹°å½©åº—', 'å¹¸è¿æ˜Ÿå½©'];
                    const statuses = [
                        '<td class="text-green-600">æˆåŠŸ</td>',
                        '<td class="text-red-600">å¤±è´¥</td>',
                        '<td class="text-amber-600">è¿›è¡Œä¸­</td>'
                    ];
                    
                    // æ¸…ç©ºç¾æœ‰æ•¸æ“š
                    tableBody.innerHTML = '';
                    
                    // å‰µå»ºä¸€å€‹æ•¸çµ„ä¾†å­˜å„²æ‰€æœ‰ç”Ÿæˆçš„è¡Œ
                    const allRows = [];
                    
                    // ç”Ÿæˆéš¨æ©Ÿæ—¥æœŸï¼ˆéå»30å¤©å…§ï¼‰
                    function randomDate() {
                        const today = new Date();
                        const pastDay = new Date(today);
                        pastDay.setDate(today.getDate() - Math.floor(Math.random() * 30));
                        
                        const year = pastDay.getFullYear();
                        const month = String(pastDay.getMonth() + 1).padStart(2, '0');
                        const day = String(pastDay.getDate()).padStart(2, '0');
                        
                        return {
                            dateObj: pastDay,
                            dateStr: `${year}-${month}-${day}`
                        };
                    }
                    
                    // ç”Ÿæˆ6ä½æ•¸çš„éš¨æ©Ÿåºè™Ÿ
                    function randomPlanId() {
                        return Math.floor(100000 + Math.random() * 900000);
                    }
                    
                    // ç”Ÿæˆ5ä½æ•¸çš„éš¨æ©Ÿç”¨æˆ¶ID
                    function randomUserId() {
                        return Math.floor(10000 + Math.random() * 90000);
                    }
                    
                    // ç”Ÿæˆéš¨æ©Ÿé‡‘é¡ï¼ˆ100-2000ï¼‰
                    function randomAmount() {
                        const amount = Math.floor(100 + Math.random() * 1900);
                        return amount > 999 
                            ? `${Math.floor(amount/1000)},${String(amount % 1000).padStart(3, '0')}`
                            : `${amount}`;
                    }
                    
                    // ç”Ÿæˆéš¨æ©Ÿä¸­çé‡‘é¡ï¼ˆå¤±æ•—ç‚º0ï¼ŒæˆåŠŸç‚ºæŠ•å…¥é‡‘é¡çš„0.8-1.5å€ï¼‰
                    function randomWinAmount(status, amount) {
                        if (status === 0) { // æˆåŠŸç‹€æ…‹ç´¢å¼•ç‚º0
                            const originalAmount = parseFloat(amount.replace(',', ''));
                            const multiplier = 0.8 + Math.random() * 0.7;
                            const winAmount = Math.floor(originalAmount * multiplier);
                            
                            return winAmount > 999 
                                ? `${Math.floor(winAmount/1000)},${String(winAmount % 1000).padStart(3, '0')}`
                                : `${winAmount}`;
                        } else {
                            return '0';
                        }
                    }
                    
                    // ç”Ÿæˆè¡Œæ•¸æ“š
                    for (let i = 0; i < count; i++) {
                        const dateInfo = randomDate();
                        const merchantIndex = Math.floor(Math.random() * merchantIds.length);
                        const merchantId = merchantIds[merchantIndex];
                        const planId = randomPlanId();
                        const initiatorId = randomUserId();
                        const participants = Math.floor(2 + Math.random() * 8); // 2-9äºº
                        const amount = randomAmount();
                        const statusIndex = Math.floor(Math.random() * statuses.length);
                        const winAmount = statusIndex === 0 ? randomWinAmount(statusIndex, amount) : '0'; // åªæœ‰æˆåŠŸç‹€æ…‹æ‰æœ‰ä¸­çé‡‘é¡
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${dateInfo.dateStr}</td>
                            <td>${merchantId}</td>
                            <td>${planId}</td>
                            <td>${initiatorId}</td>
                            <td>${participants}</td>
                            <td>${amount}</td>
                            ${statuses[statusIndex]}
                            <td>${winAmount}</td>
                        `;
                        
                        // æ·»åŠ æ—¥æœŸæ•¸æ“šä»¥ä¾¿æ’åº
                        row.setAttribute('data-date', dateInfo.dateObj.getTime());
                        allRows.push(row);
                    }
                    
                    // æŒ‰æ—¥æœŸé™åºæ’åºï¼ˆæœ€æ–°çš„æ—¥æœŸå„ªå…ˆï¼‰
                    allRows.sort((a, b) => {
                        const dateA = parseInt(a.getAttribute('data-date'));
                        const dateB = parseInt(b.getAttribute('data-date'));
                        return dateB - dateA;
                    });
                    
                    // å°‡æ’åºå¾Œçš„è¡Œæ·»åŠ åˆ°è¡¨æ ¼
                    allRows.forEach(row => {
                        tableBody.appendChild(row);
                    });
                    
                    console.log(`Generated ${allRows.length} random data rows`);
                    
                    // ç«‹å³æ›´æ–°åˆ†é ä¿¡æ¯
                    updatePaginationInfo();
                }
                



        });

                // åˆå§‹åŒ–TABåˆ‡æ›åŠŸèƒ½
                function initTabSwitching() {
                    const tabButtons = document.querySelectorAll('.tab-button');
                    tabButtons.forEach(button => {
                        button.addEventListener('click', function(e) {
                            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢è§¸ç™¼æŠ˜ç–Šé¢æ¿
                            e.stopPropagation();
                            
                            const tabType = this.getAttribute('data-tab');
                            tabButtons.forEach(btn => {
                                btn.classList.remove('active');
                                btn.classList.add('border-transparent', 'text-gray-500');
                                btn.classList.remove('border-blue-500', 'text-blue-600');
                            });
                            this.classList.add('active');
                            this.classList.remove('border-transparent', 'text-gray-500');
                            this.classList.add('border-blue-500', 'text-blue-600');
                            
                            // å¼·åˆ¶ç¢ºä¿ç¯©é¸å€åŸŸä¿æŒå±•é–‹ç‹€æ…‹
                            const filterContent = document.getElementById('filterContent');
                            const filterToggleIcon = document.querySelector('#filterToggle i.fas');
                            if (filterContent) {
                                filterContent.classList.add('expanded');
                                if (filterToggleIcon) {
                                    filterToggleIcon.classList.remove('fa-chevron-down');
                                    filterToggleIcon.classList.add('fa-chevron-up');
                                }
                            }
                            
                            const filterContents = document.querySelectorAll('.tab-content');
                            filterContents.forEach(content => {
                                content.classList.remove('active');
                                content.classList.add('hidden');
                            });
                            
                            const targetFilter = document.getElementById(`${tabType}-filter`);
                            if (targetFilter) {
                                targetFilter.classList.add('active');
                                targetFilter.classList.remove('hidden');
                            }
                            
                            const groupbuyTable = document.getElementById('groupbuy-table');
                            const userTable = document.getElementById('user-table');
                            const userChartArea = document.getElementById('userChartArea');
                            
                            // æ ¸å¿ƒæŒ‡æ¨™å’Œåˆè²·æ•´é«”æ•¸æ“šå€åŸŸ
                            // ä¿®å¾©Mac Safariå…¼å®¹æ€§ - ä¸ä½¿ç”¨:has()é¸æ“‡å™¨
                            const coreMetricsSection = document.getElementById('coreMetricsToggle').closest('.mb-4');
                            const overallDataSection = document.getElementById('overallDataToggle').closest('.mb-4');
                            
                            // åœ–è¡¨å³ä¸Šè§’çš„ç¶­åº¦åˆ‡æ›æŒ‰éˆ•
                            const chartTabsContainer = document.getElementById('chartDimensionTabs');
                            
                            if (tabType === 'groupbuy') {
                                groupbuyTable.classList.remove('hidden');
                                userTable.classList.add('hidden');
                                // éš±è—ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨å€åŸŸ
                                if (userChartArea) userChartArea.classList.add('hidden');
                                // é¡¯ç¤ºæ ¸å¿ƒæŒ‡æ¨™å’Œåˆè²·æ•´é«”æ•¸æ“š
                                if (coreMetricsSection) coreMetricsSection.style.display = 'block';
                                if (overallDataSection) overallDataSection.style.display = 'block';
                                // éš±è—åœ–è¡¨ç¶­åº¦åˆ‡æ›æŒ‰éˆ•ï¼ˆåˆè²·æŒ‡æ¨™ä¸å†æœ‰åœ–è¡¨ï¼‰
                                if (chartTabsContainer) chartTabsContainer.style.display = 'none';
                                
                                // åˆå§‹åŒ–åˆè²·æŒ‡æ¨™è¡¨æ ¼æ’åºåŠŸèƒ½
                                setTimeout(() => {
                                    initGroupbuyTableSorting();
                                }, 100);
                            } else if (tabType === 'user') {
                                groupbuyTable.classList.add('hidden');
                                userTable.classList.remove('hidden');
                                // é¡¯ç¤ºç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨å€åŸŸ
                                if (userChartArea) userChartArea.classList.remove('hidden');
                                // éš±è—æ ¸å¿ƒæŒ‡æ¨™å’Œåˆè²·æ•´é«”æ•¸æ“š
                                if (coreMetricsSection) coreMetricsSection.style.display = 'none';
                                if (overallDataSection) overallDataSection.style.display = 'none';
                                // é¡¯ç¤ºåœ–è¡¨ç¶­åº¦åˆ‡æ›æŒ‰éˆ•ï¼ˆç”¨æˆ¶æŒ‡æ¨™æœ‰åœ–è¡¨ï¼‰
                                if (chartTabsContainer) {
                                    chartTabsContainer.style.display = 'flex';
                                    chartTabsContainer.style.visibility = 'visible';
                                    chartTabsContainer.style.opacity = '1';
                                }
                                
                                // é¦–æ¬¡åˆ‡æ›åˆ°ç”¨æˆ¶æŒ‡æ¨™æ™‚ç”Ÿæˆæ•¸æ“š
                                if (!window.userDataGenerated) {
                                    generateUserData(200);
                                    updateUserTableHeaders('initiate');
                                    window.currentUserDataType = 'initiate';
                                    window.userDataGenerated = true;
                                    
                                    // ç¢ºä¿ç”¨æˆ¶æŒ‡æ¨™æ•¸æ“šä¹Ÿæœ‰æ­£ç¢ºçš„åˆ†é 
                                    setTimeout(() => {
                                        // é‡æ–°åˆå§‹åŒ–ç”¨æˆ¶è¡¨æ ¼åˆ†é ï¼Œç¢ºä¿åˆ†é æ­£å¸¸å·¥ä½œ
                                        const userTable = document.getElementById('user-table');
                                        if (userTable && !userTable.classList.contains('hidden')) {
                                            // ç²å–ç”¨æˆ¶åˆ†é ç³»çµ±çš„showCurrentPageå‡½æ•¸ä¸¦èª¿ç”¨
                                            const userPrevPage = document.getElementById('userPrevPage');
                                            if (userPrevPage && userPrevPage.onclick) {
                                                // è§¸ç™¼åˆ†é ç³»çµ±é‡æ–°è¨ˆç®—å’Œé¡¯ç¤º
                                                const event = new Event('change');
                                                document.getElementById('userItemsPerPageSelect').dispatchEvent(event);
                                            } else {
                                                // å¦‚æœåˆ†é ç³»çµ±é‚„æ²’åˆå§‹åŒ–ï¼Œæ‰‹å‹•è§¸ç™¼showCurrentPage
                                                updateUserPaginationInfo();
                                            }
                                        }
                                    }, 200);
                                }
                            }
                            
                            // æ›´æ–°åœ–è¡¨
                            updateChartForTab(tabType);
                        });
                    });
                }
                
                // æ ¹æ“šTABæ›´æ–°åœ–è¡¨ï¼ˆåƒ…ç”¨æ–¼ç”¨æˆ¶æŒ‡æ¨™ï¼‰
                function updateChartForTab(tabType) {
                    // éŠ·æ¯€æ‰€æœ‰ç¾æœ‰åœ–è¡¨
                    destroyAllCharts();
                    
                    // æ ¹æ“šTABé¡å‹å‰µå»ºå°æ‡‰åœ–è¡¨
                    if (tabType === 'user') {
                        // æ›´æ–°ç”¨æˆ¶æŒ‡æ¨™çš„åœ–è¡¨ç¶­åº¦æ¨™ç±¤
                        const metricType = document.getElementById('userMetricType').value;
                        updateChartDimensionTabs(tabType, metricType);
                        
                        // å‰µå»ºç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨
                        setTimeout(() => {
                            updateUserChart();
                        }, 200);
                    }
                    // åˆè²·æŒ‡æ¨™ä¸å†æœ‰åœ–è¡¨ï¼Œæ‰€ä»¥ç§»é™¤äº†ç›¸é—œé‚è¼¯
                }
                
                // æ›´æ–°ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨
                function updateUserChart() {
                    if (typeof Chart === 'undefined') {
                        console.error('Chart.js not available for updateUserChart');
                        return;
                    }
                    
                    const metricType = document.getElementById('userMetricType').value;
                    const timeGranularity = document.getElementById('userTimeGranularity').value;
                    
                    // ç²å–ç•¶å‰é¸ä¸­çš„åœ–è¡¨ç¶­åº¦é¡å‹ï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨é»˜èªå€¼
                    const chartType = window.currentUserChartType || (metricType === 'initiate' ? 'initiate_count' : 'participate_count');
                    
                    // ç²å–ç”¨æˆ¶æ•¸æ“š
                    const userData = getUserChartData(chartType, timeGranularity);
                    
                    // å¾¹åº•æ¸…ç†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„åœ–è¡¨å¯¦ä¾‹
                    destroyAllCharts();
                    
                    const ctx = document.getElementById('trendChart').getContext('2d');
                    const isDarkMode = document.body.classList.contains('dark');
                    
                    window.userChart = new Chart(ctx, {
                        type: 'bar', // ä½¿ç”¨æŸ±ç‹€åœ–æ›´é©åˆç”¨æˆ¶æŒ‡æ¨™
                        data: {
                            labels: userData.labels,
                            datasets: [{
                                label: getMetricLabel(chartType),
                                data: userData.values,
                                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                borderColor: '#3b82f6',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: isDarkMode ? '#e2e8f0' : '#1e293b'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: isDarkMode ? '#e2e8f0' : '#475569',
                                        callback: function(value) {
                                            // å¦‚æœæ˜¯æˆåŠŸç‡æˆ–å‹ç‡ç›¸é—œçš„åœ–è¡¨ï¼Œé¡¯ç¤º%ç¬¦è™Ÿ
                                            if (chartType.includes('rate')) {
                                                return value + '%';
                                            }
                                            return value;
                                        }
                                    },
                                    grid: {
                                        color: isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: getXAxisTitle(timeGranularity),
                                        color: isDarkMode ? '#e2e8f0' : '#475569'
                                    },
                                    ticks: {
                                        color: isDarkMode ? '#e2e8f0' : '#475569'
                                    },
                                    grid: {
                                        color: isDarkMode ? 'rgba(226, 232, 240, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                    }
                                }
                            }
                        }
                    });
                    
                    // æ·»åŠ ç”¨æˆ¶æŒ‡æ¨™çš„äº‹ä»¶ç›£è½å™¨
                    setupUserChartEventListeners();
                }
                
                // è¨­ç½®ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨çš„äº‹ä»¶ç›£è½å™¨
                function setupUserChartEventListeners() {
                    // ç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨
                    const userTimeGranularity = document.getElementById('userTimeGranularity');
                    const userMetricType = document.getElementById('userMetricType');
                    
                    // ç§»é™¤ä¹‹å‰çš„ç›£è½å™¨æ¨™è¨˜
                    if (userTimeGranularity.userChartListener) {
                        userTimeGranularity.removeEventListener('change', userTimeGranularity.userChartListener);
                    }
                    if (userMetricType.userChartListener) {
                        userMetricType.removeEventListener('change', userMetricType.userChartListener);
                    }
                    
                    // ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨ä¸å†è‡ªå‹•æ›´æ–°ï¼Œåªæœ‰åœ¨é»æ“Šæœç´¢æŒ‰éˆ•æ™‚æ‰æ›´æ–°
                    console.log('User chart event listeners removed - chart will only update on search');
                }
                
                // getMetricLabelå‡½æ•¸å·²ç§»è‡³å…¨å±€ä½œç”¨åŸŸ
                
                // ç²å–ç”¨æˆ¶åœ–è¡¨æ•¸æ“š
                function getUserChartData(metricType, timeGranularity) {
                    // ç›´æ¥å¾æ•¸æ“šè©³æƒ…ä¸­çš„å¯è¦‹æ•¸æ“šæå–ï¼Œç¢ºä¿åœ–è¡¨å’Œè¡¨æ ¼å®Œå…¨ä¸€è‡´
                    // ç²å–æ‰€æœ‰æœªè¢«ç¯©é¸éš±è—çš„è¡Œï¼ˆåŒ…æ‹¬è¢«åˆ†é éš±è—çš„è¡Œï¼‰
                    const allRows = Array.from(document.querySelectorAll('#userDataTable tr'));
                    const rows = allRows.filter(row => {
                        const cells = row.querySelectorAll('td');
                        // åªç²å–æœ‰æ•¸æ“šä¸”æœªè¢«ç¯©é¸éš±è—çš„è¡Œ
                        // é€™æ¨£åœ–è¡¨å°±æœƒé¡¯ç¤ºæ•¸æ“šè©³æƒ…ä¸­æ‰€æœ‰æ•¸æ“šçš„å®Œæ•´ç¯„åœ
                        return cells.length > 0 && row.style.display !== 'none' && !row.hasAttribute('data-filtered');
                    });
                    const dataMap = new Map();
                    const countMap = new Map(); // ç”¨æ–¼è¨ˆç®—å¹³å‡å€¼
                    
                    rows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        if (cells.length > 0) {
                            const fullDate = cells[0].textContent.trim();
                            let timeKey;
                            
                            if (timeGranularity === 'day') {
                                timeKey = fullDate;
                            } else if (timeGranularity === 'week') {
                                const dateObj = new Date(fullDate);
                                const year = dateObj.getFullYear();
                                const weekNumber = getWeekNumber(dateObj);
                                timeKey = `${year}-W${String(weekNumber).padStart(2, '0')}`;
                            } else if (timeGranularity === 'month') {
                                timeKey = fullDate.substring(0, 7);
                            }
                            
                            let value;
                            const currentMetricType = document.getElementById('userMetricType').value;
                            
                            switch(metricType) {
                                case 'initiate':
                                case 'initiate_count':
                                    value = parseInt(cells[3].textContent); // ç™¼èµ·åˆè²·æ¬¡æ•¸
                                    break;
                                case 'participate':
                                case 'participate_count':
                                    value = parseInt(cells[3].textContent); // åƒèˆ‡åˆè²·æ¬¡æ•¸
                                    break;
                                case 'success_rate':
                                    if (currentMetricType === 'initiate') {
                                        value = parseFloat(cells[6].textContent.replace('%', '')); // ç™¼èµ·çš„åˆè²·å‹ç‡
                                    } else {
                                        value = parseFloat(cells[4].textContent.replace('%', '')); // åƒèˆ‡åˆè²·å‹ç‡
                                    }
                                    break;
                                case 'win_rate':
                                    // ç™¼èµ·çš„åˆè²·å‹ç‡ (é‡å°initiateé¡å‹)
                                    if (currentMetricType === 'initiate') {
                                        value = parseFloat(cells[6].textContent.replace('%', '')); // ç™¼èµ·çš„åˆè²·å‹ç‡
                                    } else {
                                        value = 0;
                                    }
                                    break;
                                case 'participate_win_rate':
                                    // åƒèˆ‡åˆè²·å‹ç‡ (é‡å°participateé¡å‹)
                                    if (currentMetricType === 'participate') {
                                        value = parseFloat(cells[4].textContent.replace('%', '')); // åƒèˆ‡åˆè²·å‹ç‡
                                    } else {
                                        value = 0;
                                    }
                                    break;
                                case 'avg_bet_amount':
                                    // å¹³å‡åˆè²·æŠ•æ³¨é‡‘é¡ (é‡å°participateé¡å‹)
                                    if (currentMetricType === 'participate') {
                                        value = parseFloat(cells[5].textContent.replace(',', ''));
                                    } else {
                                        value = 0;
                                    }
                                    break;
                                case 'avg_win_amount':
                                    // å¹³å‡åˆè²·ä¸­çé‡‘é¡ (é‡å°participateé¡å‹)
                                    if (currentMetricType === 'participate') {
                                        value = parseFloat(cells[7].textContent.replace(',', '')) || 0;
                                    } else {
                                        value = 0;
                                    }
                                    break;
                                case 'win_amount':
                                    if (currentMetricType === 'participate') {
                                        value = parseInt(cells[7].textContent) || 0; // ç¸½ä¸­çé‡‘é¡
                                    } else {
                                        value = 0;
                                    }
                                    break;
                                case 'avg_amount':
                                    value = parseFloat(cells[5].textContent.replace(',', ''));
                                    break;
                                default:
                                    value = 0;
                            }
                            
                            if (!dataMap.has(timeKey)) {
                                dataMap.set(timeKey, value);
                                countMap.set(timeKey, 1);
                            } else {
                                dataMap.set(timeKey, dataMap.get(timeKey) + value);
                                countMap.set(timeKey, countMap.get(timeKey) + 1);
                            }
                        }
                    });
                    
                    const sortedKeys = Array.from(dataMap.keys()).sort();
                    const formattedLabels = sortedKeys.map(key => formatLabel(key, timeGranularity));
                    
                    // æ ¹æ“šæŒ‡æ¨™é¡å‹æ±ºå®šæ˜¯å¦éœ€è¦è¨ˆç®—å¹³å‡å€¼
                    let values;
                    if (metricType === 'success_rate' || metricType === 'avg_amount' || 
                        metricType === 'win_rate' || metricType === 'participate_win_rate' || 
                        metricType === 'avg_bet_amount' || metricType === 'avg_win_amount') {
                        // æˆåŠŸç‡å’Œå¹³å‡é‡‘é¡éœ€è¦è¨ˆç®—å¹³å‡å€¼
                        values = sortedKeys.map(key => {
                            const total = dataMap.get(key);
                            const count = countMap.get(key);
                            const avgValue = total / count;
                            // åœ–è¡¨æ•¸æ“šè¦æ¯”å€‹äººæ•¸æ“šå¤§ï¼Œä½†æˆåŠŸç‡å’Œå‹ç‡ä¸èƒ½è¶…é100%
                            if (metricType.includes('rate')) {
                                return Math.min(Math.round(avgValue * (1.2 + Math.random() * 0.3) * 100) / 100, 100);
                            } else {
                                // é‡‘é¡é¡æ•¸æ“šæ”¾å¤§1.5-2.5å€
                                return Math.round(avgValue * (1.5 + Math.random() * 1) * 100) / 100;
                            }
                        });
                    } else {
                        // æ¬¡æ•¸é¡æŒ‡æ¨™ç›´æ¥ç´¯åŠ ï¼Œä¸¦ä¸”æ”¾å¤§2-4å€ä½¿åœ–è¡¨æ•¸æ“šæ¯”å€‹äººæ•¸æ“šå¤§
                        values = sortedKeys.map(key => {
                            const originalValue = dataMap.get(key);
                            return Math.floor(originalValue * (2 + Math.random() * 2));
                        });
                    }
                    
                    return { labels: formattedLabels, values: values };
                }

                // ç”Ÿæˆç”¨æˆ¶æŒ‡æ¨™æ•¸æ“š
                function generateUserData(count) {
                    const tableBody = document.getElementById('userDataTable');
                    if (!tableBody) {
                        console.error('User table body not found!');
                        return;
                    }
                    
                    const metricType = document.getElementById('userMetricType').value;
                    const merchantIds = ['13589', '24671', '37824', '45912', '58763'];
                    tableBody.innerHTML = '';
                    const allRows = [];
                    
                    // é å…ˆå®šç¾©7å€‹ä¸åŒçš„æ—¥æœŸï¼Œç¢ºä¿åœ–è¡¨æœ‰è¶³å¤ çš„æ•¸æ“šé»
                    const today = new Date();
                    const baseDates = [];
                    for (let d = 0; d < 7; d++) {
                        const date = new Date(today);
                        date.setDate(today.getDate() - (d * 3 + Math.floor(Math.random() * 3))); // é–“éš”2-5å¤©
                        baseDates.push(date);
                    }
                    
                    for (let i = 0; i < count; i++) {
                        // 80%çš„æ¦‚ç‡é¸æ“‡é å®šç¾©çš„æ—¥æœŸï¼Œ20%çš„æ¦‚ç‡å®Œå…¨éš¨æ©Ÿ
                        let pastDay;
                        if (Math.random() < 0.8) {
                            pastDay = new Date(baseDates[Math.floor(Math.random() * baseDates.length)]);
                        } else {
                            pastDay = new Date(today);
                            pastDay.setDate(today.getDate() - Math.floor(Math.random() * 30));
                        }
                        const year = pastDay.getFullYear();
                        const month = String(pastDay.getMonth() + 1).padStart(2, '0');
                        const day = String(pastDay.getDate()).padStart(2, '0');
                        const dateStr = `${year}-${month}-${day}`;
                        
                        const merchantIndex = Math.floor(Math.random() * merchantIds.length);
                        const merchantId = merchantIds[merchantIndex];
                        const userId = Math.floor(10000 + Math.random() * 90000);
                        
                        const row = document.createElement('tr');
                        let rowHTML = '';
                        
                        if (metricType === 'initiate') {
                            // å‘èµ·åˆä¹°æ¬¡æ•°æ ä½
                            const initiateCount = Math.floor(1 + Math.random() * 20);
                            const successRate = (Math.random() * 100).toFixed(1);
                            const avgAmount = Math.floor(100 + Math.random() * 1900);
                            const winRate = (Math.random() * 100).toFixed(1);
                            
                            rowHTML = `
                                <td>${dateStr}</td>
                                <td>${merchantId}</td>
                                <td>${userId}</td>
                                <td>${initiateCount}</td>
                                <td>${successRate}%</td>
                                <td>${avgAmount}</td>
                                <td>${winRate}%</td>
                            `;
                        } else if (metricType === 'participate') {
                            // å‚ä¸åˆä¹°æ¬¡æ•°æ ä½
                            const participateCount = Math.floor(1 + Math.random() * 15);
                            const participateWinRate = (Math.random() * 100).toFixed(1);
                            const avgBetAmount = Math.floor(50 + Math.random() * 500);
                            const avgWinAmount = Math.floor(20 + Math.random() * 800);
                            const totalWinAmount = Math.floor(avgWinAmount * participateCount * (Math.random() * 2 + 1)) + Math.floor(Math.random() * 5000);
                            
                            rowHTML = `
                                <td>${dateStr}</td>
                                <td>${merchantId}</td>
                                <td>${userId}</td>
                                <td>${participateCount}</td>
                                <td>${participateWinRate}%</td>
                                <td>${avgBetAmount}</td>
                                <td>${avgWinAmount}</td>
                                <td>${totalWinAmount}</td>
                            `;
                        }
                        
                        row.innerHTML = rowHTML;
                        row.setAttribute('data-date', pastDay.getTime());
                        allRows.push(row);
                    }
                    
                    allRows.sort((a, b) => {
                        const dateA = parseInt(a.getAttribute('data-date'));
                        const dateB = parseInt(b.getAttribute('data-date'));
                        return dateB - dateA;
                    });
                    
                    allRows.forEach(row => {
                        tableBody.appendChild(row);
                    });
                }
                
                // åˆå§‹åŒ–ç”¨æˆ¶è¡¨æ ¼åˆ†é 
                function initUserTablePagination() {
                    const prevPageBtn = document.getElementById('userPrevPage');
                    const nextPageBtn = document.getElementById('userNextPage');
                    const pageNumbers = document.getElementById('userPageNumbers');
                    const itemsPerPageSelect = document.getElementById('userItemsPerPageSelect');
                    
                    let currentPage = 1;
                    let itemsPerPage = parseInt(itemsPerPageSelect.value);
                    let totalPages = 1;
                    
                    function updatePagination() {
                        const visibleRows = Array.from(document.querySelectorAll('#userDataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        const totalItems = visibleRows.length;
                        totalPages = Math.ceil(totalItems / itemsPerPage);
                        if (totalPages === 0) totalPages = 1;
                        if (currentPage > totalPages) currentPage = totalPages;
                        
                        prevPageBtn.disabled = currentPage === 1;
                        nextPageBtn.disabled = currentPage === totalPages;
                        pageNumbers.innerHTML = '';
                        
                        let startPage = Math.max(1, currentPage - 2);
                        let endPage = Math.min(totalPages, startPage + 4);
                        if (endPage - startPage < 4) startPage = Math.max(1, endPage - 4);
                        
                        for (let i = startPage; i <= endPage; i++) {
                            const pageBtn = document.createElement('button');
                            pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : 'btn-secondary'} text-xs py-1`;
                            pageBtn.textContent = i;
                            pageBtn.onclick = function() {
                                currentPage = i;
                                showCurrentPage();
                            };
                            pageNumbers.appendChild(pageBtn);
                        }
                        
                        const startRecord = document.getElementById('userStartRecord');
                        const endRecord = document.getElementById('userEndRecord');
                        const totalRecords = document.getElementById('userTotalRecords');
                        
                        if (totalItems === 0) {
                            startRecord.textContent = '0';
                            endRecord.textContent = '0';
                        } else {
                            const start = (currentPage - 1) * itemsPerPage + 1;
                            const end = Math.min(start + itemsPerPage - 1, totalItems);
                            startRecord.textContent = start;
                            endRecord.textContent = end;
                        }
                        totalRecords.textContent = totalItems;
                    }
                    
                    function showCurrentPage() {
                        // ç²å–æ‰€æœ‰è¡Œ
                        const allRows = Array.from(document.querySelectorAll('#userDataTable tr'));
                        const validRows = allRows.filter(row => row.querySelectorAll('td').length > 0);
                        
                        // ç²å–æœªè¢«ç¯©é¸éš±è—çš„è¡Œ
                        const unFilteredRows = validRows.filter(row => !row.hasAttribute('data-filtered'));
                        
                        const startIndex = (currentPage - 1) * itemsPerPage;
                        const endIndex = startIndex + itemsPerPage;
                        
                        // é¦–å…ˆéš±è—æ‰€æœ‰æœ‰æ•ˆè¡Œ
                        validRows.forEach(row => {
                            row.classList.add('hidden');
                        });
                        
                        // ç„¶å¾Œé¡¯ç¤ºç•¶å‰é çš„æœªç¯©é¸è¡Œ
                        unFilteredRows.forEach((row, index) => {
                            if (index >= startIndex && index < endIndex) {
                                row.classList.remove('hidden');
                                row.style.display = '';
                            } else {
                                row.classList.add('hidden');
                            }
                        });
                        
                        // ç¢ºä¿è¢«ç¯©é¸çš„è¡Œä¿æŒéš±è—
                        validRows.forEach(row => {
                            if (row.hasAttribute('data-filtered')) {
                                row.style.display = 'none';
                                row.classList.add('hidden');
                            }
                        });
                        
                        updatePagination();
                    }
                    
                    prevPageBtn.addEventListener('click', function() {
                        if (currentPage > 1) {
                            currentPage--;
                            showCurrentPage();
                        }
                    });
                    
                    nextPageBtn.addEventListener('click', function() {
                        if (currentPage < totalPages) {
                            currentPage++;
                            showCurrentPage();
                        }
                    });
                    
                    itemsPerPageSelect.addEventListener('change', function() {
                        itemsPerPage = parseInt(this.value);
                        currentPage = 1;
                        showCurrentPage();
                    });
                    
                    showCurrentPage();
                }
                
                // åˆå§‹åŒ–ç”¨æˆ¶è¡¨æ ¼æ’åº
                function initUserTableSorting() {
                    const table = document.querySelector('.user-table');
                    if (!table) {
                        console.warn('User table not found for sorting initialization');
                        return;
                    }
                    
                    const headers = table.querySelectorAll('th');
                    const tableBody = document.getElementById('userDataTable');
                    
                    // ç”±æ–¼è¡¨æ ¼æ¨™é¡Œæ˜¯å‹•æ…‹ç”Ÿæˆçš„ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ·»åŠ äº‹ä»¶ç›£è½å™¨
                    // ä½¿ç”¨å…¨å±€è®Šé‡ä¾†ä¿æŒæ’åºç‹€æ…‹
                    if (!window.userTableSortState) {
                        window.userTableSortState = {
                            sortDirection: 1,
                            lastSortedColumn: 'date'
                        };
                    }
                    
                    let sortDirection = window.userTableSortState.sortDirection;
                    let lastSortedColumn = window.userTableSortState.lastSortedColumn;
                    
                    headers.forEach(header => {
                        if (header.getAttribute('data-sort')) {
                            header.addEventListener('click', function() {
                                const column = this.getAttribute('data-sort');
                                if (column === lastSortedColumn) {
                                    sortDirection *= -1;
                                } else {
                                    sortDirection = 1;
                                    lastSortedColumn = column;
                                }
                                
                                // æ›´æ–°å…¨å±€ç‹€æ…‹
                                window.userTableSortState.sortDirection = sortDirection;
                                window.userTableSortState.lastSortedColumn = lastSortedColumn;
                                
                                headers.forEach(h => {
                                    const icon = h.querySelector('.sort-icon');
                                    if (icon) {
                                        icon.classList.remove('active');
                                        icon.innerHTML = '<i class="fas fa-sort"></i>';
                                    }
                                });
                                
                                const icon = this.querySelector('.sort-icon');
                                if (icon) {
                                    icon.classList.add('active');
                                    icon.innerHTML = sortDirection === 1 
                                        ? '<i class="fas fa-sort-up"></i>'
                                        : '<i class="fas fa-sort-down"></i>';
                                }
                                
                                sortUserTable(column, sortDirection);
                            });
                        }
                    });
                    
                    function sortUserTable(column, direction) {
                        const filterStatus = [];
                        const rows = Array.from(tableBody.querySelectorAll('tr'));
                        
                        rows.forEach(row => {
                            filterStatus.push({
                                row: row,
                                display: row.style.display,
                                hidden: row.classList.contains('hidden')
                            });
                        });
                        
                        let columnIndex;
                        switch (column) {
                            case 'date': columnIndex = 0; break;
                            case 'count': columnIndex = 3; break;
                            case 'rate': columnIndex = 4; break;
                            case 'amount': columnIndex = 5; break;
                            case 'winRate': columnIndex = 6; break;
                            default: columnIndex = 0;
                        }
                        
                        const sortedRows = rows.sort((a, b) => {
                            let aValue = a.querySelectorAll('td')[columnIndex].textContent.trim();
                            let bValue = b.querySelectorAll('td')[columnIndex].textContent.trim();
                            
                            if (column === 'count') {
                                aValue = parseInt(aValue);
                                bValue = parseInt(bValue);
                            } else if (column === 'rate' || column === 'winRate') {
                                aValue = parseFloat(aValue.replace('%', ''));
                                bValue = parseFloat(bValue.replace('%', ''));
                            } else if (column === 'amount') {
                                aValue = parseFloat(aValue.replace(',', ''));
                                bValue = parseFloat(bValue.replace(',', ''));
                            }
                            
                            if (aValue < bValue) return -1 * direction;
                            if (aValue > bValue) return 1 * direction;
                            return 0;
                        });
                        
                        tableBody.innerHTML = '';
                        sortedRows.forEach((row, index) => {
                            const status = filterStatus.find(s => s.row === row);
                            if (status) {
                                row.style.display = status.display;
                                if (status.hidden) {
                                    row.classList.add('hidden');
                                } else {
                                    row.classList.remove('hidden');
                                }
                            }
                            tableBody.appendChild(row);
                        });
                        
                        const visibleRows = Array.from(document.querySelectorAll('#userDataTable tr'))
                            .filter(row => row.style.display !== 'none');
                        document.getElementById('userTotalRecords').textContent = visibleRows.length;
                    }
                }

                // é‡ç½®æŒ‰éˆ•é»æ“Šäº‹ä»¶
                document.getElementById('resetBtn').addEventListener('click', function() {
                    // é‡ç½®æ‰€æœ‰ç¯©é¸æ¢ä»¶
                    document.getElementById('timeGranularity').value = 'day';
                    document.getElementById('merchantId').value = 'all';
                    document.getElementById('planId').value = '';
                    document.getElementById('status').value = 'all';
                    document.getElementById('initiatorId').value = '';
                    
                    // é‡ç½®æ—¥æœŸç‚ºé»˜èªå€¼
                    setupDefaultDates();
                    
                    // é¡¯ç¤ºæ—¥æœŸé¸æ“‡å™¨
                    updateDateSelector('day');
                    

                    
                    // é¡¯ç¤ºæ‰€æœ‰è¡¨æ ¼æ•¸æ“š
                    const tableRows = document.querySelectorAll('#dataTable tr');
                    tableRows.forEach(function(row) {
                        row.style.display = '';
                    });
                    
                    // æ›´æ–°åˆ†é ä¿¡æ¯
                    updatePaginationInfo();
                });
                
                // ç”¨æˆ¶æŒ‡æ¨™ç¯©é¸æŒ‰éˆ•é»æ“Šäº‹ä»¶
                document.getElementById('userFilterBtn').addEventListener('click', function() {
                    const timeGranularity = document.getElementById('userTimeGranularity').value;
                    let startDate, endDate;
                    
                    if (timeGranularity === 'day') {
                        startDate = document.getElementById('userStartDate').value;
                        endDate = document.getElementById('userEndDate').value;
                    } else if (timeGranularity === 'week') {
                        startDate = document.getElementById('userStartWeek').value;
                        endDate = document.getElementById('userEndWeek').value;
                    } else if (timeGranularity === 'month') {
                        startDate = document.getElementById('userStartMonth').value;
                        endDate = document.getElementById('userEndMonth').value;
                    }
                    
                    const merchantId = document.getElementById('userMerchantId').value;
                    const metricType = document.getElementById('userMetricType').value;
                    const userId = document.getElementById('userIdFilter').value;
                    
                    const activeTab = document.querySelector('.tab-button.active');
                    const tabType = activeTab ? activeTab.getAttribute('data-tab') : 'groupbuy';
                    
                    // æª¢æŸ¥æŒ‡æ¨™ç¶­åº¦æ˜¯å¦æœ‰è®ŠåŒ–
                    const metricTypeChanged = !window.currentUserDataType || window.currentUserDataType !== metricType;
                    
                    // åªæœ‰åœ¨æŒ‡æ¨™ç¶­åº¦æ”¹è®Šæ™‚æ‰æ›´æ–°è¡¨æ ¼æ¨™é¡Œå’Œåœ–è¡¨ç¶­åº¦æ¨™ç±¤
                    if (metricTypeChanged) {
                        console.log(`Metric type changed from ${window.currentUserDataType} to ${metricType}`);
                        updateUserTableHeaders(metricType);
                        
                        if (tabType === 'user') {
                            updateChartDimensionTabs('user', metricType);
                        }
                    }
                    
                    // ç¢ºä¿ç”¨æˆ¶æ•¸æ“šå·²ç¶“ç”Ÿæˆï¼Œå¦‚æœæ²’æœ‰ç”Ÿæˆéæˆ–è€…æŒ‡æ¨™ç¶­åº¦çœŸæ­£æ”¹è®Šæ™‚æ‰é‡æ–°ç”Ÿæˆæ•¸æ“š
                    if (!window.userDataGenerated || metricTypeChanged) {
                        console.log(`Generating user data for metric type: ${metricType}`);
                        generateUserData(200);
                        window.currentUserDataType = metricType; // è¨˜ä½ç•¶å‰æ•¸æ“šé¡å‹
                        window.userDataGenerated = true;
                    } else {
                        console.log(`Using existing user data for metric type: ${metricType}`);
                    }
                    
                    // ç¯©é¸è¡¨æ ¼æ•¸æ“š
                    filterUserTableData(merchantId, metricType, userId, timeGranularity, startDate, endDate);
                    
                    // æ›´æ–°åˆ†é ä¿¡æ¯ï¼Œç¢ºä¿åˆ†é åŠŸèƒ½æ­£å¸¸
                    updateUserPaginationInfo();
                    
                    // æ›´æ–°ç”¨æˆ¶æŒ‡æ¨™åœ–è¡¨ï¼ˆå¦‚æœç•¶å‰åœ¨ç”¨æˆ¶æŒ‡æ¨™TABï¼‰
                    if (tabType === 'user') {
                        // åªæœ‰åœ¨æŒ‡æ¨™ç¶­åº¦æ”¹è®Šæ™‚æ‰é‡ç½®åœ–è¡¨ç¶­åº¦ç‚ºé»˜èªå€¼
                        if (metricTypeChanged) {
                            window.currentUserChartType = metricType === 'initiate' ? 'initiate_count' : 'participate_count';
                        }
                        
                        // ç¸½æ˜¯æ›´æ–°åœ–è¡¨ï¼Œå› ç‚ºç¯©é¸æ¢ä»¶å¯èƒ½æ”¹è®Šäº†
                        setTimeout(() => {
                            updateUserChart();
                        }, 200);
                    }
                });
                
                // ç”¨æˆ¶æŒ‡æ¨™é‡ç½®æŒ‰éˆ•é»æ“Šäº‹ä»¶
                document.getElementById('userResetBtn').addEventListener('click', function() {
                    document.getElementById('userTimeGranularity').value = 'day';
                    document.getElementById('userMerchantId').value = 'all';
                    document.getElementById('userMetricType').value = 'initiate';
                    document.getElementById('userIdFilter').value = '';
                    
                    // é‡ç½®IDç¯©é¸æ¡†æ¨™ç±¤ç‚ºç™¼èµ·äººID
                    document.getElementById('userIdFilterLabel').textContent = 'å‘èµ·äººID';
                    document.getElementById('userIdFilter').placeholder = 'è¾“å…¥å‘èµ·äººIDæˆ–ç•™ç©º';
                    
                    setupUserDefaultDates();
                    updateUserDateSelector('day');
                    
                    const tableRows = document.querySelectorAll('#userDataTable tr');
                    tableRows.forEach(function(row) {
                        row.style.display = '';
                    });
                    
                    updateUserPaginationInfo();
                });
                
                // ç”¨æˆ¶æŒ‡æ¨™å°å‡ºæŒ‰éˆ•é»æ“Šäº‹ä»¶
                document.getElementById('userExportBtn').addEventListener('click', function() {
                    const visibleRows = Array.from(document.querySelectorAll('#userDataTable tr'))
                        .filter(row => row.style.display !== 'none');
                    
                    if (visibleRows.length === 0) {
                        alert('æ²’æœ‰æ•¸æ“šå¯åŒ¯å‡º');
                        return;
                    }
                    
                    const metricType = document.getElementById('userMetricType').value;
                    let csvContent = 'æ—¥æœŸ,å•†æˆ·ID,ç”¨æˆ·ID,æŒ‡æ ‡å€¼,æ¯”ç‡,é‡‘é¢,èƒœç‡\n';
                    
                    visibleRows.forEach(function(row) {
                        const cells = row.querySelectorAll('td');
                        let rowData = [];
                        
                        cells.forEach(function(cell) {
                            let cellText = cell.textContent.trim().replace(/,/g, '');
                            rowData.push(`"${cellText}"`);
                        });
                        
                        csvContent += rowData.join(',') + '\n';
                    });
                    
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    link.setAttribute('href', url);
                    link.setAttribute('download', `ç”¨æˆ·æŒ‡æ ‡æ•°æ®_${timestamp}.csv`);
                    link.style.visibility = 'hidden';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
                
                // è¨­ç½®ç”¨æˆ¶æŒ‡æ¨™é»˜èªæ—¥æœŸ
                function setupUserDefaultDates() {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    const today = `${year}-${month}-${day}`;
                    
                    // è¨­ç½®é–‹å§‹æ—¥æœŸç‚º30å¤©å‰ï¼Œç¢ºä¿èƒ½é¡¯ç¤ºå¤šå¤©çš„æ•¸æ“š
                    const startDate = new Date(now);
                    startDate.setDate(now.getDate() - 30);
                    const startYear = startDate.getFullYear();
                    const startMonth = String(startDate.getMonth() + 1).padStart(2, '0');
                    const startDay = String(startDate.getDate()).padStart(2, '0');
                    const startDateStr = `${startYear}-${startMonth}-${startDay}`;
                    
                    document.getElementById('userStartDate').value = startDateStr;
                    document.getElementById('userEndDate').value = today;
                    
                    const weekNumber = getWeekNumber(now);
                    const weekString = `${year}-W${String(weekNumber).padStart(2, '0')}`;
                    document.getElementById('userStartWeek').value = weekString;
                    document.getElementById('userEndWeek').value = weekString;
                    
                    const monthString = `${year}-${month}`;
                    document.getElementById('userStartMonth').value = monthString;
                    document.getElementById('userEndMonth').value = monthString;
                }
                
                // ç¯©é¸ç”¨æˆ¶è¡¨æ ¼æ•¸æ“š
                function filterUserTableData(merchantId, metricType, userId, timeGranularity, startDate, endDate) {
                    const tableRows = document.querySelectorAll('#userDataTable tr');
                    
                    tableRows.forEach(function(row) {
                        let display = true;
                        
                        if (startDate && endDate && display) {
                            const dateCell = row.querySelector('td:nth-child(1)');
                            if (dateCell) {
                                const rowDate = dateCell.textContent.trim();
                                
                                if (timeGranularity === 'day') {
                                    if (rowDate < startDate || rowDate > endDate) {
                                        display = false;
                                    }
                                } else if (timeGranularity === 'week') {
                                    const rowDateObj = new Date(rowDate);
                                    const rowYear = rowDateObj.getFullYear();
                                    const rowWeek = getWeekNumber(rowDateObj);
                                    const rowWeekStr = `${rowYear}-W${String(rowWeek).padStart(2, '0')}`;
                                    
                                    if (rowWeekStr < startDate || rowWeekStr > endDate) {
                                        display = false;
                                    }
                                } else if (timeGranularity === 'month') {
                                    const rowDateParts = rowDate.split('-');
                                    const rowYearMonth = `${rowDateParts[0]}-${rowDateParts[1]}`;
                                    
                                    if (rowYearMonth < startDate || rowYearMonth > endDate) {
                                        display = false;
                                    }
                                }
                            }
                        }
                        
                        if (merchantId !== 'all' && display) {
                            const merchantIdCell = row.querySelector('td:nth-child(2)');
                            if (merchantIdCell && merchantIdCell.textContent.trim() !== merchantId) {
                                display = false;
                            }
                        }
                        
                        // æª¢æŸ¥ç”¨æˆ¶IDï¼ˆæ ¹æ“šæŒ‡æ¨™ç¶­åº¦åˆ¤æ–·æ˜¯ç™¼èµ·äººIDé‚„æ˜¯åƒèˆ‡äººIDï¼‰
                        if (userId && display) {
                            const userIdCell = row.querySelector('td:nth-child(3)'); // ç”¨æˆ¶IDåœ¨ç¬¬3åˆ—
                            if (userIdCell && !userIdCell.textContent.includes(userId)) {
                                display = false;
                            }
                        }
                        
                        // ä½¿ç”¨ data å±¬æ€§æ¨™è¨˜ç¯©é¸ç‹€æ…‹ï¼Œé¿å…èˆ‡åˆ†é é‚è¼¯è¡çª
                        if (display) {
                            row.removeAttribute('data-filtered');
                        } else {
                            row.setAttribute('data-filtered', 'true');
                        }
                    });
                    
                    updateUserPaginationInfo();
                }
                
                // æ›´æ–°ç”¨æˆ¶åˆ†é ä¿¡æ¯
                function updateUserPaginationInfo() {
                    const allRows = document.querySelectorAll('#userDataTable tr');
                    
                    // è¨ˆç®—å¯è¦‹çš„è¡Œï¼ˆæœªè¢«ç¯©é¸éš±è—çš„è¡Œï¼‰
                    const visibleRows = Array.from(allRows).filter(row => 
                        row.querySelectorAll('td').length > 0 && !row.hasAttribute('data-filtered')
                    );
                    
                    const totalRecords = visibleRows.length;
                    
                    // æ›´æ–°ç¸½è¨˜éŒ„æ•¸
                    const totalRecordsSpan = document.getElementById('userTotalRecords');
                    if (totalRecordsSpan) {
                        totalRecordsSpan.textContent = totalRecords;
                    }
                    
                    // è§¸ç™¼ç”¨æˆ¶è¡¨æ ¼åˆ†é ç³»çµ±é‡æ–°è¨ˆç®—å’Œé¡¯ç¤º
                    // æª¢æŸ¥åˆ†é ç³»çµ±æ˜¯å¦å·²åˆå§‹åŒ–
                    const userItemsPerPageSelect = document.getElementById('userItemsPerPageSelect');
                    if (userItemsPerPageSelect) {
                        // è§¸ç™¼åˆ†é ç³»çµ±çš„changeäº‹ä»¶ä¾†é‡æ–°è¨ˆç®—åˆ†é 
                        const changeEvent = new Event('change');
                        userItemsPerPageSelect.dispatchEvent(changeEvent);
                    } else {
                        // å¦‚æœåˆ†é ç³»çµ±é‚„æ²’åˆå§‹åŒ–ï¼Œæ‰‹å‹•é€²è¡Œç¬¬ä¸€é çš„é¡¯ç¤º
                        const itemsPerPage = 10; // é»˜èªæ¯é 10æ¢
                        visibleRows.forEach((row, index) => {
                            if (index < itemsPerPage) {
                                row.classList.remove('hidden');
                                row.style.display = '';
                            } else {
                                row.classList.add('hidden');
                            }
                        });
                        
                        // æ›´æ–°åˆ†é ä¿¡æ¯é¡¯ç¤º
                        const startRecord = document.getElementById('userStartRecord');
                        const endRecord = document.getElementById('userEndRecord');
                        
                        if (startRecord && endRecord) {
                            if (totalRecords === 0) {
                                startRecord.textContent = '0';
                                endRecord.textContent = '0';
                            } else {
                                startRecord.textContent = '1';
                                endRecord.textContent = Math.min(itemsPerPage, totalRecords).toString();
                            }
                        }
                    }
                }

                // æ–°å¢ï¼šæ•¸æ“šè©³æƒ…ç¯©é¸æ§åˆ¶è¡¨æ ¼
                document.getElementById('tableFilterBtn').addEventListener('click', function() {
                    // å–å¾—ç¯©é¸æ¢ä»¶
                    const timeGranularity = document.getElementById('tableTimeGranularity').value;
                    let startDate, endDate;
                    if (timeGranularity === 'day') {
                        startDate = document.getElementById('tableStartDate').value;
                        endDate = document.getElementById('tableEndDate').value;
                    } else if (timeGranularity === 'week') {
                        startDate = document.getElementById('tableStartWeek').value;
                        endDate = document.getElementById('tableEndWeek').value;
                    } else if (timeGranularity === 'month') {
                        startDate = document.getElementById('tableStartMonth').value;
                        endDate = document.getElementById('tableEndMonth').value;
                    }
                    const merchantId = document.getElementById('tableMerchantId').value;
                    const planId = document.getElementById('tablePlanId').value;
                    const initiatorId = document.getElementById('tableInitiatorId').value;
                    // åªæ§åˆ¶è¡¨æ ¼
                    filterTableData(merchantId, planId, null, initiatorId, timeGranularity, startDate, endDate);
                });
                document.getElementById('tableResetBtn').addEventListener('click', function() {
                    document.getElementById('tableTimeGranularity').value = 'day';
                    document.getElementById('tableMerchantId').value = 'all';
                    document.getElementById('tablePlanId').value = '';
                    document.getElementById('tableInitiatorId').value = '';
                    // é‡ç½®æ—¥æœŸ
                    const today = '2025-01-01';
                    document.getElementById('tableStartDate').value = today;
                    document.getElementById('tableEndDate').value = today;
                    const weekString = '2025-W01';
                    document.getElementById('tableStartWeek').value = weekString;
                    document.getElementById('tableEndWeek').value = weekString;
                    const monthString = '2025-01';
                    document.getElementById('tableStartMonth').value = monthString;
                    document.getElementById('tableEndMonth').value = monthString;
                    // é¡¯ç¤ºæ‰€æœ‰è¡¨æ ¼æ•¸æ“š
                    const tableRows = document.querySelectorAll('#dataTable tr');
                    tableRows.forEach(function(row) {
                        row.style.display = '';
                    });
                    updatePaginationInfo();
                    // æ—¥æœŸé¸æ“‡å™¨é¡¯ç¤ºæ­£ç¢º
                    updateTableDateSelector('day');
                });
                document.getElementById('tableExportBtn').addEventListener('click', function() {
                    const visibleRows = Array.from(document.querySelectorAll('#dataTable tr'))
                        .filter(row => row.style.display !== 'none');
                    if (visibleRows.length === 0) {
                        alert('æ²’æœ‰æ•¸æ“šå¯åŒ¯å‡º');
                        return;
                    }
                    let csvContent = 'æ—¥æœŸ,å•†æˆ·ID,åˆä¹°åºå·,å‘èµ·äººID,å‚ä¸äººæ•°,åˆä¹°æ€»é‡‘é¢,åˆä¹°çŠ¶æ€,ä¸­å¥–é‡‘é¢\n';
                    visibleRows.forEach(function(row) {
                        const cells = row.querySelectorAll('td');
                        let rowData = [];
                        cells.forEach(function(cell) {
                            let cellText = cell.textContent.trim().replace(/,/g, '');
                            rowData.push(`"${cellText}"`);
                        });
                        csvContent += rowData.join(',') + '\n';
                    });
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    link.setAttribute('href', url);
                    link.setAttribute('download', `åˆä¹°æ•°æ®_${timestamp}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });

                // ä¸‹æ–¹æ•¸æ“šè©³æƒ…ç¯©é¸å€åŸŸçš„æ™‚é–“ç¶­åº¦åˆ‡æ›ï¼Œå°é½Šä¸Šæ–¹é‚è¼¯
                function getCurrentWeekString() {
                    const now = new Date();
                    const year = now.getFullYear();
                    // è¨ˆç®—ISOé€±æ•¸
                    const firstDayOfYear = new Date(year, 0, 1);
                    const pastDaysOfYear = (now - firstDayOfYear) / 86400000;
                    const week = Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
                    return `${year}-W${String(week).padStart(2, '0')}`;
                }
                function getCurrentMonthString() {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    return `${year}-${month}`;
                }
                function getCurrentDateString() {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                }
                function updateTableDateSelector(granularity) {
                    const daySelector = document.getElementById('tableDaySelector');
                    const weekSelector = document.getElementById('tableWeekSelector');
                    const monthSelector = document.getElementById('tableMonthSelector');
                    daySelector.classList.add('hidden');
                    weekSelector.classList.add('hidden');
                    monthSelector.classList.add('hidden');
                    if (granularity === 'day') {
                        daySelector.classList.remove('hidden');
                        const today = getCurrentDateString();
                        document.getElementById('tableStartDate').value = today;
                        document.getElementById('tableEndDate').value = today;
                    } else if (granularity === 'week') {
                        weekSelector.classList.remove('hidden');
                        const weekString = getCurrentWeekString();
                        document.getElementById('tableStartWeek').value = weekString;
                        document.getElementById('tableEndWeek').value = weekString;
                    } else if (granularity === 'month') {
                        monthSelector.classList.remove('hidden');
                        const monthString = getCurrentMonthString();
                        document.getElementById('tableStartMonth').value = monthString;
                        document.getElementById('tableEndMonth').value = monthString;
                    }
                }
                document.getElementById('tableTimeGranularity').addEventListener('change', function() {
                    updateTableDateSelector(this.value);
                });
                // åˆå§‹åŒ–æ™‚æ ¹æ“šé è¨­å€¼é¡¯ç¤ºæ­£ç¢ºçš„æ—¥æœŸé¸æ“‡å™¨
                updateTableDateSelector(document.getElementById('tableTimeGranularity').value);

                // ä¿®æ­£é‡ç½®æ™‚é€±/æœˆé è¨­ç‚ºç•¶å‰é€±/æœˆ
                document.getElementById('tableResetBtn').addEventListener('click', function() {
                    document.getElementById('tableTimeGranularity').value = 'day';
                    document.getElementById('tableMerchantId').value = 'all';
                    document.getElementById('tablePlanId').value = '';
                    document.getElementById('tableInitiatorId').value = '';
                    // é‡ç½®æ—¥æœŸ
                    const today = getCurrentDateString();
                    document.getElementById('tableStartDate').value = today;
                    document.getElementById('tableEndDate').value = today;
                    const weekString = getCurrentWeekString();
                    document.getElementById('tableStartWeek').value = weekString;
                    document.getElementById('tableEndWeek').value = weekString;
                    const monthString = getCurrentMonthString();
                    document.getElementById('tableStartMonth').value = monthString;
                    document.getElementById('tableEndMonth').value = monthString;
                    // é¡¯ç¤ºæ‰€æœ‰è¡¨æ ¼æ•¸æ“š
                    const tableRows = document.querySelectorAll('#dataTable tr');
                    tableRows.forEach(function(row) {
                        row.style.display = '';
                    });
                    updatePaginationInfo();
                    // æ—¥æœŸé¸æ“‡å™¨é¡¯ç¤ºæ­£ç¢º
                    updateTableDateSelector('day');
                });

    </script>
    </div>
</body>
</html>