<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éˆå±…å¹³å° - ä»²ä»‹ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0,0,0,0.05);
            z-index: 90;
        }

        .nav-btn {
            transition: all 0.2s;
        }

        .nav-btn.active {
            color: #2563eb;
        }

        .project-card {
            transition: all 0.2s;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-slate-50">

    <!-- ç™»å…¥é  -->
    <div id="login-page" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
        <div class="bg-white rounded-3xl shadow-2xl p-12 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-black text-slate-900 mb-2">éˆå±…å¹³å°</h1>
                <p class="text-slate-500">ä»²ä»‹ç«¯ç³»çµ±</p>
            </div>

            <div class="space-y-4 mb-6">
                <input type="text" id="username" placeholder="å¸³è™Ÿ" class="w-full bg-slate-50 border-0 rounded-2xl p-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500">
                <input type="password" id="password" placeholder="å¯†ç¢¼" class="w-full bg-slate-50 border-0 rounded-2xl p-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <button onclick="login()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-lg shadow-xl hover:bg-blue-700 active:scale-95 transition-all">
                ç™»å…¥ç³»çµ±
            </button>
        </div>
    </div>

    <!-- ä¸»æ‡‰ç”¨ -->
    <div id="app" class="hidden pb-24">
        <!-- é ‚éƒ¨å°èˆª -->
        <header class="bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-50">
            <div class="flex justify-between items-center">
                <div>
                    <h1 id="page-title" class="text-xl font-black text-slate-900">æ¡ˆæºæŸ¥è©¢</h1>
                    <p class="text-xs text-slate-500 mt-0.5" id="user-info">ä¿¡ç¾©æˆ¿å±‹ - å¤§å®‰åº— - ç‹æ¥­å‹™</p>
                </div>
                <button onclick="logout()" class="text-xs text-slate-400 hover:text-slate-600 font-bold">ç™»å‡º</button>
            </div>
        </header>

        <!-- å…§å®¹å€ -->
        <div id="content" class="p-6"></div>

        <!-- åº•éƒ¨å°èˆª -->
        <nav class="bottom-nav">
            <div class="flex justify-around items-center py-3">
                <button onclick="navigateTo('search')" id="nav-search" class="nav-btn active flex flex-col items-center text-slate-400 font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                    <span class="text-xs">æ¡ˆæºæŸ¥è©¢</span>
                </button>
                <button onclick="navigateTo('reports')" id="nav-reports" class="nav-btn flex flex-col items-center text-slate-400 font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    <span class="text-xs">å ±å‚™ç‹€æ…‹</span>
                </button>
                <button onclick="navigateTo('commission')" id="nav-commission" class="nav-btn flex flex-col items-center text-slate-400 font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span class="text-xs">æˆäº¤ä½£é‡‘</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-8 left-1/2 transform -translate-x-1/2 bg-black/80 text-white px-6 py-4 rounded-2xl text-sm font-medium opacity-0 pointer-events-none transition-opacity duration-300 z-[200] shadow-xl">
        æ“ä½œæˆåŠŸ
    </div>

    <script>
        // æ¨¡æ“¬è³‡æ–™
        const projects = [
            {
                id: 'B10112345',
                name: 'ç’åœ’æ¥µä¸Š',
                city: 'å°åŒ—å¸‚',
                district: 'å…§æ¹–å€',
                road: 'æ°‘æ¬Šæ±è·¯å…­æ®µ',
                builder: 'ç’åœ’å»ºè¨­',
                price_min: 3280,
                price_max: 4580,
                area_min: 45,
                area_max: 68,
                layout: '2-3æˆ¿',
                type: 'æ–°æˆå±‹',
                img: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=800',
                cooperation_status: 'active',  // active / paused / need_confirm
                recent_reports_count: 12,  // è¿‘7å¤©å ±å‚™æ•¸
                weekly_capacity: 'æœ¬é€±å°šå¯æ¥å¾…',
                commission_rate_hint: 'ç´„ 2%',
                sla_response_time: 'é€šå¸¸ 24 å°æ™‚å…§å›è¦†'
            },
            {
                id: 'B22012346',
                name: 'é é›„æ£®æ²³ç•”',
                city: 'æ–°åŒ—å¸‚',
                district: 'æ¿æ©‹å€',
                road: 'ç’°æ²³è·¯å››æ®µ',
                builder: 'é é›„å»ºè¨­',
                price_min: 1850,
                price_max: 2650,
                area_min: 32,
                area_max: 48,
                layout: '2-3æˆ¿',
                type: 'é å”®å±‹',
                img: 'https://images.unsplash.com/photo-1582407947304-fd86f028f716?w=800',
                cooperation_status: 'active',
                recent_reports_count: 8,
                weekly_capacity: 'æœ¬é€±å°šå¯æ¥å¾…',
                commission_rate_hint: 'ç´„ 2.5%',
                sla_response_time: 'é€šå¸¸ 24 å°æ™‚å…§å›è¦†'
            },
            {
                id: 'B10312347',
                name: 'åœ‹æ³°å¤§ç¾',
                city: 'å°åŒ—å¸‚',
                district: 'ä¸­å±±å€',
                road: 'å—äº¬æ±è·¯ä¸‰æ®µ',
                builder: 'åœ‹æ³°å»ºè¨­',
                price_min: 5600,
                price_max: 8200,
                area_min: 68,
                area_max: 95,
                layout: '3-4æˆ¿',
                type: 'è±ªå®…',
                img: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=800',
                cooperation_status: 'paused',
                recent_reports_count: 3,
                weekly_capacity: 'æš«åœå ±å‚™ä¸­',
                commission_rate_hint: 'ä¾æˆäº¤å¦è­°',
                sla_response_time: 'é€šå¸¸ 48 å°æ™‚å…§å›è¦†'
            },
            {
                id: 'B10112348',
                name: 'ä¿¡ç¾©ä¹‹æ˜Ÿ',
                city: 'å°åŒ—å¸‚',
                district: 'ä¿¡ç¾©å€',
                road: 'æ¾ä»è·¯',
                builder: 'ä¿¡ç¾©æˆ¿å±‹',
                price_min: 6800,
                price_max: 12000,
                area_min: 75,
                area_max: 120,
                layout: '3-5æˆ¿',
                type: 'è±ªå®…',
                img: 'https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=800',
                cooperation_status: 'active',
                recent_reports_count: 25,
                weekly_capacity: 'ç†±é–€æ¡ˆä»¶',
                commission_rate_hint: 'ç´„ 1.8%',
                sla_response_time: 'é€šå¸¸ 12 å°æ™‚å…§å›è¦†'
            },
            {
                id: 'B22012349',
                name: 'æ½¤æ³°å¤§ç›´',
                city: 'å°åŒ—å¸‚',
                district: 'ä¸­å±±å€',
                road: 'åŒ—å®‰è·¯',
                builder: 'æ½¤æ³°å»ºè¨­',
                price_min: 4200,
                price_max: 6500,
                area_min: 55,
                area_max: 88,
                layout: '2-4æˆ¿',
                type: 'æ–°æˆå±‹',
                img: 'https://images.unsplash.com/photo-1613977257363-707ba9348227?w=800',
                cooperation_status: 'active',
                recent_reports_count: 15,
                weekly_capacity: 'æœ¬é€±å°šå¯æ¥å¾…',
                commission_rate_hint: 'ç´„ 2.2%',
                sla_response_time: 'é€šå¸¸ 24 å°æ™‚å…§å›è¦†'
            }
        ];

        let reports = [
            {
                id: 'R2024001',
                project_id: 'B10112345',
                project_name: 'ç’åœ’æ¥µä¸Š',
                buyer_name: 'ç‹å°æ˜',
                buyer_phone: '0912-345-678',
                broker_store: 'ä¿¡ç¾©æˆ¿å±‹ - å¤§å®‰åº—',
                status: 'approved',
                created_at: '2024-01-10 14:32',
                preferred_date: '2024-01-15',
                preferred_time: '14:00',
                scheduled_date: '2024-01-15',
                scheduled_time: '14:00',
                viewing_qr_code: 'QR_R2024001_V001',  // QR Code ç”¨æ–¼ä»£éŠ·æƒæ
                approved_at: '2024-01-11 09:20'
            },
            {
                id: 'R2024002',
                project_id: 'B22012346',
                project_name: 'é é›„æ£®æ²³ç•”',
                buyer_name: 'æå¤§è¯',
                buyer_phone: '0923-456-789',
                broker_store: 'ä¿¡ç¾©æˆ¿å±‹ - å¤§å®‰åº—',
                status: 'pending',
                created_at: '2024-01-11 10:20',
                preferred_date: '2024-01-18',
                preferred_time: '10:00',
                scheduled_date: null,
                scheduled_time: null
            },
            {
                id: 'R2024003',
                project_id: 'B10112345',
                project_name: 'ç’åœ’æ¥µä¸Š',
                buyer_name: 'é™³ç¾ç²',
                buyer_phone: '0934-567-890',
                broker_store: 'ä¿¡ç¾©æˆ¿å±‹ - å¤§å®‰åº—',
                status: 'cancelled_after_approved',
                created_at: '2024-01-08 15:30',
                preferred_date: '2024-01-12',
                preferred_time: '15:00',
                scheduled_date: '2024-01-12',
                scheduled_time: '15:00',
                approved_at: '2024-01-09 10:15',
                cancelled_at: '2024-01-11 14:20',
                cancel_reason: 'buyer_changed_mind',
                cancel_note: 'è²·æ–¹æ”¹è®Šè³¼å±‹è¨ˆç•«'
            }
        ];

        let deals = [
            {
                deal_id: 'D2024001',
                project_name: 'ç’åœ’æ¥µä¸Š',
                buyer_name: 'å¼µå…ˆç”Ÿ',
                deal_price: 3580,
                commission_rate: 2,
                performance: 71.6,
                broker_commission: 42.96,
                deal_date: '2024-01-05',
                status: 'confirmed'
            }
        ];

        let currentPage = 'search';
        let currentUser = {
            store: 'ä¿¡ç¾©æˆ¿å±‹ - å¤§å®‰åº—',
            name: 'ç‹æ¥­å‹™'
        };

        // ç¯©é¸ç‹€æ…‹
        let currentFilters = {
            city: 'å…¨éƒ¨',
            district: '',
            priceMin: '',
            priceMax: '',
            type: '',
            search: ''
        };

        // é¦–æ¬¡ç™»å…¥æ¨™è¨˜ï¼ˆç”¨æ–¼é¡¯ç¤ºåˆ¶åº¦æé†’ï¼‰
        let firstLogin = true;

        // ç™»å…¥
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showToast('è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼');
                return;
            }

            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            navigateTo('search');
            showToast('ç™»å…¥æˆåŠŸ');
        }

        // ç™»å‡º
        function logout() {
            document.getElementById('app').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // å°èˆª
        function navigateTo(page) {
            currentPage = page;

            // æ›´æ–°åº•éƒ¨å°èˆª
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`nav-${page}`).classList.add('active');

            // æ›´æ–°æ¨™é¡Œ
            const titles = {
                search: 'æ¡ˆæºæŸ¥è©¢',
                reports: 'å ±å‚™ç‹€æ…‹æŸ¥è©¢',
                commission: 'æˆäº¤ä½£é‡‘æŸ¥è©¢'
            };
            document.getElementById('page-title').textContent = titles[page];

            // æ¸²æŸ“å…§å®¹
            if (page === 'search') renderProjectSearch();
            else if (page === 'reports') renderReportList();
            else if (page === 'commission') renderCommissionList();
        }

        // Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('opacity-100');
            setTimeout(() => toast.classList.remove('opacity-100'), 2500);
        }

        // ===== [A-01] æ¡ˆæºæŸ¥è©¢ =====
        function renderProjectSearch() {
            const content = document.getElementById('content');

            // ç¯©é¸æ¡ˆæº
            let filteredProjects = projects.filter(p => {
                if (currentFilters.city !== 'å…¨éƒ¨' && p.city !== currentFilters.city) return false;
                if (currentFilters.district && p.district !== currentFilters.district) return false;
                if (currentFilters.type && p.type !== currentFilters.type) return false;
                if (currentFilters.priceMin && p.price_max < parseInt(currentFilters.priceMin)) return false;
                if (currentFilters.priceMax && p.price_min > parseInt(currentFilters.priceMax)) return false;
                if (currentFilters.search && !p.name.includes(currentFilters.search) && !p.district.includes(currentFilters.search)) return false;
                return true;
            });

            const cities = ['å…¨éƒ¨', 'å°åŒ—å¸‚', 'æ–°åŒ—å¸‚', 'æ¡ƒåœ’å¸‚', 'å°ä¸­å¸‚'];

            content.innerHTML = `
                <div class="fade-in">
                    ${firstLogin ? renderSystemReminder() : ''}

                    <!-- æœå°‹æ¡† -->
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text"
                                   value="${currentFilters.search}"
                                   oninput="updateSearch(this.value)"
                                   placeholder="æœå°‹æ¡ˆåã€åœ°å€..."
                                   class="w-full bg-white border border-slate-200 rounded-2xl pl-12 pr-4 py-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                        </div>
                    </div>

                    <!-- åŸå¸‚åˆ‡æ›æ¨™ç±¤ -->
                    <div class="flex gap-2 overflow-x-auto pb-2 mb-6">
                        ${cities.map(c => `
                            <button onclick="setFilterCity('${c}')"
                                    class="px-5 py-2.5 rounded-2xl text-xs font-bold whitespace-nowrap transition-all ${currentFilters.city === c ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white' : 'bg-white text-slate-400 border border-slate-100'}">
                                ${c}
                            </button>
                        `).join('')}
                    </div>

                    <!-- é€²éšç¯©é¸ -->
                    <div class="bg-white rounded-2xl p-4 mb-6 border border-slate-100">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-bold text-slate-900 text-sm">é€²éšç¯©é¸</h3>
                            <button onclick="resetFilters()" class="text-xs text-blue-600 font-bold">æ¸…é™¤</button>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <select onchange="setFilterType(this.value)" class="bg-slate-50 border-0 rounded-xl p-3 text-xs font-bold outline-none">
                                <option value="">é¡å‹</option>
                                <option value="æ–°æˆå±‹" ${currentFilters.type === 'æ–°æˆå±‹' ? 'selected' : ''}>æ–°æˆå±‹</option>
                                <option value="é å”®å±‹" ${currentFilters.type === 'é å”®å±‹' ? 'selected' : ''}>é å”®å±‹</option>
                                <option value="è±ªå®…" ${currentFilters.type === 'è±ªå®…' ? 'selected' : ''}>è±ªå®…</option>
                            </select>
                            <select onchange="setFilterDistrict(this.value)" class="bg-slate-50 border-0 rounded-xl p-3 text-xs font-bold outline-none">
                                <option value="">åœ°å€</option>
                                ${[...new Set(filteredProjects.map(p => p.district))].map(d => `
                                    <option value="${d}" ${currentFilters.district === d ? 'selected' : ''}>${d}</option>
                                `).join('')}
                            </select>
                            <input type="number"
                                   placeholder="æœ€ä½ç¸½åƒ¹(è¬)"
                                   value="${currentFilters.priceMin}"
                                   oninput="setFilterPriceMin(this.value)"
                                   class="bg-slate-50 border-0 rounded-xl p-3 text-xs font-bold outline-none">
                            <input type="number"
                                   placeholder="æœ€é«˜ç¸½åƒ¹(è¬)"
                                   value="${currentFilters.priceMax}"
                                   oninput="setFilterPriceMax(this.value)"
                                   class="bg-slate-50 border-0 rounded-xl p-3 text-xs font-bold outline-none">
                        </div>
                    </div>

                    <!-- çµæœçµ±è¨ˆ -->
                    <p class="text-sm text-slate-500 mb-4">å…±æ‰¾åˆ° ${filteredProjects.length} å€‹å»ºæ¡ˆ</p>

                    <!-- å»ºæ¡ˆåˆ—è¡¨ -->
                    ${filteredProjects.length > 0 ? `
                        <div class="space-y-6">
                            ${filteredProjects.map(p => renderProjectCard(p)).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-12">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto mb-4 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <p class="text-slate-400 text-sm">æŸ¥ç„¡ç¬¦åˆæ¢ä»¶çš„å»ºæ¡ˆ</p>
                        </div>
                    `}
                </div>
            `;
        }

        function renderProjectCard(project) {
            // æª¢æŸ¥è©²åº—æ˜¯å¦å·²å ±å‚™éæ­¤æ¡ˆ
            const alreadyReported = reports.some(r =>
                r.project_id === project.id &&
                r.broker_store === currentUser.store &&
                (r.status === 'pending' || r.status === 'approved')
            );

            // åˆä½œç‹€æ…‹é…ç½®
            const statusConfig = {
                'active': { text: 'å¯ç«‹å³å ±å‚™', color: 'bg-green-100 text-green-700 border-green-200' },
                'paused': { text: 'æš«åœå ±å‚™', color: 'bg-red-100 text-red-700 border-red-200' },
                'need_confirm': { text: 'éœ€ä»£éŠ·ç¢ºèª', color: 'bg-yellow-100 text-yellow-700 border-yellow-200' }
            };

            const status = statusConfig[project.cooperation_status];
            const canReport = project.cooperation_status === 'active' && !alreadyReported;

            return `
                <div onclick="${canReport ? `showProjectDetail('${project.id}')` : ''}"
                     class="project-card bg-white rounded-[32px] overflow-hidden shadow-sm border border-slate-100 ${canReport ? 'cursor-pointer' : 'opacity-75'}">

                    <!-- ä¸»è¦–è¦ºåœ– -->
                    <div class="h-52 relative">
                        <img src="${project.img}" class="w-full h-full object-cover">
                        <div class="absolute top-4 left-4 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-[10px] font-bold text-blue-600">
                            ${project.type}
                        </div>
                        ${alreadyReported ? `
                            <div class="absolute top-4 right-4 bg-orange-500 text-white px-3 py-1 rounded-full text-[10px] font-bold">
                                å·²å ±å‚™
                            </div>
                        ` : ''}
                    </div>

                    <!-- æ¡ˆæºè³‡è¨Š -->
                    <div class="p-5">
                        <!-- æ¡ˆåèˆ‡åœ°å€ -->
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h3 class="font-bold text-xl text-slate-900 mb-1">${project.name}</h3>
                                <p class="text-slate-400 text-xs">${project.city}${project.district} Â· ${project.builder}</p>
                            </div>
                            <div class="text-right ml-3">
                                <span class="text-2xl font-black text-rose-500">${project.price_min}</span>
                                <span class="text-[10px] font-bold text-rose-500 block">è¬èµ·</span>
                            </div>
                        </div>

                        <!-- é—œéµæ±ºç­–è³‡è¨Š -->
                        <div class="flex flex-wrap gap-1.5 mb-3">
                            <!-- åˆä½œç‹€æ…‹ -->
                            <span class="px-2 py-1 ${status.color} border rounded-md text-xs font-bold">
                                ${status.text}
                            </span>

                            <!-- å ±å‚™ç†±åº¦ -->
                            ${project.recent_reports_count > 0 ? `
                                <span class="px-2 py-1 bg-blue-50 text-blue-700 border border-blue-200 rounded-md text-xs font-bold">
                                    è¿‘7å¤© ${project.recent_reports_count} çµ„å ±å‚™
                                </span>
                            ` : ''}

                            <!-- ä½£é‡‘ç‡æç¤º -->
                            <span class="px-2 py-1 bg-purple-50 text-purple-700 border border-purple-200 rounded-md text-xs font-bold">
                                ä½£é‡‘ ${project.commission_rate_hint}
                            </span>
                        </div>

                        <!-- é€±é–“æ¥å¾…ç‹€æ³ -->
                        <div class="p-3 bg-slate-50 rounded-xl mb-3">
                            <p class="text-xs text-slate-500 mb-1">æ¥å¾…ç‹€æ³</p>
                            <p class="text-sm font-bold text-slate-900">${project.weekly_capacity}</p>
                        </div>

                        <!-- åº•éƒ¨è¡Œå‹•æç¤º -->
                        ${alreadyReported ? `
                            <div class="pt-3 border-t border-slate-100">
                                <p class="text-xs text-orange-600 font-bold text-center">
                                    âš ï¸ ä½ å·²å ±å‚™éæ­¤æ¡ˆï¼Œç„¡æ³•é‡è¤‡å ±å‚™
                                </p>
                            </div>
                        ` : project.cooperation_status === 'paused' ? `
                            <div class="pt-3 border-t border-slate-100">
                                <p class="text-xs text-red-600 font-bold text-center">
                                    âš ï¸ æ­¤æ¡ˆæš«åœå ±å‚™ä¸­
                                </p>
                            </div>
                        ` : `
                            <div class="pt-3 border-t border-slate-100">
                                <p class="text-xs text-blue-600 font-bold text-center">
                                    ğŸ‘‰ é»æ“ŠæŸ¥çœ‹è©³æƒ…ä¸¦å ±å‚™è²·æ–¹
                                </p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // ç³»çµ±åˆ¶åº¦æé†’æ¢
        function renderSystemReminder() {
            return `
                <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6 rounded-xl relative">
                    <button onclick="dismissReminder()" class="absolute top-2 right-2 text-blue-400 hover:text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    <div class="flex items-start gap-3 pr-6">
                        <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-900 text-sm mb-2">é‡è¦åˆ¶åº¦æé†’</h4>
                            <ul class="space-y-1 text-xs text-slate-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600 font-bold flex-shrink-0">â€¢</span>
                                    <span><strong>å¸¶çœ‹å®Œæˆéœ€ç”±ä»£éŠ·æƒæ QR Code</strong>ï¼Œå¦å‰‡ä¸è¨ˆå…¥å¸¶çœ‹èˆ‡æ¥­ç¸¾</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600 font-bold flex-shrink-0">â€¢</span>
                                    <span><strong>æ ¸å¯ â‰  å¸¶çœ‹</strong>ï¼Œéœ€ç­‰ä»£éŠ·æ’å®šæ™‚é–“ä¸¦å®Œæˆç¾å ´æƒæç¢ºèª</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600 font-bold flex-shrink-0">â€¢</span>
                                    <span>å ±å‚™éœ€ç¶“ä»£éŠ·æ ¸å¯ï¼Œéå³æ™‚æ’å®š</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function dismissReminder() {
            firstLogin = false;
            renderProjectSearch();
        }

        // ç¯©é¸å‡½æ•¸
        function setFilterCity(city) {
            currentFilters.city = city;
            currentFilters.district = '';  // åˆ‡æ›åŸå¸‚æ™‚æ¸…é™¤åœ°å€
            renderProjectSearch();
        }

        function setFilterType(type) {
            currentFilters.type = type;
            renderProjectSearch();
        }

        function setFilterDistrict(district) {
            currentFilters.district = district;
            renderProjectSearch();
        }

        function setFilterPriceMin(value) {
            currentFilters.priceMin = value;
            renderProjectSearch();
        }

        function setFilterPriceMax(value) {
            currentFilters.priceMax = value;
            renderProjectSearch();
        }

        function updateSearch(value) {
            currentFilters.search = value;
            renderProjectSearch();
        }

        function resetFilters() {
            currentFilters = {
                city: 'å…¨éƒ¨',
                district: '',
                priceMin: '',
                priceMax: '',
                type: '',
                search: ''
            };
            renderProjectSearch();
        }

        // å»ºæ¡ˆè©³ç´°é 
        function showProjectDetail(projectId) {
            const project = projects.find(p => p.id === projectId);
            const content = document.getElementById('content');

            // æª¢æŸ¥æ˜¯å¦å·²å ±å‚™
            const alreadyReported = reports.some(r =>
                r.project_id === project.id &&
                r.broker_store === currentUser.store &&
                (r.status === 'pending' || r.status === 'approved')
            );

            const canReport = project.cooperation_status === 'active' && !alreadyReported;

            content.innerHTML = `
                <div class="fade-in pb-6">
                    <button onclick="navigateTo('search')" class="flex items-center gap-2 text-slate-500 mb-6 font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                        è¿”å›åˆ—è¡¨
                    </button>

                    <!-- ä¸»è¦–è¦º -->
                    <div class="rounded-3xl overflow-hidden mb-6">
                        <img src="${project.img}" class="w-full h-80 object-cover">
                    </div>

                    <!-- åŸºæœ¬è³‡è¨Š -->
                    <div class="bg-white rounded-3xl p-6 mb-6 border border-slate-100">
                        <h1 class="text-3xl font-black text-slate-900 mb-2">${project.name}</h1>
                        <p class="text-blue-600 font-bold mb-2">${project.city}${project.district} Â· ${project.road}</p>
                        <p class="text-sm text-slate-500 mb-6">å»ºå•†ï¼š${project.builder}</p>

                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="p-4 bg-slate-50 rounded-xl">
                                <p class="text-xs text-slate-500 mb-1">åªæ•¸å€é–“</p>
                                <p class="text-lg font-black text-slate-900">${project.area_min}-${project.area_max} åª</p>
                            </div>
                            <div class="p-4 bg-slate-50 rounded-xl">
                                <p class="text-xs text-slate-500 mb-1">æ ¼å±€</p>
                                <p class="text-lg font-black text-slate-900">${project.layout}</p>
                            </div>
                            <div class="p-4 bg-slate-50 rounded-xl">
                                <p class="text-xs text-slate-500 mb-1">é¡å‹</p>
                                <p class="text-lg font-black text-slate-900">${project.type}</p>
                            </div>
                            <div class="p-4 bg-slate-50 rounded-xl">
                                <p class="text-xs text-slate-500 mb-1">ä½£é‡‘ç‡</p>
                                <p class="text-lg font-black text-purple-600">${project.commission_rate_hint}</p>
                            </div>
                        </div>

                        <div class="p-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl text-white mb-4">
                            <p class="text-sm opacity-80 mb-2">ç¸½åƒ¹å€é–“</p>
                            <p class="text-4xl font-black">${project.price_min}-${project.price_max} <span class="text-xl">è¬</span></p>
                        </div>

                        <!-- å ±å‚™ç†±åº¦ -->
                        <div class="p-4 bg-blue-50 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs text-blue-600 mb-1">æœ€è¿‘å ±å‚™ç†±åº¦</p>
                                    <p class="text-sm font-bold text-blue-900">è¿‘ 7 å¤©å·²æœ‰ ${project.recent_reports_count} çµ„å ±å‚™</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-xs text-blue-600 mb-1">æ¥å¾…ç‹€æ³</p>
                                    <p class="text-sm font-bold text-blue-900">${project.weekly_capacity}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å»ºæ¡ˆä»‹ç´¹ -->
                    <div class="bg-white rounded-3xl p-6 mb-6 border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-900 mb-4">å»ºæ¡ˆä»‹ç´¹</h3>
                        <p class="text-slate-600 leading-loose">
                            ${project.name} ä½æ–¼ ${project.district} æ ¸å¿ƒåœ°æ®µï¼Œäº¤é€šä¾¿åˆ©ï¼Œç”Ÿæ´»æ©Ÿèƒ½å®Œå–„ã€‚
                            æœ¬æ¡ˆç”± ${project.builder} è¦åŠƒï¼Œæ¡ç”¨é«˜å“è³ªå»ºæï¼Œå…¬è¨­å®Œå–„ï¼Œæ˜¯æ‚¨ç†æƒ³çš„å±…ä½é¸æ“‡ã€‚
                        </p>
                    </div>

                    <!-- å ±å‚™è¦å‰‡æç¤ºå€å¡Š -->
                    <div class="bg-yellow-50 border-l-4 border-yellow-600 p-5 mb-6 rounded-xl">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 bg-yellow-600 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-slate-900 text-sm mb-3">å ±å‚™æµç¨‹èˆ‡è¦å‰‡</h4>
                                <ul class="space-y-2 text-xs text-slate-700">
                                    <li class="flex items-start gap-2">
                                        <span class="text-yellow-600 font-bold flex-shrink-0">1.</span>
                                        <span><strong>å ±å‚™éœ€ç¶“ä»£éŠ·æ ¸å¯ï¼Œéå³æ™‚æ’å®š</strong></span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="text-yellow-600 font-bold flex-shrink-0">2.</span>
                                        <span>å¯¦éš›å¸¶çœ‹æ™‚é–“ä»¥ä»£éŠ·æ’å®šç‚ºæº–ï¼ˆ${project.sla_response_time}ï¼‰</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="text-yellow-600 font-bold flex-shrink-0">3.</span>
                                        <span><strong>å®Œæˆå¸¶çœ‹éœ€ç”±ä»£éŠ·æƒæ QR Code æ‰è¨ˆå…¥å¸¶çœ‹èˆ‡æ¥­ç¸¾</strong></span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="text-yellow-600 font-bold flex-shrink-0">4.</span>
                                        <span>åŒä¸€è²·æ–¹ 7 æ—¥å…§ä¸å¯é‡è¤‡å ±å‚™æ­¤æ¡ˆ</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸å¯å ±å‚™æƒ…å¢ƒæç¤º -->
                    ${!canReport ? `
                        <div class="bg-red-50 border border-red-200 p-5 mb-6 rounded-xl">
                            <div class="flex items-start gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-red-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <div class="flex-1">
                                    <h4 class="font-bold text-red-900 text-sm mb-2">ç„¡æ³•å ±å‚™</h4>
                                    <p class="text-xs text-red-700">
                                        ${alreadyReported ? 'ä½ å·²å ±å‚™éæ­¤æ¡ˆï¼Œç„¡æ³•é‡è¤‡å ±å‚™' : project.cooperation_status === 'paused' ? 'æ­¤æ¡ˆæš«åœå ±å‚™ä¸­' : 'æ­¤æ¡ˆéœ€ä»£éŠ·ç¢ºèªå¾Œæ‰å¯å ±å‚™'}
                                    </p>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <!-- å ±å‚™æŒ‰éˆ• -->
                    <button onclick="${canReport ? `showReportForm('${project.id}')` : 'return false'}"
                            class="w-full py-5 rounded-2xl font-bold text-lg shadow-xl transition-all ${canReport ? 'bg-blue-600 text-white hover:bg-blue-700 active:scale-95 cursor-pointer' : 'bg-slate-200 text-slate-400 cursor-not-allowed'}">
                        ${canReport ? 'å ±å‚™è²·æ–¹' : 'ç„¡æ³•å ±å‚™'}
                    </button>
                </div>
            `;
        }

        // ===== [A-02] å ±å‚™é€å‡º =====
        function showReportForm(projectId) {
            const project = projects.find(p => p.id === projectId);
            const content = document.getElementById('content');

            content.innerHTML = `
                <div class="fade-in">
                    <button onclick="showProjectDetail('${projectId}')" class="flex items-center gap-2 text-slate-500 mb-6 font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                        è¿”å›
                    </button>

                    <div class="bg-white rounded-3xl p-6 border border-slate-100">
                        <h2 class="text-2xl font-black text-slate-900 mb-2">å ±å‚™è²·æ–¹</h2>
                        <p class="text-slate-500 mb-1">${project.name}</p>
                        <p class="text-xs text-slate-400 mb-6">å¯¦éš›å¸¶çœ‹æ™‚é–“ä»¥ä»£éŠ·æ ¸å¯ç‚ºæº–ï¼ˆ${project.sla_response_time}ï¼‰</p>

                        <form onsubmit="submitReport(event, '${projectId}')" class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-2">è²·æ–¹å§“å *</label>
                                <input type="text"
                                       id="buyer-name"
                                       required
                                       class="w-full bg-slate-50 border-0 rounded-2xl p-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="è«‹è¼¸å…¥å§“å">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-2">è²·æ–¹é›»è©± *</label>
                                <input type="tel"
                                       id="buyer-phone"
                                       required
                                       pattern="09[0-9]{2}-[0-9]{3}-[0-9]{3}"
                                       oninput="checkDuplicateReport('${projectId}')"
                                       class="w-full bg-slate-50 border-0 rounded-2xl p-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="09XX-XXX-XXX">
                                <div id="duplicate-warning" class="hidden mt-2 p-3 bg-orange-50 border border-orange-200 rounded-xl">
                                    <p class="text-xs text-orange-700 font-bold">âš ï¸ æ­¤è²·æ–¹å·²å ±å‚™æ­¤å»ºæ¡ˆï¼Œè«‹å‹¿é‡è¤‡é€å‡º</p>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-2">å¸Œæœ›å¸¶çœ‹æ—¥æœŸ *</label>
                                <input type="date"
                                       id="preferred-date"
                                       required
                                       class="w-full bg-slate-50 border-0 rounded-2xl p-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-slate-400 mt-2">â€» éœ€é¸æ“‡ä»Šæ—¥æˆ–ä¹‹å¾Œçš„æ—¥æœŸ</p>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-2">å¸Œæœ›å¸¶çœ‹æ™‚é–“ *</label>
                                <input type="time"
                                       id="preferred-time"
                                       required
                                       class="w-full bg-slate-50 border-0 rounded-2xl p-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <!-- é€å‡ºå‰æç¤º -->
                            <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-xl mt-6">
                                <div class="flex items-start gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <div class="flex-1">
                                        <p class="text-xs font-bold text-slate-900 mb-1">é€å‡ºå‰è«‹ç¢ºèª</p>
                                        <ul class="text-xs text-slate-700 space-y-1">
                                            <li>â€¢ é€å‡ºå¾Œéœ€ç¶“ä»£éŠ·æ ¸å¯ï¼Œéä¿è­‰å¸¶çœ‹</li>
                                            <li>â€¢ è«‹ç¢ºèªè²·æ–¹è³‡æ–™æ­£ç¢ºï¼Œé¿å…ç³¾ç´›</li>
                                            <li>â€¢ åŒä¸€è²·æ–¹ 7 æ—¥å…§ä¸å¯é‡è¤‡å ±å‚™</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <button type="submit"
                                    id="submit-button"
                                    class="w-full bg-blue-600 text-white py-5 rounded-2xl font-bold text-lg shadow-xl hover:bg-blue-700 active:scale-95 transition-all mt-6">
                                ç¢ºèªé€å‡ºå ±å‚™
                            </button>
                        </form>
                    </div>
                </div>
            `;

            // è¨­å®šæœ€å°æ—¥æœŸç‚ºä»Šå¤©
            document.getElementById('preferred-date').min = new Date().toISOString().split('T')[0];
        }

        // å³æ™‚æª¢æŸ¥é‡è¤‡å ±å‚™
        function checkDuplicateReport(projectId) {
            const buyerPhone = document.getElementById('buyer-phone').value;
            const warningEl = document.getElementById('duplicate-warning');
            const submitBtn = document.getElementById('submit-button');

            if (!buyerPhone || buyerPhone.length < 12) {
                warningEl.classList.add('hidden');
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                return;
            }

            const duplicate = reports.find(r =>
                r.project_id === projectId &&
                r.buyer_phone === buyerPhone &&
                (r.status === 'pending' || r.status === 'approved')
            );

            if (duplicate) {
                warningEl.classList.remove('hidden');
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                warningEl.classList.add('hidden');
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function submitReport(event, projectId) {
            event.preventDefault();

            const buyerName = document.getElementById('buyer-name').value;
            const buyerPhone = document.getElementById('buyer-phone').value;
            const preferredDate = document.getElementById('preferred-date').value;
            const preferredTime = document.getElementById('preferred-time').value;

            // æª¢æŸ¥é‡è¤‡å ±å‚™
            const duplicate = reports.find(r =>
                r.project_id === projectId &&
                r.buyer_phone === buyerPhone &&
                (r.status === 'pending' || r.status === 'approved')
            );

            if (duplicate) {
                showToast('æ­¤è²·æ–¹å·²å ±å‚™æ­¤å»ºæ¡ˆï¼Œè«‹å‹¿é‡è¤‡é€å‡º');
                return;
            }

            // æ–°å¢å ±å‚™
            const newReport = {
                id: 'R2024' + String(reports.length + 1).padStart(3, '0'),
                project_id: projectId,
                project_name: projects.find(p => p.id === projectId).name,
                buyer_name: buyerName,
                buyer_phone: buyerPhone,
                status: 'pending',
                created_at: new Date().toISOString().slice(0, 16).replace('T', ' '),
                preferred_date: preferredDate,
                preferred_time: preferredTime,
                scheduled_date: null,
                scheduled_time: null
            };

            reports.push(newReport);
            showToast('âœ… å ±å‚™é€å‡ºæˆåŠŸï¼ç­‰å¾…ä»£éŠ·æ ¸å¯');

            setTimeout(() => {
                navigateTo('reports');
            }, 1500);
        }

        // ===== [A-03] å ±å‚™ç‹€æ…‹æŸ¥è©¢ =====
        function renderReportList() {
            const content = document.getElementById('content');

            const statusGroups = {
                pending: reports.filter(r => r.status === 'pending'),
                approved: reports.filter(r => r.status === 'approved'),
                completed: reports.filter(r => r.status === 'completed'),
                cancelled: reports.filter(r => r.status === 'cancelled_after_approved'),
                rejected: reports.filter(r => r.status === 'rejected')
            };

            content.innerHTML = `
                <div class="fade-in">
                    <!-- é ç±¤ -->
                    <div class="flex gap-2 overflow-x-auto mb-6 pb-2">
                        <button onclick="filterReports('all')" class="px-4 py-2 bg-blue-600 text-white rounded-full text-xs font-bold whitespace-nowrap">å…¨éƒ¨ (${reports.length})</button>
                        <button onclick="filterReports('pending')" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-bold whitespace-nowrap">å¾…æ ¸å¯ (${statusGroups.pending.length})</button>
                        <button onclick="filterReports('approved')" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-bold whitespace-nowrap">å·²æ ¸å¯ (${statusGroups.approved.length})</button>
                        <button onclick="filterReports('completed')" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-bold whitespace-nowrap">å·²å¸¶çœ‹ (${statusGroups.completed.length})</button>
                        <button onclick="filterReports('cancelled')" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-bold whitespace-nowrap">å·²å–æ¶ˆ (${statusGroups.cancelled.length})</button>
                    </div>

                    <!-- å ±å‚™åˆ—è¡¨ -->
                    <div class="space-y-4">
                        ${reports.length === 0 ? `
                            <div class="text-center py-20">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-slate-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                <p class="text-slate-400 font-bold">å°šç„¡å ±å‚™è¨˜éŒ„</p>
                            </div>
                        ` : reports.map(r => renderReportCard(r)).join('')}
                    </div>
                </div>
            `;
        }

        function renderReportCard(report) {
            const nextStep = getNextStep(report);

            return `
                <div class="bg-white rounded-2xl p-5 border border-slate-100">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h3 class="font-bold text-slate-900">${maskName(report.buyer_name)} ${maskPhone(report.buyer_phone)}</h3>
                            <p class="text-sm text-slate-500 mt-1">${report.project_name}</p>
                        </div>
                        <span class="px-3 py-1 ${getStatusColor(report.status)} rounded-full text-xs font-bold">${getStatusText(report.status)}</span>
                    </div>

                    ${report.status === 'approved' ? `
                        <!-- å·²æ ¸å¯ï¼šé¡¯ç¤ºå¸¶çœ‹æ™‚é–“ + QR Code -->
                        <div class="p-4 bg-blue-50 rounded-xl mb-3">
                            <p class="text-xs text-blue-600 font-bold mb-2">å·²æ’å®šå¸¶çœ‹æ™‚é–“</p>
                            <p class="text-sm text-blue-900 font-black mb-3">${report.scheduled_date} ${report.scheduled_time}</p>

                            <!-- QR Code å€åŸŸ -->
                            <div class="bg-white p-3 rounded-lg border border-blue-200 mb-3">
                                <p class="text-xs text-slate-600 font-bold mb-2 text-center">å¸¶çœ‹ QR Codeï¼ˆç¾å ´å‡ºç¤ºçµ¦ä»£éŠ·æƒæï¼‰</p>
                                <div id="qr-${report.id}" class="flex justify-center"></div>
                                <p class="text-xs text-slate-400 text-center mt-2">QR Code: ${report.viewing_qr_code}</p>
                            </div>

                            <button onclick="event.stopPropagation(); showCancelReportModal('${report.id}')"
                                    class="w-full py-2 bg-red-50 text-red-600 rounded-lg text-sm font-bold hover:bg-red-100 transition-all">
                                å–æ¶ˆæ­¤å ±å‚™
                            </button>
                        </div>
                    ` : report.status === 'cancelled_after_approved' ? `
                        <!-- å·²å–æ¶ˆï¼šé¡¯ç¤ºå–æ¶ˆè³‡è¨Š -->
                        <div class="p-4 bg-slate-50 rounded-xl mb-3">
                            <p class="text-xs text-slate-500 mb-2">å–æ¶ˆæ™‚é–“ï¼š${report.cancelled_at}</p>
                            <p class="text-xs text-slate-600"><span class="font-bold">å–æ¶ˆåŸå› ï¼š</span>${getCancelReasonText(report.cancel_reason)}</p>
                            ${report.cancel_note ? `<p class="text-xs text-slate-600 mt-1"><span class="font-bold">èªªæ˜ï¼š</span>${report.cancel_note}</p>` : ''}
                        </div>
                    ` : ''}

                    <!-- ä¸‹ä¸€æ­¥æç¤º + æŸ¥çœ‹è©³æƒ… -->
                    <div class="flex justify-between items-center pt-3 border-t border-slate-100">
                        <p class="text-xs text-slate-500">${nextStep}</p>
                        <button onclick="showReportDetail('${report.id}')" class="text-xs text-blue-600 font-bold">æŸ¥çœ‹è©³æƒ… â†’</button>
                    </div>
                </div>
            `;
        }

        // åœ¨å ±å‚™å¡ç‰‡æ¸²æŸ“å¾Œï¼Œç”Ÿæˆ QR Code
        function renderReportList() {
            const content = document.getElementById('content');

            const statusGroups = {
                pending: reports.filter(r => r.status === 'pending'),
                approved: reports.filter(r => r.status === 'approved'),
                completed: reports.filter(r => r.status === 'completed'),
                cancelled: reports.filter(r => r.status === 'cancelled_after_approved'),
                rejected: reports.filter(r => r.status === 'rejected')
            };

            content.innerHTML = `
                <div class="fade-in">
                    <!-- é ç±¤ -->
                    <div class="flex gap-2 overflow-x-auto mb-6 pb-2">
                        <button onclick="filterReports('all')" class="px-4 py-2 bg-blue-600 text-white rounded-full text-xs font-bold whitespace-nowrap">å…¨éƒ¨ (${reports.length})</button>
                        <button onclick="filterReports('pending')" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-bold whitespace-nowrap">å¾…æ ¸å¯ (${statusGroups.pending.length})</button>
                        <button onclick="filterReports('approved')" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-bold whitespace-nowrap">å·²æ ¸å¯ (${statusGroups.approved.length})</button>
                        <button onclick="filterReports('completed')" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-bold whitespace-nowrap">å·²å¸¶çœ‹ (${statusGroups.completed.length})</button>
                        <button onclick="filterReports('cancelled')" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-bold whitespace-nowrap">å·²å–æ¶ˆ (${statusGroups.cancelled.length})</button>
                    </div>

                    <!-- å ±å‚™åˆ—è¡¨ -->
                    <div class="space-y-4">
                        ${reports.length === 0 ? `
                            <div class="text-center py-20">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-slate-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                <p class="text-slate-400 font-bold">å°šç„¡å ±å‚™è¨˜éŒ„</p>
                            </div>
                        ` : reports.map(r => renderReportCard(r)).join('')}
                    </div>
                </div>
            `;

            // æ¸²æŸ“å®Œæˆå¾Œï¼Œç‚ºæ‰€æœ‰å·²æ ¸å¯çš„å ±å‚™ç”Ÿæˆ QR Code
            setTimeout(() => {
                reports.filter(r => r.status === 'approved').forEach(r => {
                    const qrContainer = document.getElementById(`qr-${r.id}`);
                    if (qrContainer && !qrContainer.hasChildNodes()) {
                        new QRCode(qrContainer, {
                            text: r.viewing_qr_code,
                            width: 120,
                            height: 120
                        });
                    }
                });
            }, 100);
        }

        // ç²å–ä¸‹ä¸€æ­¥æç¤º
        function getNextStep(report) {
            if (report.status === 'pending') {
                return 'â–¶ ä¸‹ä¸€æ­¥ï¼šç­‰å¾…ä»£éŠ·æ ¸å¯';
            } else if (report.status === 'approved') {
                return 'â–¶ ä¸‹ä¸€æ­¥ï¼šæº–æ™‚å¸¶çœ‹ä¸¦å‡ºç¤º QR Code';
            } else if (report.status === 'completed') {
                return 'å·²å®Œæˆå¸¶çœ‹æµç¨‹';
            } else if (report.status === 'cancelled_after_approved') {
                return 'å·²å–æ¶ˆï¼Œæµç¨‹çµæŸ';
            } else if (report.status === 'rejected') {
                return 'å·²è¢«ä»£éŠ·æ‹’çµ•';
            }
            return 'é»æ“ŠæŸ¥çœ‹è©³æƒ…';
        }

        // å–æ¶ˆåŸå› æ–‡å­—å°æ‡‰
        function getCancelReasonText(reason) {
            const reasonMap = {
                'buyer_changed_mind': 'è²·æ–¹æ”¹è®Šå¿ƒæ„',
                'buyer_unreachable': 'è²·æ–¹ç„¡æ³•è¯çµ¡',
                'schedule_conflict': 'æ™‚é–“è¡çª',
                'bought_elsewhere': 'è²·æ–¹å·²è³¼è²·å…¶ä»–ç‰©ä»¶',
                'conditions_not_met': 'æ¢ä»¶ä¸ç¬¦',
                'other': 'å…¶ä»–åŸå› '
            };
            return reasonMap[reason] || reason;
        }

        // é¡¯ç¤ºå–æ¶ˆå ±å‚™å½ˆçª—
        function showCancelReportModal(reportId) {
            const report = reports.find(r => r.id === reportId);

            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] flex items-center justify-center px-4';
            overlay.innerHTML = `
                <div class="bg-white w-full max-w-md rounded-3xl p-8 shadow-2xl">
                    <h3 class="text-xl font-black text-slate-900 mb-2">å–æ¶ˆå ±å‚™</h3>
                    <p class="text-sm text-slate-500 mb-6">${report.project_name} - ${maskName(report.buyer_name)}</p>

                    <div class="bg-red-50 border border-red-200 p-4 rounded-xl mb-6">
                        <p class="text-xs text-red-700 font-bold">âš ï¸ æ³¨æ„äº‹é …</p>
                        <ul class="text-xs text-red-600 mt-2 space-y-1">
                            <li>â€¢ å–æ¶ˆå¾Œç„¡æ³•å¾©åŸ</li>
                            <li>â€¢ éœ€é¸æ“‡å–æ¶ˆåŸå› ï¼ˆä»£éŠ·æœƒçœ‹åˆ°ï¼‰</li>
                            <li>â€¢ ä¸è¨ˆå…¥å¸¶çœ‹ç´€éŒ„</li>
                        </ul>
                    </div>

                    <form onsubmit="submitCancelReport(event, '${reportId}')" class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-2">å–æ¶ˆåŸå›  *</label>
                            <select id="cancel-reason" required class="w-full bg-slate-50 border-0 rounded-2xl p-4 text-sm font-bold outline-none">
                                <option value="">è«‹é¸æ“‡åŸå› </option>
                                <option value="buyer_changed_mind">è²·æ–¹æ”¹è®Šå¿ƒæ„</option>
                                <option value="buyer_unreachable">è²·æ–¹ç„¡æ³•è¯çµ¡</option>
                                <option value="schedule_conflict">æ™‚é–“è¡çª</option>
                                <option value="bought_elsewhere">è²·æ–¹å·²è³¼è²·å…¶ä»–ç‰©ä»¶</option>
                                <option value="conditions_not_met">æ¢ä»¶ä¸ç¬¦</option>
                                <option value="other">å…¶ä»–åŸå› </option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-2">è£œå……èªªæ˜ï¼ˆé¸å¡«ï¼‰</label>
                            <textarea id="cancel-note"
                                      rows="3"
                                      class="w-full bg-slate-50 border-0 rounded-2xl p-4 text-sm outline-none resize-none"
                                      placeholder="å¯è£œå……èªªæ˜å…·é«”æƒ…æ³..."></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="py-3 bg-slate-100 text-slate-600 rounded-xl font-bold">è¿”å›</button>
                            <button type="submit" class="py-3 bg-red-600 text-white rounded-xl font-bold">ç¢ºèªå–æ¶ˆ</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        // æäº¤å–æ¶ˆå ±å‚™
        function submitCancelReport(event, reportId) {
            event.preventDefault();

            const reason = document.getElementById('cancel-reason').value;
            const note = document.getElementById('cancel-note').value;

            const report = reports.find(r => r.id === reportId);
            if (report) {
                report.status = 'cancelled_after_approved';
                report.cancelled_at = new Date().toISOString().slice(0, 16).replace('T', ' ');
                report.cancel_reason = reason;
                report.cancel_note = note;
            }

            document.querySelector('.fixed').remove();
            showToast('âœ… å·²å–æ¶ˆå ±å‚™');
            renderReportList();
        }

        function showReportDetail(reportId) {
            const report = reports.find(r => r.id === reportId);
            const content = document.getElementById('content');

            content.innerHTML = `
                <div class="fade-in">
                    <button onclick="navigateTo('reports')" class="flex items-center gap-2 text-slate-500 mb-6 font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                        è¿”å›åˆ—è¡¨
                    </button>

                    <div class="bg-white rounded-3xl p-6 border border-slate-100 mb-6">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h2 class="text-2xl font-black text-slate-900 mb-1">${report.buyer_name}</h2>
                                <p class="text-slate-500">${report.buyer_phone}</p>
                            </div>
                            <span class="px-4 py-2 ${getStatusColor(report.status)} rounded-full text-sm font-bold">${getStatusText(report.status)}</span>
                        </div>

                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between py-3 border-b border-slate-100">
                                <span class="text-slate-500">å»ºæ¡ˆ</span>
                                <span class="font-bold text-slate-900">${report.project_name}</span>
                            </div>
                            <div class="flex justify-between py-3 border-b border-slate-100">
                                <span class="text-slate-500">å ±å‚™æ™‚é–“</span>
                                <span class="font-bold text-slate-900">${report.created_at}</span>
                            </div>
                            <div class="flex justify-between py-3 border-b border-slate-100">
                                <span class="text-slate-500">å¸Œæœ›æ—¥æœŸ</span>
                                <span class="font-bold text-slate-900">${report.preferred_date} ${report.preferred_time}</span>
                            </div>
                            ${report.scheduled_date ? `
                                <div class="flex justify-between py-3">
                                    <span class="text-slate-500">å¯¦éš›å¸¶çœ‹</span>
                                    <span class="font-bold text-blue-600">${report.scheduled_date} ${report.scheduled_time}</span>
                                </div>
                            ` : ''}
                        </div>

                        ${report.status === 'pending' ? `
                            <div class="p-4 bg-yellow-50 rounded-xl">
                                <p class="text-sm text-yellow-800 font-bold">â³ ç­‰å¾…ä»£éŠ·æ ¸å¯ä¸­...</p>
                            </div>
                        ` : report.status === 'approved' ? `
                            <div class="p-4 bg-blue-50 rounded-xl">
                                <p class="text-sm text-blue-800 font-bold">âœ… å·²æ ¸å¯ï¼Œè«‹æº–æ™‚å¸¶çœ‹</p>
                            </div>
                        ` : ''}
                    </div>

                    <!-- æ™‚é–“è»¸ -->
                    <div class="bg-white rounded-3xl p-6 border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-900 mb-4">é€²åº¦æ™‚é–“è»¸</h3>
                        <div class="space-y-4">
                            <div class="flex gap-4">
                                <div class="flex flex-col items-center">
                                    <div class="w-3 h-3 rounded-full bg-blue-600"></div>
                                    <div class="w-0.5 h-full bg-slate-200 mt-2"></div>
                                </div>
                                <div class="pb-6">
                                    <p class="font-bold text-slate-900">ã€ä»²ä»‹ã€‘å ±å‚™é€å‡º</p>
                                    <p class="text-xs text-slate-400 mt-1">${report.created_at}</p>
                                </div>
                            </div>
                            ${report.status !== 'pending' ? `
                                <div class="flex gap-4">
                                    <div class="flex flex-col items-center">
                                        <div class="w-3 h-3 rounded-full bg-green-600"></div>
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-900">ã€ä»£éŠ·ã€‘å·²æ ¸å¯</p>
                                        <p class="text-xs text-slate-400 mt-1">${report.created_at}</p>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function filterReports(status) {
            // ç°¡æ˜“å¯¦ä½œï¼Œå¯¦éš›æ‡‰é‡æ–°æ¸²æŸ“åˆ—è¡¨
            showToast('ç¯©é¸åŠŸèƒ½ï¼š' + status);
        }

        // ===== [A-04] æˆäº¤ä½£é‡‘æŸ¥è©¢ =====
        function renderCommissionList() {
            const content = document.getElementById('content');

            const totalCommission = deals.reduce((sum, d) => sum + d.broker_commission, 0);

            content.innerHTML = `
                <div class="fade-in">
                    <!-- ç¸½è¦½å¡ç‰‡ -->
                    <div class="bg-gradient-to-br from-green-500 to-teal-500 rounded-3xl p-6 text-white mb-6">
                        <p class="text-sm opacity-80 mb-2">æœ¬æœˆä½£é‡‘æ”¶å…¥</p>
                        <p class="text-5xl font-black mb-2">${totalCommission.toFixed(2)} <span class="text-2xl">è¬</span></p>
                        <p class="text-xs opacity-60">${deals.length} ç­†æˆäº¤</p>
                    </div>

                    <!-- æˆäº¤åˆ—è¡¨ -->
                    <h3 class="text-lg font-bold text-slate-900 mb-4">æˆäº¤æ˜ç´°</h3>
                    <div class="space-y-4">
                        ${deals.length === 0 ? `
                            <div class="text-center py-20">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-slate-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                <p class="text-slate-400 font-bold">å°šç„¡æˆäº¤è¨˜éŒ„</p>
                            </div>
                        ` : deals.map(d => `
                            <div onclick="showDealDetail('${d.deal_id}')" class="bg-white rounded-2xl p-6 border border-slate-100 cursor-pointer hover:shadow-lg transition-all">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-slate-900 mb-1">${d.project_name}</h3>
                                        <p class="text-sm text-slate-500">${maskName(d.buyer_name)}</p>
                                    </div>
                                    <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">å·²æˆäº¤</span>
                                </div>

                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div class="p-3 bg-slate-50 rounded-xl">
                                        <p class="text-xs text-slate-500 mb-1">æˆäº¤åƒ¹</p>
                                        <p class="text-lg font-black text-slate-900">${d.deal_price} è¬</p>
                                    </div>
                                    <div class="p-3 bg-slate-50 rounded-xl">
                                        <p class="text-xs text-slate-500 mb-1">ä½£é‡‘ç‡</p>
                                        <p class="text-lg font-black text-slate-900">${d.commission_rate}%</p>
                                    </div>
                                </div>

                                <div class="p-4 bg-green-50 rounded-xl">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-green-800 font-bold">ä»²ä»‹ä½£é‡‘</span>
                                        <span class="text-2xl font-black text-green-600">${d.broker_commission} è¬</span>
                                    </div>
                                </div>

                                <p class="text-xs text-slate-400 mt-4">æˆäº¤æ—¥æœŸï¼š${d.deal_date}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function showDealDetail(dealId) {
            const deal = deals.find(d => d.deal_id === dealId);
            const content = document.getElementById('content');

            content.innerHTML = `
                <div class="fade-in">
                    <button onclick="navigateTo('commission')" class="flex items-center gap-2 text-slate-500 mb-6 font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                        è¿”å›åˆ—è¡¨
                    </button>

                    <div class="bg-white rounded-3xl p-6 border border-slate-100">
                        <h2 class="text-2xl font-black text-slate-900 mb-6">æˆäº¤æ˜ç´°</h2>

                        <div class="space-y-4 mb-6">
                            <div class="flex justify-between py-3 border-b border-slate-100">
                                <span class="text-slate-500">å»ºæ¡ˆ</span>
                                <span class="font-bold text-slate-900">${deal.project_name}</span>
                            </div>
                            <div class="flex justify-between py-3 border-b border-slate-100">
                                <span class="text-slate-500">è²·æ–¹</span>
                                <span class="font-bold text-slate-900">${deal.buyer_name}</span>
                            </div>
                            <div class="flex justify-between py-3 border-b border-slate-100">
                                <span class="text-slate-500">æˆäº¤åƒ¹</span>
                                <span class="font-bold text-slate-900">${deal.deal_price} è¬</span>
                            </div>
                            <div class="flex justify-between py-3 border-b border-slate-100">
                                <span class="text-slate-500">ä½£é‡‘ç‡</span>
                                <span class="font-bold text-slate-900">${deal.commission_rate}%</span>
                            </div>
                            <div class="flex justify-between py-3 border-b border-slate-100">
                                <span class="text-slate-500">æ¥­ç¸¾ç¸½é¡</span>
                                <span class="font-bold text-blue-600">${deal.performance} è¬</span>
                            </div>
                        </div>

                        <div class="p-6 bg-gradient-to-br from-green-500 to-teal-500 rounded-2xl text-white mb-6">
                            <p class="text-sm opacity-80 mb-2">ä»²ä»‹ä½£é‡‘ï¼ˆ60%ï¼‰</p>
                            <p class="text-5xl font-black">${deal.broker_commission} <span class="text-2xl">è¬</span></p>
                        </div>

                        <div class="p-4 bg-slate-50 rounded-xl">
                            <p class="text-xs text-slate-500 mb-2">ä½£é‡‘åˆ†é…</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-slate-600">æ¥­ç¸¾ç¸½é¡</span>
                                    <span class="font-bold">${deal.performance} è¬</span>
                                </div>
                                <div class="flex justify-between text-green-600">
                                    <span>ä»²ä»‹ç«¯ï¼ˆ60%ï¼‰</span>
                                    <span class="font-bold">${deal.broker_commission} è¬</span>
                                </div>
                            </div>
                        </div>

                        <p class="text-xs text-slate-400 mt-6">æˆäº¤æ—¥æœŸï¼š${deal.deal_date}</p>
                    </div>
                </div>
            `;
        }

        // å·¥å…·å‡½æ•¸
        function maskName(name) {
            if (name.length <= 1) return name;
            return name[0] + 'â—‹'.repeat(name.length - 1);
        }

        function maskPhone(phone) {
            return phone.replace(/(\d{4})-(\d{3})-(\d{3})/, '****-***-$3');
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'å·²å ±å‚™ãƒ»å¾…æ ¸å¯',
                'approved': 'å·²æ ¸å¯',
                'completed': 'å·²å¸¶çœ‹',
                'rejected': 'å·²æ‹’çµ•',
                'cancelled': 'å·²å–æ¶ˆ',
                'cancelled_after_approved': 'å·²æ ¸å¯å¾Œå–æ¶ˆ'
            };
            return statusMap[status] || status;
        }

        function getStatusColor(status) {
            const colorMap = {
                'pending': 'bg-yellow-100 text-yellow-700',
                'approved': 'bg-blue-100 text-blue-700',
                'completed': 'bg-green-100 text-green-700',
                'cancelled_after_approved': 'bg-slate-100 text-slate-600',
                'rejected': 'bg-red-100 text-red-700',
                'cancelled': 'bg-slate-100 text-slate-600'
            };
            return colorMap[status] || 'bg-slate-100 text-slate-600';
        }
    </script>
</body>
</html>